# 📍 通学路地図作成ツール

小学校提出用の通学路地図を簡単に作成できるWebアプリケーション。お絵かき感覚で通学路を描いて、白黒の詳細地図として保存できます。

## ✨ 主な機能

### 🎯 保存中心マーカー方式
- **赤い十字マーカー**: 保存される地図の中心位置を視覚的に表示
- **ドラッグで移動**: マーカーまたはラベルを直接ドラッグして保存位置を調整
- **範囲の可視化**: 点線の枠で実際に保存される範囲を常時表示
- **表示/非表示切り替え**: 「▢ 範囲非表示」ボタンで保存範囲プレビューを切り替え可能
- **固定縮尺**: ズームレベル18（30m縮尺）で道路が白く見える状態で保存

### 📏 線とピンで通学路を描画
- **線の描画**: タップで点を追加、通学路のルートを描画
- **自動完了**: 他のボタンを押すと自動的に線が完了
- **ピン配置**: 🏠自宅、🏫学校など8種類のアイコン + 点のみオプション
- **ラベル付け**: 「家」「学校」「交差点」などテキストを追加可能
- **色の選択**: 赤・青・黒の3色から選択可能

### 📱 スマホ最適化
- **フローティングツールバー**: PC版は左上に半透明パネル（折りたたみ可能）
- **ボトムツールバー**: スマホ版は画面下部に操作ボタン
- **タッチ操作対応**: 画面の小さいスマホでも快適に操作
- **レスポンシブデザイン**: 自動でPC/スマホレイアウトに切り替え

### 🗺️ 地図モード
- **カラーモード**: 通常のOpenStreetMap表示（デフォルト）
- **白黒モード**: Stamen Tonerの白黒地図、印刷に最適
- **ワンタップ切り替え**: 🗺️ボタンでカラー⇔白黒を瞬時に切り替え
- **自動ズーム**: 白黒モードに切り替えると自動的にズーム18に設定

### 🎨 カスタマイズ機能
- **9種類の表現方法**: 
  - ピンのアイコンなし（点のみ）
  - 🏠家、🏫学校、📍目印、⭐重要、🚸横断歩道、⚠️注意、🚩旗、🛑停止
- **3色のカラー**: 赤・青・黒から選択
- **ラベル追加**: 各ピンにテキストラベルを付けられる（ピンの下に表示）
- **移動モード**: 配置済みのピンをドラッグで移動可能

### 💾 保存機能
- **4つの画像サイズ**: 1200×900、900×1200、1500×1500、2000×1500
- **ズーム18固定**: 常に30m縮尺の詳細地図で保存
- **PNG形式**: 高品質な画像として保存
- **日付・モード付きファイル名**: `通学路地図_白黒地図_zoom18_2026-01-23.png`

## 🚀 使い方

### 基本的な手順（推奨）

1. **場所を検索**
```
   検索バーに「札幌市立○○小学校」と入力
   ↓
   🔍移動ボタンをタップ
   ↓
   保存中心（赤い十字）が自動的にその場所に設定される
```

2. **地図を調整**
```
   地図をピンチ・パンで自由に表示
   ↓
   ちょうど良い位置にしたら「➕ 中心移動」をタップ
   ↓
   保存中心が現在の表示中心に移動
```
   または
```
   赤い十字マーカーまたは「保存の中心（ドラッグで移動）」ラベルを
   直接ドラッグして位置調整
```

3. **ピンと線を配置**
```
   📍ピンを選択 → 地図をタップ
   ↓
   アイコンとラベルを設定（例：🏠「家」）
   ↓
   📏線を選択 → 地図を連続タップで通学路を描画
   ↓
   「✅ 線を完了」ボタンまたは他のボタンを押すと線が完了
```

4. **白黒モードに切り替え**
```
   🗺️白黒地図ボタンをタップ
   ↓
   ズーム18の白黒地図に自動的に切り替わる
   ↓
   線の色がそのまま保持される
```

5. **保存範囲の確認と調整**
```
   赤い点線の枠で保存範囲を確認
   ↓
   必要に応じて画像サイズを変更（枠のサイズも変わる）
   ↓
   保存中心マーカーをドラッグして位置調整
   ↓
   不要な場合は「▢ 範囲非表示」で枠を非表示にできる
```

6. **保存**
```
   画像サイズを選択（推奨：1200×900）
   ↓
   💾保存ボタンをタップ
   ↓
   赤い十字の位置を中心に、ズーム18で保存される
```

### 💡 便利なTips

#### 保存範囲の確認
- **点線の枠**: 常に表示される赤い点線が実際の保存範囲
- **地図のズーム**: 拡大縮小しても保存時は常にズーム18
- **範囲の調整**: 画像サイズを変更すると点線枠のサイズも変わる
- **表示切り替え**: 「▢ 範囲非表示」ボタンで枠を非表示にできる（作業中に邪魔な場合）

#### 保存中心の設定方法
- **方法1（検索）**: 住所検索すると自動的に保存中心が設定される
- **方法2（表示中心）**: 地図を動かして「➕ 中心移動」ボタンで現在の表示中心を保存中心に設定
- **方法3（ドラッグ）**: 赤い十字マーカーまたはラベルを直接ドラッグして移動

#### 線の描画
- **完了方法**: 「✅ 線を完了」ボタンまたは他のボタンを押す
- **右クリック**: PCでは右クリックで線を完了（スマホは不要）
- **Escキー**: PCではEscキーで線を完了またはキャンセル

#### ピンの配置
- **移動モード**: ✋ピン移動を選択してピンをドラッグ
- **戻す**: ↩️描画を戻すボタンで1つずつ取り消し
- **全削除**: 🗑️削除ボタンですべてクリア
- **ラベルなし**: ラベル入力欄を空白にすると、アイコンのみまたは点のみで配置される

#### 白黒モードでの色
線の色は白黒モードでもそのまま保持されます:
- 赤 → 赤のまま（#ef4444）
- 青 → 青のまま（#3b82f6）
- 黒 → 黒のまま（#1f2937）

白黒地図上でも見やすい色設定になっています。

## 🛠️ 技術仕様

### 使用技術
- **Leaflet.js 1.9.4**: オープンソースの地図ライブラリ
- **OpenStreetMap**: 無料のカラー地図データ
- **Stamen Toner (Stadia Maps提供)**: 白黒地図タイル
- **html2canvas 1.4.1**: 地図の画像化
- **Nominatim API**: 住所検索（無料、OpenStreetMap提供）

### 対応ブラウザ
- Chrome / Edge（推奨）
- Safari
- Firefox
- モバイルブラウザ（iOS Safari, Android Chrome）

### ネットワーク要件
- インターネット接続が必要（地図タイルの読み込みのため）
- APIキー不要（Stadia Maps APIキーは埋め込み済み）
- 完全無料

## 📐 仕様詳細

### ズームレベル
- **初期表示**: ズーム15（札幌市中心）
- **住所検索後**: ズーム18（保存中心も自動設定）
- **白黒モード切り替え時**: ズーム18に自動設定
- **保存時**: ズーム18固定（30m縮尺）

### 保存中心マーカー
- **赤い十字（＋）**: 画面上で常に表示（表示/非表示切り替え可能）
- **ドラッグ可能**: マーカー本体またはラベルをマウス・タッチで自由に移動
- **保存時非表示**: 画像にはマーカーは含まれない
- **ラベル**: 「保存の中心（ドラッグで移動）」と表示

### 保存範囲プレビュー
- **赤い点線枠**: 実際に保存される範囲を表示（表示/非表示切り替え可能）
- **4隅にコーナーマーク**: 範囲を明確に
- **ズーム連動**: 地図のズームに応じて枠サイズが変化
- **画像サイズ連動**: 画像サイズを変更すると枠サイズも変化
- **保存時非表示**: 画像には枠は含まれない
- **ラベル**: 「保存される範囲」と表示

### 線の描画
- **太さ**: 4px
- **不透明度**: 80%
- **色**: 赤（#ef4444）・青（#3b82f6）・黒（#1f2937）
- **元の色を保持**: モード切り替え時も色情報は保持

### ピンの種類
- **点のみ**: 10px×10px の円形、選択した色で表示
- **アイコン**: 30px×30px の絵文字アイコン
- **ラベル**: アイコンまたは点の下に表示、白い縁取り付き

### 画像サイズ
- 1200×900px（横長・推奨）
- 900×1200px（縦長）
- 1500×1500px（正方形）
- 2000×1500px（横長・高解像度）

## 🎓 活用シーン

- **小学校入学**: 通学路地図の提出用（主要用途）
- **転校時**: 新しい通学路の確認・提出
- **学童保育**: お迎えルートの説明
- **保護者会**: 通学路の共有・議論
- **防災マップ**: 避難経路の作成
- **地域安全マップ**: 危険箇所の記録

## 📱 操作ガイド

### PC版（左上フローティングツールバー）
```
┌─────────────────────┐
│ 📍 通学路ツール    − │ ← クリックで折りたたみ
├─────────────────────┤
│ 基本ツール          │
│ [📍ピン] [📏線]     │
│ [✋ピン移動]        │
├─────────────────────┤
│ 点/線の色           │
│ [赤] [青] [黒]      │
├─────────────────────┤
│ アイコン            │
│ [選択ボックス]      │
├─────────────────────┤
│ ピンの文字          │
│ [入力欄]            │
├─────────────────────┤
│ 保存中心            │
│ [▢ 範囲非表示]      │
│ [➕ 中心移動]       │
├─────────────────────┤
│ 画像サイズ          │
│ [選択ボックス]      │
├─────────────────────┤
│ [📍 0] [📏 0]       │ ← 統計表示
├─────────────────────┤
│ [↩️ 描画を戻す]     │
│ [🗑️ 削除]          │
│ [🗺️ 白黒地図]      │
│ [💾 保存]           │
└─────────────────────┘
```

### スマホ版（画面下部ボトムツールバー）
```
┌──────────────────────┐
│ [📍  ] [📏  ] [↩️  ] [✋  ] │
│ ピン   線    戻す  移動 │
├──────────────────────┤
│ [赤] [青] [黒]       │ ← 色選択
├──────────────────────┤
│ [アイコン選択▼]     │
├──────────────────────┤
│ [ピンの文字入力]    │
├──────────────────────┤
│ [▢    ] [➕   ] [🗑️  ] │
│ 範囲   中心   削除  │
│ 非表示 移動         │
├──────────────────────┤
│ [🗺️ 白黒地図]       │
│ [💾 保存]           │
└──────────────────────┘
```

**補足:**
- 線描画中は画面下部に大きな緑色の「✅ 線を完了」ボタンが表示されます
- スマホの場合、このボタンは画面下部ツールバーの上に表示されます

## 🔧 トラブルシューティング

### 線が見えない
- 2点以上タップして線を描画してください
- 線の色が地図の色と近い場合は色を変更してください
- 白黒モードでも線の色はそのまま表示されます

### 保存範囲がわからない
- 赤い点線の枠が保存範囲です
- 「▢ 範囲非表示」になっている場合は、もう一度ボタンを押して表示してください
- 画像サイズを変更すると枠のサイズも変わります
- 赤い十字が保存の中心点です

### 保存した画像が想定と違う
- 保存時は常にズーム18固定です
- 画面のズームレベルは保存に影響しません
- 赤い十字（保存中心マーカー）の位置が保存の中心になります
- 保存範囲プレビュー（赤い点線枠）で事前に確認できます

### 線の完了ボタンが見つからない
- 線を2点以上描画すると、画面に大きな緑色の「✅ 線を完了」ボタンが表示されます
- スマホの場合は画面下部ツールバーの上に表示されます
- 他のボタン（保存、白黒地図など）を押しても自動的に線が完了します
- PCではEscキーでも完了できます

### 保存中心マーカーが動かせない
- 「▢ 範囲非表示」になっていると、マーカーも非表示になります
- もう一度「▢範囲表示」ボタンを押してマーカーを表示してください
- マーカー本体または下のラベルをドラッグできます

### 保存範囲が表示されない
- 「▢ 範囲非表示」ボタンを押して「▢ 範囲非表示」（緑色）に変更してください
- ボタンの色が緑色の場合は表示状態、通常色の場合は非表示状態です

## 📝 ライセンス

このツールはオープンソースで提供されています。

### 地図データ・サービス
- © OpenStreetMap contributors - カラー地図データ
- © Stamen Design - Toner地図デザイン
- © Stadia Maps - 地図タイル配信サービス

### ライブラリ
- Leaflet.js (BSD 2-Clause License)
- html2canvas (MIT License)

## 🙏 謝辞

- [Leaflet.js](https://leafletjs.com/) - 地図ライブラリ
- [OpenStreetMap](https://www.openstreetmap.org/) - 地図データ
- [Stamen Design](http://maps.stamen.com/) - 白黒地図デザイン
- [Stadia Maps](https://stadiamaps.com/) - 地図タイル配信
- [html2canvas](https://html2canvas.hertzen.com/) - スクリーンショット機能
- [Nominatim](https://nominatim.org/) - 住所検索API

## 📮 フィードバック

改善提案やバグ報告は、GitHubのIssuesまでお願いします。

---

**LLM 100 Days Challenge - Day 65+**  
**通学路地図作成ツール v1.0**