<!DOCTYPE html>

<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã“ã©ã‚‚ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ã‚ºãƒ«</title>

<!-- Meta Tags -->
<meta name="description" content="å­ä¾›å‘ã‘ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ã‚ºãƒ«ã‚²ãƒ¼ãƒ ã€‚ã‹ã‚ã„ã„å‹•ç‰©ã‚„è‡ªç„¶ã®å†™çœŸã§æ¥½ã—ãéŠã¹ã‚‹ã€‚3æ®µéšã®é›£æ˜“åº¦ã¨ã‚«ã‚¹ã‚¿ãƒ ç”»åƒå¯¾å¿œã€‚">
<meta name="keywords" content="ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ã‚ºãƒ«,å­ä¾›å‘ã‘ã‚²ãƒ¼ãƒ ,ãƒ‘ã‚ºãƒ«ã‚²ãƒ¼ãƒ ,çŸ¥è‚²ã‚²ãƒ¼ãƒ ,ã‚­ãƒƒã‚ºãƒ‘ã‚ºãƒ«">

<!-- OGP (Open Graph Protocol) -->
<meta property="og:title" content="ã“ã©ã‚‚ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ã‚ºãƒ« - æ¥½ã—ãéŠã¹ã‚‹çŸ¥è‚²ãƒ‘ã‚ºãƒ«ã‚²ãƒ¼ãƒ " />
<meta property="og:description" content="ã‹ã‚ã„ã„å‹•ç‰©ã‚„è‡ªç„¶ã®å†™çœŸã‚’ä½¿ã£ãŸå­ä¾›å‘ã‘ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ã‚ºãƒ«ã€‚3Ã—3ã‹ã‚‰5Ã—5ã¾ã§ã®é›£æ˜“åº¦é¸æŠã€ã‚«ã‚¹ã‚¿ãƒ ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ä»˜ãã€‚" />
<meta property="og:image" content="https://hiroe28.github.io/llm-100days-challenge/day064-kids-slide-puzzle/screenshot.png" />
<meta property="og:url" content="https://hiroe28.github.io/llm-100days-challenge/day064-kids-slide-puzzle/index.html" />
<meta property="og:type" content="website" />

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="ã“ã©ã‚‚ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ã‚ºãƒ«" />
<meta name="twitter:description" content="å­ä¾›å‘ã‘ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ã‚ºãƒ«ã‚²ãƒ¼ãƒ ã€‚ã‹ã‚ã„ã„å‹•ç‰©ã‚„è‡ªç„¶ã®å†™çœŸã§æ¥½ã—ãéŠã¹ã‚‹ã€‚3æ®µéšã®é›£æ˜“åº¦ã¨ã‚«ã‚¹ã‚¿ãƒ ç”»åƒå¯¾å¿œã§ã€ä½•åº¦ã§ã‚‚æ¥½ã—ã‚ã‚‹çŸ¥è‚²ãƒ‘ã‚ºãƒ«ã€‚" />
<meta property="twitter:image" content="https://hiroe28.github.io/llm-100days-challenge/day064-kids-slide-puzzle/screenshot.png" />
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Arial', sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
    }

    .container {
        background: white;
        border-radius: 20px;
        padding: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 600px;
        width: 100%;
    }

    @media (max-width: 768px) {
        .container {
            padding: 15px;
            border-radius: 15px;
        }

        h1 {
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        select, button, input[type="file"] {
            padding: 10px;
            font-size: 14px;
        }

        .image-btn {
            padding: 8px;
            font-size: 14px;
        }

        .button-group button {
            min-width: 120px;
            padding: 10px;
            font-size: 13px;
        }

        .info {
            font-size: 16px;
        }

        .success-message {
            font-size: 20px;
        }

        #countdown {
            font-size: 36px;
        }

        .modal-content {
            margin: 10% auto;
            padding: 20px;
            width: 95%;
        }

        .modal-content h2 {
            font-size: 1.5em;
        }

        .modal-content h3 {
            font-size: 1.2em;
        }

        .help-section {
            padding: 10px;
        }
    }

    @keyframes celebrate {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }

    .celebrating {
        animation: celebrate 0.5s ease-in-out 3;
    }

    h1 {
        text-align: center;
        color: #667eea;
        margin-bottom: 20px;
        font-size: 2em;
    }

    .controls {
        margin-bottom: 20px;
    }

    .control-group {
        margin-bottom: 15px;
    }

    .button-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .button-group button {
        flex: 1;
        min-width: 150px;
        margin-top: 0;
    }

    label {
        display: block;
        margin-bottom: 5px;
        color: #333;
        font-weight: bold;
    }

    select, button, input[type="file"] {
        width: 100%;
        padding: 12px;
        border-radius: 10px;
        border: 2px solid #667eea;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s;
    }

    button {
        background: #667eea;
        color: white;
        font-weight: bold;
        margin-top: 10px;
    }

    button:hover {
        background: #5568d3;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    #hint-btn {
        background: #52c41a;
        margin-left: 10px;
    }

    #hint-btn:hover {
        background: #45a616;
    }

    .help-button {
        background: #ff9800;
    }

    .help-button:hover {
        background: #f57c00;
    }

    .next-move-button {
        background: #9c27b0;
    }

    .next-move-button:hover {
        background: #7b1fa2;
    }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.6);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 30px;
        border: none;
        border-radius: 20px;
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 32px;
        font-weight: bold;
        cursor: pointer;
        line-height: 20px;
    }

    .close:hover,
    .close:focus {
        color: #667eea;
    }

    .modal-content h2 {
        color: #667eea;
        margin-bottom: 20px;
        text-align: center;
    }

    .modal-content h3 {
        color: #333;
        margin-top: 15px;
        margin-bottom: 10px;
    }

    .help-section {
        margin-bottom: 20px;
        padding: 15px;
        background: #f5f5f5;
        border-radius: 10px;
    }

    .help-section p {
        margin: 8px 0;
        line-height: 1.6;
    }

    .help-section strong {
        color: #667eea;
    }

    .puzzle-piece.highlight {
        box-shadow: 0 0 20px 5px #ffd700;
        animation: pulse 1s infinite;
    }

    @keyframes pulse {
        0%, 100% { 
            box-shadow: 0 0 20px 5px #ffd700;
            transform: scale(1);
        }
        50% { 
            box-shadow: 0 0 30px 8px #ffd700;
            transform: scale(1.05);
        }
    }

    #countdown {
        text-align: center;
        font-size: 48px;
        font-weight: bold;
        color: #667eea;
        margin: 20px 0;
        height: 60px;
    }

    .image-options {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 15px;
    }

    .image-btn {
        flex: 1;
        min-width: 120px;
        padding: 10px;
        background: #f0f0f0;
        border: 2px solid #ddd;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .image-btn:hover, .image-btn.active {
        background: #667eea;
        color: white;
        border-color: #667eea;
    }

    #puzzle-container {
        display: grid;
        gap: 2px;
        background: #333;
        padding: 2px;
        border-radius: 10px;
        margin: 20px auto;
        width: 100%;
        max-width: min(90vw, 500px);
    }

    .puzzle-piece {
        width: 100%;
        aspect-ratio: 1;
        background-size: cover;
        background-position: center;
        cursor: pointer;
        transition: all 0.3s;
        border: 2px solid #fff;
    }

    .puzzle-piece:hover {
        transform: scale(1.05);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .puzzle-piece.empty {
        background: #ddd;
        cursor: default;
    }

    .info {
        text-align: center;
        margin-top: 20px;
        font-size: 18px;
        color: #333;
    }

    .moves {
        font-weight: bold;
        color: #667eea;
    }

    .success-message {
        text-align: center;
        color: #4caf50;
        font-size: 24px;
        font-weight: bold;
        margin-top: 20px;
        display: none;
    }

    @keyframes celebrate {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }

    .celebrating {
        animation: celebrate 0.5s ease-in-out 3;
    }
</style>
```

</head>
<body>
    <div class="container">
        <h1>ğŸ§© ã“ã©ã‚‚ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‘ã‚ºãƒ« ğŸ§©</h1>

```
    <div class="controls">
        <div class="control-group">
            <label>ãƒ‘ã‚ºãƒ«ã®ãŠãŠãã•:</label>
            <select id="size-select">
                <option value="3" selected>ã‹ã‚“ãŸã‚“ (3Ã—3)</option>
                <option value="4">ãµã¤ã† (4Ã—4)</option>
                <option value="5">ã‚€ãšã‹ã—ã„ (5Ã—5)</option>
            </select>
        </div>

        <div class="control-group">
            <label>ãŒãã†ã‚’ãˆã‚‰ã¶:</label>
            <div class="image-options">
                <button class="image-btn active" data-image="cat">ğŸ± ã­ã“</button>
                <button class="image-btn" data-image="dog">ğŸ¶ ã„ã¬</button>
                <button class="image-btn" data-image="flower">ğŸŒ¸ ã¯ãª</button>
                <button class="image-btn" data-image="nature">ğŸŒˆ ã—ãœã‚“</button>
            </div>
            <input type="file" id="custom-image" accept="image/*">
        </div>

        <div class="button-group">
            <button id="start-btn">ã‚ãŸã‚‰ã—ãã¯ã˜ã‚ã‚‹</button>
            <button id="hint-btn" style="display: none;">ãŠã¦ã»ã‚“ã‚’ã¿ã‚‹</button>
        </div>
        <div class="button-group">
            <button id="help-btn" class="help-button">â“ ã‚ãã³ã‹ãŸ</button>
            <button id="next-move-btn" style="display: none;" class="next-move-button">ğŸ’¡ ã¤ãã®ä¸€æ‰‹</button>
        </div>
    </div>

    <!-- ãƒ˜ãƒ«ãƒ—ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="help-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>ğŸ® ã‚ãã³ã‹ãŸ</h2>
            <div class="help-section">
                <h3>ğŸ¯ ã‚‚ãã²ã‚‡ã†</h3>
                <p>ã°ã‚‰ã°ã‚‰ã«ãªã£ãŸãƒ”ãƒ¼ã‚¹ã‚’ã€ãŸã ã—ã„ã˜ã‚…ã‚“ã°ã‚“ã«ãªã‚‰ã¹ã‹ãˆã‚ˆã†ï¼</p>
            </div>
            <div class="help-section">
                <h3>ğŸ“ ãƒ«ãƒ¼ãƒ«</h3>
                <p>âœ… ãã†ã¯ãï¼ˆç°è‰²ã®ãƒã‚¹ï¼‰ã®ã¨ãªã‚Šã®ãƒ”ãƒ¼ã‚¹ã ã‘ã†ã”ã‹ã›ã‚‹ã‚ˆ</p>
                <p>âœ… ã†ã”ã‹ã—ãŸã„ãƒ”ãƒ¼ã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã‚ˆã†</p>
            </div>
            <div class="help-section">
                <h3>ğŸ’¡ ã‹ã‚“ãŸã‚“ã«ã¨ãã‚³ãƒ„</h3>
                <p><strong>ã‚¹ãƒ†ãƒƒãƒ—1:</strong> ã¾ãšã€ã„ã¡ã°ã‚“ã†ãˆã®1ãã‚‡ã†ã‚’ã‹ã‚“ã›ã„ã•ã›ã‚ˆã†</p>
                <p><strong>ã‚¹ãƒ†ãƒƒãƒ—2:</strong> ã¤ãã«ã€2ãã‚‡ã†ã‚ã‚’ã‹ã‚“ã›ã„ã•ã›ã‚ˆã†</p>
                <p><strong>ã‚¹ãƒ†ãƒƒãƒ—3:</strong> ã®ã“ã‚Šã¯ã‹ã‚“ãŸã‚“ï¼ã˜ã‚…ã‚“ã°ã‚“ã«ãã‚ãˆã¦ã„ã“ã†</p>
                <p><strong>ãƒã‚¤ãƒ³ãƒˆ:</strong> ãã†ã¯ãã‚’ã†ã¾ãã¤ã‹ã£ã¦ã€ãƒ”ãƒ¼ã‚¹ã‚’ã†ã”ã‹ãã†</p>
            </div>
            <div class="help-section">
                <h3>ğŸ ãŠãŸã™ã‘ãã®ã†</h3>
                <p>ğŸ–¼ï¸ <strong>ãŠã¦ã»ã‚“ã‚’ã¿ã‚‹:</strong> ã‹ã‚“ã›ã„ã—ãŸã™ãŒãŸã‚’ã¿ã‚‰ã‚Œã‚‹ã‚ˆï¼ˆ3ã³ã‚‡ã†ã‹ã‚“ï¼‰</p>
                <p>ğŸ’¡ <strong>ã¤ãã®ä¸€æ‰‹:</strong> ã©ã®ãƒ”ãƒ¼ã‚¹ã‚’ã†ã”ã‹ã›ã°ã„ã„ã‹ãŠã—ãˆã¦ãã‚Œã‚‹ã‚ˆ</p>
            </div>
        </div>
    </div>

    <div id="countdown" style="display: none;"></div>
    <div id="puzzle-container"></div>

    <div class="info">
        ã†ã”ã‹ã—ãŸã‹ãš: <span class="moves" id="moves">0</span>
    </div>

    <div class="success-message" id="success-message">
        ğŸ‰ ãŠã‚ã§ã¨ã†! ğŸ‰<br>ã‹ã‚“ã›ã„ã—ã¾ã—ãŸ!
    </div>
</div>

<script>
    let gridSize = 3;
    let tiles = [];
    let emptyIndex;
    let moves = 0;
    let currentImage = '';
    let customImageUrl = null;
    let isPlaying = false;
    let hintTimeout;
    let highlightedTile = null;
    let lastHintedTile = null;

    const imageThemes = {
        cat: 'https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=800',
        dog: 'https://images.unsplash.com/photo-1587300003388-59208cc962cb?w=800',
        flower: 'https://images.unsplash.com/photo-1490750967868-88aa4486c946?w=800',
        nature: 'https://images.unsplash.com/photo-1518173946687-a4c8892bbd9f?w=800'
    };

    document.getElementById('size-select').addEventListener('change', (e) => {
        gridSize = parseInt(e.target.value);
    });

    document.querySelectorAll('.image-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            document.querySelectorAll('.image-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            currentImage = e.target.dataset.image;
            customImageUrl = null;
        });
    });

    document.getElementById('custom-image').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (event) => {
                customImageUrl = event.target.result;
                document.querySelectorAll('.image-btn').forEach(b => b.classList.remove('active'));
                initPuzzle();
            };
            reader.readAsDataURL(file);
        }
    });

    document.getElementById('start-btn').addEventListener('click', initPuzzle);
    document.getElementById('hint-btn').addEventListener('click', showHint);
    document.getElementById('help-btn').addEventListener('click', () => {
        document.getElementById('help-modal').style.display = 'block';
    });
    document.getElementById('next-move-btn').addEventListener('click', showNextMove);
    
    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
    document.querySelector('.close').addEventListener('click', () => {
        document.getElementById('help-modal').style.display = 'none';
    });
    
    window.addEventListener('click', (e) => {
        const modal = document.getElementById('help-modal');
        if (e.target === modal) {
            modal.style.display = 'none';
        }
    });

    function initPuzzle() {
        moves = 0;
        isPlaying = false;
        highlightedTile = null;
        lastHintedTile = null;
        document.getElementById('moves').textContent = moves;
        document.getElementById('success-message').style.display = 'none';
        document.getElementById('hint-btn').style.display = 'none';
        document.getElementById('next-move-btn').style.display = 'none';

        const container = document.getElementById('puzzle-container');
        container.innerHTML = '';
        container.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;

        const totalTiles = gridSize * gridSize;
        tiles = Array.from({length: totalTiles}, (_, i) => i);
        emptyIndex = totalTiles - 1;
        
        // ã¾ãšå®Œæˆå½¢ã‚’è¡¨ç¤º
        renderPuzzle();
        
        // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤º
        const countdown = document.getElementById('countdown');
        countdown.style.display = 'block';
        countdown.textContent = 'ãŠã¦ã»ã‚“ã‚’ã¿ã¦!';
        
        setTimeout(() => {
            countdown.textContent = '3';
            setTimeout(() => {
                countdown.textContent = '2';
                setTimeout(() => {
                    countdown.textContent = '1';
                    setTimeout(() => {
                        countdown.textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆ!';
                        countdown.style.display = 'none';
                        shuffleTiles();
                        renderPuzzle();
                        isPlaying = true;
                        document.getElementById('hint-btn').style.display = 'inline-block';
                        document.getElementById('next-move-btn').style.display = 'inline-block';
                    }, 1000);
                }, 1000);
            }, 1000);
        }, 1000);
    }

    function shuffleTiles() {
        for (let i = 0; i < 1000; i++) {
            const validMoves = getValidMoves();
            const randomMove = validMoves[Math.floor(Math.random() * validMoves.length)];
            [tiles[emptyIndex], tiles[randomMove]] = [tiles[randomMove], tiles[emptyIndex]];
            emptyIndex = randomMove;
        }
    }

    function showNextMove() {
        if (!isPlaying) return;
        
        const validMoves = getValidMoves();
        if (validMoves.length === 0) return;
        
        let bestMove = null;
        
        // æˆ¦ç•¥1: ä¸Šã®è¡Œã‹ã‚‰é †ã«æƒãˆã‚‹
        // ã¾ãšã€ä¸€ç•ªä¸Šã®è¡Œã§æ­£ã—ããªã„ãƒ”ãƒ¼ã‚¹ã‚’æ¢ã™
        for (let row = 0; row < gridSize; row++) {
            for (let col = 0; col < gridSize; col++) {
                const index = row * gridSize + col;
                const correctTileNum = index;
                const currentTileNum = tiles[index];
                
                // ã“ã®ãƒã‚¹ãŒé–“é•ã£ã¦ã„ã‚‹å ´åˆ
                if (currentTileNum !== correctTileNum && currentTileNum !== tiles.length - 1) {
                    // ã“ã®ã‚¿ã‚¤ãƒ«ãŒä»Šå‹•ã‹ã›ã‚‹ä½ç½®ã«ã‚ã‚‹ã‹
                    if (validMoves.includes(index)) {
                        // å‰å›ã¨é•ã†ãƒ”ãƒ¼ã‚¹ã‚’å„ªå…ˆ
                        if (index !== lastHintedTile) {
                            bestMove = index;
                            break;
                        }
                    }
                    
                    // æ­£ã—ã„ã‚¿ã‚¤ãƒ«ãŒã©ã“ã«ã‚ã‚‹ã‹æ¢ã™
                    const correctTileIndex = tiles.indexOf(correctTileNum);
                    if (correctTileIndex !== -1 && validMoves.includes(correctTileIndex)) {
                        if (correctTileIndex !== lastHintedTile) {
                            bestMove = correctTileIndex;
                            break;
                        }
                    }
                }
            }
            if (bestMove !== null) break;
        }
        
        // æˆ¦ç•¥2: å‹•ã‹ã›ã‚‹ãƒ”ãƒ¼ã‚¹ã®ä¸­ã§ã€æ­£ã—ã„ä½ç½®ã«ãªã„ã‚‚ã®ã‚’ææ¡ˆ
        if (!bestMove) {
            const wrongPositionMoves = validMoves.filter(move => {
                const tileNum = tiles[move];
                return tileNum !== move && tileNum !== tiles.length - 1 && move !== lastHintedTile;
            });
            
            if (wrongPositionMoves.length > 0) {
                // ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠï¼ˆå‰å›ã¨é•ã†ã‚‚ã®ã‚’å„ªå…ˆï¼‰
                bestMove = wrongPositionMoves[Math.floor(Math.random() * wrongPositionMoves.length)];
            }
        }
        
        // æˆ¦ç•¥3: ãã‚Œã§ã‚‚è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ã€ã¨ã‚Šã‚ãˆãšå‹•ã‹ã›ã‚‹ãƒ”ãƒ¼ã‚¹ã‚’ææ¡ˆ
        if (!bestMove) {
            const availableMoves = validMoves.filter(m => m !== lastHintedTile);
            if (availableMoves.length > 0) {
                bestMove = availableMoves[0];
            } else if (validMoves.length > 0) {
                bestMove = validMoves[0];
            }
        }
        
        if (bestMove !== null) {
            lastHintedTile = bestMove;
            highlightedTile = bestMove;
            renderPuzzle();
            
            // 5ç§’å¾Œã«ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’æ¶ˆã™
            setTimeout(() => {
                highlightedTile = null;
                renderPuzzle();
            }, 5000);
        }
    }
    
    function showHint() {
        if (!isPlaying) return;
        
        clearTimeout(hintTimeout);
        
        const currentTiles = [...tiles];
        const currentEmpty = emptyIndex;
        
        // å®Œæˆå½¢ã‚’è¡¨ç¤º
        tiles = Array.from({length: tiles.length}, (_, i) => i);
        emptyIndex = tiles.length - 1;
        renderPuzzle();
        
        const hintBtn = document.getElementById('hint-btn');
        hintBtn.textContent = 'ãŠã¦ã»ã‚“ã‚’ã¿ã¦ã„ã‚‹...';
        hintBtn.disabled = true;
        
        // 3ç§’å¾Œã«å…ƒã«æˆ»ã™
        hintTimeout = setTimeout(() => {
            tiles = currentTiles;
            emptyIndex = currentEmpty;
            renderPuzzle();
            hintBtn.textContent = 'ãŠã¦ã»ã‚“ã‚’ã¿ã‚‹';
            hintBtn.disabled = false;
        }, 3000);
    }

    function getValidMoves() {
        const moves = [];
        const row = Math.floor(emptyIndex / gridSize);
        const col = emptyIndex % gridSize;

        if (row > 0) moves.push(emptyIndex - gridSize);
        if (row < gridSize - 1) moves.push(emptyIndex + gridSize);
        if (col > 0) moves.push(emptyIndex - 1);
        if (col < gridSize - 1) moves.push(emptyIndex + 1);

        return moves;
    }

    function renderPuzzle() {
        const container = document.getElementById('puzzle-container');
        container.innerHTML = '';

        const imageUrl = customImageUrl || imageThemes[currentImage] || imageThemes['cat'];

        tiles.forEach((tileNum, index) => {
            const tile = document.createElement('div');
            tile.className = 'puzzle-piece';
            
            if (tileNum === tiles.length - 1) {
                tile.classList.add('empty');
                emptyIndex = index;
            } else {
                const row = Math.floor(tileNum / gridSize);
                const col = tileNum % gridSize;
                
                // ç”»åƒã‚’æ­£ã—ãåˆ†å‰²ã™ã‚‹ãŸã‚ã®è¨ˆç®—
                const percentX = gridSize > 1 ? (col / (gridSize - 1)) * 100 : 0;
                const percentY = gridSize > 1 ? (row / (gridSize - 1)) * 100 : 0;
                
                tile.style.backgroundImage = `url(${imageUrl})`;
                tile.style.backgroundSize = `${gridSize * 100}% ${gridSize * 100}%`;
                tile.style.backgroundPosition = `${percentX}% ${percentY}%`;
                
                // æ¬¡ã®ä¸€æ‰‹ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                if (index === highlightedTile) {
                    tile.classList.add('highlight');
                }
                
                tile.addEventListener('click', () => moveTile(index));
            }

            container.appendChild(tile);
        });
    }

    function moveTile(index) {
        if (!isPlaying || !getValidMoves().includes(index)) return;

        [tiles[emptyIndex], tiles[index]] = [tiles[index], tiles[emptyIndex]];
        emptyIndex = index;
        moves++;
        highlightedTile = null; // ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’ã‚¯ãƒªã‚¢
        lastHintedTile = null; // å‰å›ã®ãƒ’ãƒ³ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
        document.getElementById('moves').textContent = moves;
        
        renderPuzzle();
        checkWin();
    }

    function checkWin() {
        const isWin = tiles.every((tile, index) => tile === index);
        if (isWin) {
            isPlaying = false;
            highlightedTile = null;
            document.getElementById('hint-btn').style.display = 'none';
            document.getElementById('next-move-btn').style.display = 'none';
            document.getElementById('success-message').style.display = 'block';
            document.getElementById('puzzle-container').classList.add('celebrating');
            setTimeout(() => {
                document.getElementById('puzzle-container').classList.remove('celebrating');
            }, 1500);
        }
    }

    // åˆæœŸåŒ–
    currentImage = 'cat';
    initPuzzle();
</script>

</body>
</html>