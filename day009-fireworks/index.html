<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="ãŠãˆã‹ãèŠ±ç«ã‚¢ãƒ—ãƒª" />
    <meta property="og:description" content="ç”»é¢ã‚’ã‚¿ãƒƒãƒã™ã‚‹ã ã‘ã§ã‚«ãƒ©ãƒ•ãƒ«ãªèŠ±ç«ã‚„æ˜Ÿã€ãƒãƒ¼ãƒˆãªã©5ç¨®é¡ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’æã‘ã‚‹ãŠçµµã‹ãã‚¢ãƒ—ãƒªã§ã™ã€‚éŸ³ã‚‚é³´ã£ã¦æ¥½ã—ã„ï¼" />
    <meta property="og:image" content="https://hiroe28.github.io/llm-100days-challenge/day009-fireworks/screenshot.png" />
    <meta property="og:url" content="https://hiroe28.github.io/llm-100days-challenge/day009-fireworks/index.html" />
    <meta name="twitter:card" content="summary_large_image" />  
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>ãŠçµµã‹ãèŠ±ç«ã‚¢ãƒ—ãƒª</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: "Arial Rounded MT Bold", "ãƒ’ãƒ©ã‚®ãƒä¸¸ã‚´ ProN", sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-color: #222;
            touch-action: none;
        }
        
        h1 {
            text-align: center;
            color: #fff;
            background: linear-gradient(45deg, #ff5252, #ff4081, #7c4dff, #448aff, #64ffda, #b2ff59, #ffff00);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 10px 0;
            font-size: 28px;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        }
        
        .container {
            display: flex;
            flex: 1;
            padding: 10px;
            gap: 10px;
        }
        
        .canvas-container {
            flex: 1;
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        canvas {
            width: 100%;
            height: 100%;
            display: block;
            background-color: #000;
        }
        
        .controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }
        
        .effect-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid white;
            margin: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: transform 0.2s;
            background-size: cover;
            background-position: center;
        }
        
        .effect-btn:hover {
            transform: scale(1.1);
        }
        
        .effect-btn.active {
            box-shadow: 0 0 10px 3px white;
        }
        
        .fireworks {
            background: radial-gradient(circle, #ff5252, #7c4dff);
        }
        
        .stars {
            background: radial-gradient(circle, #ffff00, #ff4081);
        }
        
        .bubbles {
            background: radial-gradient(circle, #64ffda, #448aff);
        }
        
        .hearts {
            background: radial-gradient(circle, #ff4081, #ff5252);
        }
        
        .music-note {
            background: radial-gradient(circle, #b2ff59, #ffff00);
        }
        
        .clear-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        .clear-btn:hover {
            background-color: rgba(255, 255, 255, 0.4);
        }
        
        /* ãƒ©ãƒ³ãƒ€ãƒ é…ç½®ãƒœã‚¿ãƒ³ */
        .random-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        .random-btn:hover {
            background-color: rgba(255, 255, 255, 0.4);
        }
        
        .random-btn.active {
            background-color: rgba(255, 100, 100, 0.6);
            box-shadow: 0 0 10px rgba(255, 100, 100, 0.8);
        }
        
        /* å›è»¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .spin {
            animation: rotate 10s linear infinite;
        }
    </style>
</head>
<body>
    <h1>âœ¨ ãŠãˆã‹ãèŠ±ç« âœ¨</h1>
    <div class="container">
        <div class="canvas-container">
            <canvas id="canvas"></canvas>
            <button id="clear-btn" class="clear-btn">ğŸ—‘ï¸ ãœã‚“ã¶ã‘ã™</button>
            <button id="random-btn" class="random-btn">ğŸ² è‡ªå‹•èŠ±ç«ã‚·ãƒ§ãƒ¼</button>
            <div class="controls">
                <div id="fireworks-btn" class="effect-btn fireworks active">ğŸ†</div>
                <div id="stars-btn" class="effect-btn stars">â­</div>
                <div id="bubbles-btn" class="effect-btn bubbles">ğŸ«§</div>
                <div id="hearts-btn" class="effect-btn hearts">â¤ï¸</div>
                <div id="music-btn" class="effect-btn music-note">ğŸµ</div>
            </div>
        </div>
    </div>

    <script>
        // ã‚­ãƒ£ãƒ³ãƒã‚¹è¦ç´ ã¨2Dã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®å–å¾—
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        // UIè¦ç´ ã®å‚ç…§
        const clearBtn = document.getElementById('clear-btn');
        const randomBtn = document.getElementById('random-btn');
        const fireworksBtn = document.getElementById('fireworks-btn');
        const starsBtn = document.getElementById('stars-btn');
        const bubblesBtn = document.getElementById('bubbles-btn');
        const heartsBtn = document.getElementById('hearts-btn');
        const musicBtn = document.getElementById('music-btn');
        
        // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¿ã‚¤ãƒ—
        let currentEffect = 'fireworks';
        
        // ãƒ©ãƒ³ãƒ€ãƒ é…ç½®ãƒ¢ãƒ¼ãƒ‰
        let randomMode = false;
        let randomInterval = null;
        
        // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã®é…åˆ—
        let particles = [];
        let stars = [];
        
        // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºã®è¨­å®š
        function resizeCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }
        
        // åˆæœŸåŒ–
        function init() {
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            setupEventListeners();
            createStars();
            requestAnimationFrame(update);
            
            // éŸ³å£°ã®è¨­å®š
            setupAudio();
        }
        
        // éŸ³å£°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ–
        let audioContext;
        let sounds = {};
        
        function setupAudio() {
            try {
                // ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®åˆæœŸåŒ–
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // å„ã‚¨ãƒ•ã‚§ã‚¯ãƒˆéŸ³ã®è¨­å®š
                sounds = {
                    fireworks: createSound([523.25, 659.25, 783.99], 0.1),  // ãƒ‰ã€ãƒŸã€ã‚½
                    stars: createSound([783.99, 987.77, 1318.51], 0.1),    // ã‚½ã€ã‚·ã€é«˜ã„ãƒŸ
                    bubbles: createSound([261.63, 392.00, 523.25], 0.15),  // ãƒ‰ã€ã‚½ã€é«˜ã„ãƒ‰
                    hearts: createSound([392.00, 440.00, 523.25], 0.12),   // ã‚½ã€ãƒ©ã€é«˜ã„ãƒ‰
                    music: createSound([523.25, 587.33, 659.25, 783.99], 0.08)  // ãƒ‰ã€ãƒ¬ã€ãƒŸã€ã‚½
                };
            } catch (e) {
                console.log('Web Audio API is not supported in this browser');
            }
        }
        
        // ç°¡å˜ãªéŸ³ä½œæˆé–¢æ•°
        function createSound(frequencies, duration) {
            return function() {
                try {
                    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãŒãªã„ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹å ´åˆãŒã‚ã‚‹
                    if (audioContext.state === 'suspended') {
                        audioContext.resume();
                    }
                    
                    // ãƒ©ãƒ³ãƒ€ãƒ ã«å‘¨æ³¢æ•°ã‚’é¸æŠ
                    const freq = frequencies[Math.floor(Math.random() * frequencies.length)];
                    
                    // ã‚ªã‚·ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ä½œæˆ
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    // æ¥ç¶š
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    // è¨­å®š
                    oscillator.type = 'sine';
                    oscillator.frequency.value = freq;
                    gainNode.gain.value = 0.1;
                    
                    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
                    
                    // é–‹å§‹ã¨åœæ­¢
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + duration);
                } catch (e) {
                    console.log('Error playing sound:', e);
                }
            };
        }
        
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
        function setupEventListeners() {
            // ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ã‚¤ãƒ™ãƒ³ãƒˆ
            canvas.addEventListener('mousedown', handlePointerStart);
            canvas.addEventListener('mousemove', handlePointerMove);
            canvas.addEventListener('mouseup', handlePointerEnd);
            canvas.addEventListener('touchstart', handleTouchStart);
            canvas.addEventListener('touchmove', handleTouchMove);
            canvas.addEventListener('touchend', handleTouchEnd);
            
            // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé¸æŠãƒœã‚¿ãƒ³
            fireworksBtn.addEventListener('click', () => setEffect('fireworks'));
            starsBtn.addEventListener('click', () => setEffect('stars'));
            bubblesBtn.addEventListener('click', () => setEffect('bubbles'));
            heartsBtn.addEventListener('click', () => setEffect('hearts'));
            musicBtn.addEventListener('click', () => setEffect('music'));
            
            // ãƒ©ãƒ³ãƒ€ãƒ ãƒœã‚¿ãƒ³
            randomBtn.addEventListener('click', toggleRandomMode);
            
            // ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³
            clearBtn.addEventListener('click', clearCanvas);
        }
        
        // ãƒ©ãƒ³ãƒ€ãƒ ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆ
        function toggleRandomMode() {
            randomMode = !randomMode;
            randomBtn.classList.toggle('active', randomMode);
            
            if (randomMode) {
                startRandomEffects();
            } else {
                stopRandomEffects();
            }
        }
        
        // ä½¿ç”¨å¯èƒ½ãªã™ã¹ã¦ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¿ã‚¤ãƒ—
        const allEffectTypes = ['fireworks', 'stars', 'bubbles', 'hearts', 'music'];
        
        // ãƒ©ãƒ³ãƒ€ãƒ ãªã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¿ã‚¤ãƒ—ã‚’é¸æŠ
        function getRandomEffectType() {
            const randomIndex = Math.floor(Math.random() * allEffectTypes.length);
            return allEffectTypes[randomIndex];
        }
        
        // ãƒ©ãƒ³ãƒ€ãƒ ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®é–‹å§‹
        function startRandomEffects() {
            if (randomInterval) {
                clearInterval(randomInterval);
            }
            
            // ãƒ¡ã‚¤ãƒ³ã®ãƒ©ãƒ³ãƒ€ãƒ åŠ¹æœé–“éš”ï¼ˆ0.5ã€œ2ç§’ã”ã¨ã«å¤§ããªã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼‰
            randomInterval = setInterval(() => {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                
                // ãƒ©ãƒ³ãƒ€ãƒ ã«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¿ã‚¤ãƒ—ã‚’é¸æŠ
                const randomEffect = getRandomEffectType();
                
                // ä¸€æ™‚çš„ã«é¸æŠã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’å¤‰æ›´ï¼ˆUIã®æ›´æ–°ã‚‚ã™ã‚‹ï¼‰
                const originalEffect = currentEffect;
                setEffect(randomEffect);
                
                // ãƒ©ãƒ³ãƒ€ãƒ ãªã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
                createParticlesAt(x, y, 15 + Math.floor(Math.random() * 15));
                
                // éŸ³ã‚’é³´ã‚‰ã™
                if (sounds[randomEffect]) {
                    sounds[randomEffect]();
                }
                
                // å°ã•ãªã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’ãƒ©ãƒ³ãƒ€ãƒ ãªæ™‚é–“å·®ã§è¿½åŠ ï¼ˆå°ã•ãªã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¯ãƒ¡ã‚¤ãƒ³ã¨åŒã˜ã‚¿ã‚¤ãƒ—ã‚’ä½¿ç”¨ï¼‰
                const miniBurstCount = Math.floor(Math.random() * 5) + 1;
                
                for (let i = 0; i < miniBurstCount; i++) {
                    setTimeout(() => {
                        if (randomMode) {  // ãƒ©ãƒ³ãƒ€ãƒ ãƒ¢ãƒ¼ãƒ‰ãŒçµ‚äº†ã—ã¦ã„ãŸã‚‰å®Ÿè¡Œã—ãªã„
                            const miniBurstX = x + (Math.random() - 0.5) * 100;
                            const miniBurstY = y + (Math.random() - 0.5) * 100;
                            
                            // ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¨åŒã˜ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚¿ã‚¤ãƒ—ã‚’ä½¿ç”¨
                            createParticlesAt(miniBurstX, miniBurstY, 5 + Math.floor(Math.random() * 10));
                            
                            // ãŸã¾ã«éŸ³ã‚’é³´ã‚‰ã™
                            if (Math.random() > 0.5 && sounds[currentEffect]) {
                                sounds[currentEffect]();
                            }
                        }
                    }, Math.random() * 1000);  // 0ã€œ1ç§’ã®ãƒ©ãƒ³ãƒ€ãƒ ãªæ™‚é–“å·®
                }
                
            }, 500 + Math.random() * 1500);  // 0.5ã€œ2ç§’é–“éš”ã§ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ•ã‚§ã‚¯ãƒˆç™ºç”Ÿ
        }
        
        // ãƒ©ãƒ³ãƒ€ãƒ ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®åœæ­¢
        function stopRandomEffects() {
            if (randomInterval) {
                clearInterval(randomInterval);
                randomInterval = null;
            }
        }
        
        // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé¸æŠ
        function setEffect(effect) {
            currentEffect = effect;
            
            // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
            fireworksBtn.classList.toggle('active', effect === 'fireworks');
            starsBtn.classList.toggle('active', effect === 'stars');
            bubblesBtn.classList.toggle('active', effect === 'bubbles');
            heartsBtn.classList.toggle('active', effect === 'hearts');
            musicBtn.classList.toggle('active', effect === 'music');
        }
        
        // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ï¼ˆiOSãªã©ï¼‰
        function handleTouchStart(event) {
            event.preventDefault();
            const touch = event.touches[0];
            handlePointerStart(touch);
        }
        
        function handleTouchMove(event) {
            event.preventDefault();
            const touch = event.touches[0];
            handlePointerMove(touch);
        }
        
        function handleTouchEnd(event) {
            event.preventDefault();
            handlePointerEnd();
        }
        
        // ãƒã‚¤ãƒ³ã‚¿çŠ¶æ…‹
        let isPointerDown = false;
        let lastX, lastY;
        let pointerMoveCount = 0;
        
        // ãƒã‚¤ãƒ³ã‚¿ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
        function handlePointerStart(event) {
            isPointerDown = true;
            const rect = canvas.getBoundingClientRect();
            lastX = event.clientX - rect.left;
            lastY = event.clientY - rect.top;
            createParticlesAt(lastX, lastY, 20);
            
            // éŸ³ã‚’é³´ã‚‰ã™
            if (sounds[currentEffect]) {
                sounds[currentEffect]();
            }
        }
        
        function handlePointerMove(event) {
            if (!isPointerDown) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            // ç§»å‹•ãŒãªã„å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
            if (x === lastX && y === lastY) return;
            
            // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’ä½¿ã£ã¦é–“å¼•ãã™ã‚‹ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šï¼‰
            pointerMoveCount++;
            if (pointerMoveCount % 2 === 0) {
                createParticlesAt(x, y, 5);
                
                // å‹•ã„ãŸæ™‚ã«éŸ³ã‚’é³´ã‚‰ã™ï¼ˆé–“å¼•ãï¼‰
                if (pointerMoveCount % 6 === 0 && sounds[currentEffect]) {
                    sounds[currentEffect]();
                }
            }
            
            lastX = x;
            lastY = y;
        }
        
        function handlePointerEnd() {
            isPointerDown = false;
            pointerMoveCount = 0;
        }
        
        // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ç”Ÿæˆ
        function createParticlesAt(x, y, count) {
            for (let i = 0; i < count; i++) {
                let particle;
                
                switch (currentEffect) {
                    case 'fireworks':
                        particle = createFirework(x, y);
                        break;
                    case 'stars':
                        particle = createStar(x, y);
                        break;
                    case 'bubbles':
                        particle = createBubble(x, y);
                        break;
                    case 'hearts':
                        particle = createHeart(x, y);
                        break;
                    case 'music':
                        particle = createMusicNote(x, y);
                        break;
                }
                
                particles.push(particle);
            }
        }
        
        // èŠ±ç«ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«
        function createFirework(x, y) {
            const hue = Math.floor(Math.random() * 360);
            const size = 3 + Math.random() * 5;
            
            return {
                x: x,
                y: y,
                vx: (Math.random() - 0.5) * 8,
                vy: (Math.random() - 0.5) * 8,
                size: size,
                color: `hsl(${hue}, 100%, 60%)`,
                sparkColor: `hsl(${hue}, 100%, 80%)`,
                type: 'firework',
                opacity: 1,
                gravity: 0.05,
                decay: 0.01 + Math.random() * 0.02,
                sparkles: Math.random() > 0.5
            };
        }
        
        // æ˜Ÿãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«
        function createStar(x, y) {
            const hue = 50 + Math.random() * 60; // é»„è‰²ç³»
            const size = 10 + Math.random() * 10;
            
            return {
                x: x,
                y: y,
                vx: (Math.random() - 0.5) * 3,
                vy: (Math.random() - 0.5) * 3,
                size: size,
                spikes: 5,
                innerRadius: size * 0.4,
                outerRadius: size,
                color: `hsl(${hue}, 100%, 70%)`,
                type: 'star',
                opacity: 1,
                gravity: 0.03,
                decay: 0.005 + Math.random() * 0.01,
                rotation: Math.random() * Math.PI * 2,
                rotationSpeed: (Math.random() - 0.5) * 0.1
            };
        }
        
        // ãƒãƒ–ãƒ«ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«
        function createBubble(x, y) {
            const hue = 180 + Math.random() * 60; // é’ã€œæ°´è‰²ç³»
            const size = 5 + Math.random() * 20;
            
            return {
                x: x,
                y: y,
                vx: (Math.random() - 0.5) * 2,
                vy: -1 - Math.random() * 2, // ä¸Šã«æµ®ã‹ã¶
                size: size,
                color: `hsla(${hue}, 100%, 80%, 0.7)`,
                strokeColor: `hsla(${hue}, 100%, 90%, 0.9)`,
                type: 'bubble',
                opacity: 1,
                gravity: -0.02, // ãƒã‚¤ãƒŠã‚¹ã®é‡åŠ›ã§ä¸Šã«æµ®ã‹ã¶
                decay: 0.003 + Math.random() * 0.007,
                wobble: Math.random() * 0.1,
                wobbleSpeed: 0.1 + Math.random() * 0.2
            };
        }
        
        // ãƒãƒ¼ãƒˆãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«
        function createHeart(x, y) {
            const hue = 330 + Math.random() * 30; // ãƒ”ãƒ³ã‚¯ã€œèµ¤ç³»
            const size = 5 + Math.random() * 10;
            
            return {
                x: x,
                y: y,
                vx: (Math.random() - 0.5) * 3,
                vy: -1 - Math.random() * 3,
                size: size,
                color: `hsl(${hue}, 100%, 60%)`,
                type: 'heart',
                opacity: 1,
                gravity: 0.05,
                decay: 0.005 + Math.random() * 0.01,
                rotation: Math.random() * Math.PI * 2,
                rotationSpeed: (Math.random() - 0.5) * 0.1,
                pulse: 0,
                pulseSpeed: 0.05 + Math.random() * 0.05
            };
        }
        
        // éŸ³ç¬¦ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«
        function createMusicNote(x, y) {
            const hues = [120, 240, 60, 300, 0]; // æ§˜ã€…ãªè‰²
            const hue = hues[Math.floor(Math.random() * hues.length)];
            const size = 10 + Math.random() * 15;
            const noteTypes = ['â™ª', 'â™«', 'â™©', 'â™¬', 'â™­', 'â™®'];
            const noteType = noteTypes[Math.floor(Math.random() * noteTypes.length)];
            
            return {
                x: x,
                y: y,
                vx: (Math.random() - 0.5) * 4,
                vy: -2 - Math.random() * 3,
                size: size,
                color: `hsl(${hue}, 100%, 60%)`,
                type: 'music',
                text: noteType,
                opacity: 1,
                gravity: 0.04,
                decay: 0.005 + Math.random() * 0.01,
                rotation: (Math.random() - 0.5) * Math.PI / 4,
                rotationSpeed: (Math.random() - 0.5) * 0.05
            };
        }
        
        // èƒŒæ™¯ã®æ˜Ÿã‚’ä½œæˆ
        function createStars() {
            const count = Math.floor(canvas.width * canvas.height / 5000);
            
            for (let i = 0; i < count; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: 0.5 + Math.random() * 2,
                    opacity: 0.2 + Math.random() * 0.8,
                    twinkleSpeed: 0.003 + Math.random() * 0.03,
                    twinklePhase: Math.random() * Math.PI * 2
                });
            }
        }
        
        // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚¯ãƒªã‚¢
        function clearCanvas() {
            particles = [];
        }
        
        // ãƒ¡ã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãƒ«ãƒ¼ãƒ—
        function update() {
            // ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ã‚¯ãƒªã‚¢ï¼ˆèƒŒæ™¯è‰²ã¯æ®‹ã™ï¼‰
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // èƒŒæ™¯ã®æ˜Ÿã‚’æç”»
            updateStars();
            
            // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã®æ›´æ–°ã¨æç”»
            updateParticles();
            
            requestAnimationFrame(update);
        }
        
        // èƒŒæ™¯ã®æ˜Ÿã‚’æ›´æ–°
        function updateStars() {
            for (const star of stars) {
                // æ˜æ»…åŠ¹æœ
                star.twinklePhase += star.twinkleSpeed;
                const twinkle = 0.5 + 0.5 * Math.sin(star.twinklePhase);
                
                ctx.fillStyle = `rgba(255, 255, 255, ${star.opacity * twinkle})`;
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã®æ›´æ–°ã¨æç”»
        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                
                // é‡åŠ›ã®é©ç”¨
                p.vy += p.gravity;
                
                // ä½ç½®ã®æ›´æ–°
                p.x += p.vx;
                p.y += p.vy;
                
                // é€æ˜åº¦ã®æ¸›è¡°
                p.opacity -= p.decay;
                
                // å¯¿å‘½ãŒå°½ããŸãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã®å‰Šé™¤
                if (p.opacity <= 0) {
                    particles.splice(i, 1);
                    continue;
                }
                
                // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸæç”»
                switch (p.type) {
                    case 'firework':
                        drawFirework(p);
                        break;
                    case 'star':
                        drawStar(p);
                        break;
                    case 'bubble':
                        drawBubble(p);
                        break;
                    case 'heart':
                        drawHeart(p);
                        break;
                    case 'music':
                        drawMusicNote(p);
                        break;
                }
            }
        }
        
        // èŠ±ç«ã®æç”»
        function drawFirework(p) {
            ctx.globalAlpha = p.opacity;
            
            // ãƒ¡ã‚¤ãƒ³ã®ç²’å­
            ctx.fillStyle = p.color;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            ctx.fill();
            
            // ç«èŠ±åŠ¹æœ
            if (p.sparkles && p.opacity > 0.4) {
                ctx.strokeStyle = p.sparkColor;
                ctx.lineWidth = 1;
                
                for (let i = 0; i < 3; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const length = p.size * 2 + Math.random() * p.size * 3;
                    
                    ctx.beginPath();
                    ctx.moveTo(p.x, p.y);
                    ctx.lineTo(
                        p.x + Math.cos(angle) * length,
                        p.y + Math.sin(angle) * length
                    );
                    ctx.stroke();
                }
            }
            
            ctx.globalAlpha = 1.0;
        }
        
        // æ˜Ÿã®æç”»
        function drawStar(p) {
            ctx.globalAlpha = p.opacity;
            ctx.fillStyle = p.color;
            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate(p.rotation);
            p.rotation += p.rotationSpeed;
            
            // æ˜Ÿã®å½¢ã‚’æç”»
            ctx.beginPath();
            for (let i = 0; i < p.spikes * 2; i++) {
                const radius = i % 2 === 0 ? p.outerRadius : p.innerRadius;
                const angle = Math.PI * i / p.spikes;
                ctx.lineTo(
                    Math.cos(angle) * radius,
                    Math.sin(angle) * radius
                );
            }
            ctx.closePath();
            ctx.fill();
            
            ctx.restore();
            ctx.globalAlpha = 1.0;
        }
        
        // ãƒãƒ–ãƒ«ã®æç”»
        function drawBubble(p) {
            ctx.globalAlpha = p.opacity;
            
            // æºã‚‰ãåŠ¹æœ
            p.wobble += p.wobbleSpeed;
            const wobbleX = Math.sin(p.wobble) * 2;
            
            // ãƒãƒ–ãƒ«ã®æç”»
            ctx.fillStyle = p.color;
            ctx.strokeStyle = p.strokeColor;
            ctx.lineWidth = 1.5;
            
            ctx.beginPath();
            ctx.arc(p.x + wobbleX, p.y, p.size, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
            
            // ãƒã‚¤ãƒ©ã‚¤ãƒˆåŠ¹æœ
            ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
            ctx.beginPath();
            ctx.arc(
                p.x + wobbleX - p.size * 0.3,
                p.y - p.size * 0.3,
                p.size * 0.2,
                0, Math.PI * 2
            );
            ctx.fill();
            
            ctx.globalAlpha = 1.0;
        }
        
        // ãƒãƒ¼ãƒˆã®æç”»
        function drawHeart(p) {
            ctx.globalAlpha = p.opacity;
            ctx.fillStyle = p.color;
            
            // è„ˆå‹•åŠ¹æœ
            p.pulse += p.pulseSpeed;
            const scale = 1 + Math.sin(p.pulse) * 0.1;
            
            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate(p.rotation);
            ctx.scale(scale, scale);
            p.rotation += p.rotationSpeed;
            
            // ãƒãƒ¼ãƒˆã®å½¢ã‚’æç”»
            ctx.beginPath();
            ctx.moveTo(0, -p.size / 2);
            ctx.bezierCurveTo(
                p.size / 2, -p.size,
                p.size, -p.size / 4,
                0, p.size / 2
            );
            ctx.bezierCurveTo(
                -p.size, -p.size / 4,
                -p.size / 2, -p.size,
                0, -p.size / 2
            );
            ctx.closePath();
            ctx.fill();
            
            ctx.restore();
            ctx.globalAlpha = 1.0;
        }
        
        // éŸ³ç¬¦ã®æç”»
        function drawMusicNote(p) {
            ctx.globalAlpha = p.opacity;
            ctx.fillStyle = p.color;
            
            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate(p.rotation);
            p.rotation += p.rotationSpeed;
            
            // éŸ³ç¬¦ãƒ†ã‚­ã‚¹ãƒˆã‚’æç”»
            ctx.font = `bold ${p.size * 2}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(p.text, 0, 0);
            
            ctx.restore();
            ctx.globalAlpha = 1.0;
        }
        
        // åˆæœŸåŒ–ã‚’å®Ÿè¡Œ
        init();
    </script>
</body>
</html>