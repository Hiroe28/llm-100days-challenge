<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤¢ã®å¢ƒç•Œç·š -ä¸æ€è­°ãªéƒ¨å±‹ã‹ã‚‰ã®è„±å‡º-</title>
    <style>
        /* å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Mochiy Pop One', sans-serif;
            background-color: #f0e6f6;
            color: #333;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        /* ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿ */
        @import url('https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&display=swap');
        
        /* ã‚³ãƒ³ãƒ†ãƒŠã‚¹ã‚¿ã‚¤ãƒ« */
        .container{
            position: relative;
            width: 100%;
            max-width: 800px;
            aspect-ratio: 3/2;
            margin: 0 auto;
            overflow: hidden;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,.2);
        }
        
        /* ã‚²ãƒ¼ãƒ ç”»é¢ */
        .game-screen{
            position: absolute;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            display: none;
        }
        
        /* ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ */
        .title-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('assets/title_bg.png');
            background-size: cover;
            background-position: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            text-align: center;
        }
        
        .title-overlay {
            background: linear-gradient(to bottom, rgba(80, 19, 108, 0.7), rgba(49, 14, 87, 0.9));
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: -1;
        }
        
        .title-content {
            z-index: 11;
            padding: 20px;
            max-width: 90%;
        }
        
        .title-screen h1 {
            color: #fff;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        .title-screen p {
            color: #e5d0ff;
            font-size: 1.2em;
            margin-bottom: 30px;
            max-width: 90%;
        }
        
        /* ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç”»é¢ */
        .story-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(80, 19, 108, 0.8), rgba(49, 14, 87, 0.9));
            z-index: 15;
            overflow-y: auto;
            display: none;
        }
        
        .story-screen.active {
            display: block;
        }
        
        .story-content {
            padding: 20px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100%;
            box-sizing: border-box;
        }
        
        .story-screen h2 {
            color: #fff;
            font-size: 1.8em;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        .story-screen p {
            color: #f5ebff;
            font-size: 1.1em;
            margin-bottom: 20px;
            max-width: 90%;
            line-height: 1.6;
        }
        
        .story-image {
            max-width: 70%;
            height: auto;
            margin: 15px 0;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .story-button-container {
            margin-top: 20px;
            width: 100%;
            display: flex;
            justify-content: center;
            position: relative;
            padding-bottom: 20px;
        }
        
        /* ã‚¹ãƒ†ãƒ¼ã‚¸é–“ç”»é¢ */
        .stage-transition {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(106, 48, 147, 0.8), rgba(160, 68, 255, 0.7));
            z-index: 14;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            display: none;
        }
        
        .stage-transition.active {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .transition-content {
            z-index: 15;
            max-width: 90%;
        }
        
        .stage-transition h2 {
            color: #fff;
            font-size: 2em;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        .stage-transition p {
            color: #f5ebff;
            font-size: 1.1em;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .transition-image {
            max-width: 70%;
            height: auto;
            margin: 15px 0;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        /* ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
        .button {
            background: linear-gradient(to bottom, #ff9a9e, #fad0c4);
            color: #6a3093;
            border: none;
            padding: 12px 30px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 154, 158, 0.5);
            font-family: 'Mochiy Pop One', sans-serif;
            z-index: 20;
        }
        
        .button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(255, 154, 158, 0.7);
        }
        
        .button:active {
            transform: translateY(1px);
        }
        
        /* ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ã‚¿ã‚¤ãƒ« */
        .error-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* åŸºæœ¬çš„ã«ã‚¯ãƒªãƒƒã‚¯ã‚’é€šéã•ã›ã‚‹ */
            z-index: 2;
        }

        .error-object{
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: contain;
            pointer-events: none;
            transition: opacity 1.5s ease; /* ã‚†ã£ãã‚Šæ¶ˆãˆã‚‹ã‚ˆã†ã« */
        }
        
        /* ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚¹ã‚¿ã‚¤ãƒ« */
        .check-mark {
            position: absolute;
            width: 60px;
            height: 60px;
            background-color: rgba(40, 200, 80, 0.9);
            border-radius: 50%;
            z-index: 4;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 0 15px rgba(40, 200, 80, 0.7);
            pointer-events: none;
            opacity: 0;
            transform: scale(1);
            animation: check-appear 0.5s ease forwards;
        }
        
        .check-mark::before {
            content: "";
            width: 30px;
            height: 15px;
            border-left: 4px solid white;
            border-bottom: 4px solid white;
            transform: rotate(-45deg) translate(3px, -5px);
        }
        
        @keyframes check-appear {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        /* ãƒ’ãƒ³ãƒˆãƒœã‚¿ãƒ³ */
        .hint-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(255, 255, 255, 0.7);
            color: #6a3093;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
            z-index: 5;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .hint-button:hover {
            background-color: rgba(255, 255, 255, 0.9);
            transform: scale(1.1);
        }
        
        /* ã‚¹ãƒ†ãƒ¼ã‚¸æƒ…å ±ãƒãƒ¼ */
        .stage-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 5px 15px;
            border-radius: 20px;
            z-index: 5;
            font-weight: bold;
            color: #6a3093;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */
        .progress-container {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 5px 15px;
            border-radius: 20px;
            z-index: 5;
        }
        
        .progress-text {
            margin-right: 10px;
            font-weight: bold;
            color: #6a3093;
        }
        
        .progress-dots {
            display: flex;
        }
        
        .progress-dot {
            width: 15px;
            height: 15px;
            background-color: #e0d0f0;
            border-radius: 50%;
            margin: 0 5px;
            transition: all 0.3s ease;
        }
        
        .progress-dot.found {
            background-color: #ff9a9e;
            box-shadow: 0 0 10px rgba(255, 154, 158, 0.7);
        }
        
        /* ã‚¯ãƒªãƒƒã‚¯é ˜åŸŸ */
        .clickable-area {
            position: absolute;
            cursor: pointer;
            z-index: 3;
        }
        
        /* ã‚¯ãƒªã‚¢ç”»é¢ */
        .clear-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(106, 48, 147, 0.9), rgba(160, 68, 255, 0.8));
            z-index: 20;
            box-sizing: border-box;
            display: none;
            transition: opacity 0.8s ease;
            overflow-y: auto; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã«ã™ã‚‹ */
        }

        .clear-screen.active {
            display: block; /* flexã‹ã‚‰blockã«å¤‰æ›´ */
        }

        .clear-content {
            padding: 20px;
            z-index: 21;
            max-width: 90%;
            margin: 0 auto; /* ä¸­å¤®æƒãˆ */
            text-align: center;
            transition: opacity 0.5s ease;
        }

        
        .clear-screen h2 {
            color: #fff;
            font-size: 2.2em;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        .clear-screen p {
            color: #f5ebff;
            font-size: 1.2em;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .clear-image {
            max-width: 60%; /* ã‚µã‚¤ã‚ºã‚’å°ã•ãã™ã‚‹ */
            height: auto;
            margin: 15px auto; /* ä¸Šä¸‹ã®ä½™ç™½ã‚’ç¢ºä¿ */
        }

        /* ãƒœã‚¿ãƒ³ã‚’ä¸‹éƒ¨ã«å›ºå®šã›ãšã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«åˆã‚ã›ã¦é…ç½® */
        #nextStageButton {
            margin: 20px auto 40px; /* ä¸‹éƒ¨ã«ä½™ç™½ã‚’è¿½åŠ  */
            display: inline-block;
        }

        
        /* ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ */
        .ending-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(80, 19, 108, 0.8), rgba(49, 14, 87, 0.7));
            z-index: 25;
            overflow-y: auto;
            display: none;
        }
        
        .ending-screen.active {
            display: block;
        }
        
        .ending-content {
            padding: 30px 20px;
            position: relative;
            z-index: 26;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100%;
            box-sizing: border-box;
        }
        
        .ending-screen h2 {
            color: #fff;
            font-size: 2.2em;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        .ending-screen p {
            color: #f5ebff;
            font-size: 1.2em;
            margin-bottom: 25px;
            max-width: 90%;
            line-height: 1.7;
        }
        
        .ending-image {
            max-width: 80%;
            height: auto;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
        }
        
        /* ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .message {
            position: absolute;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.9);
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 1.1em;
            color: #6a3093;
            z-index: 5;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            pointer-events: none;
            text-align: center;
            max-width: 80%;
        }
        
        .message.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }
        
        /* è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ */
        .feedback {
            position: absolute;
            pointer-events: none;
            z-index: 4;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            transform: scale(0);
            animation: feedback 0.8s ease-out;
        }
        
        @keyframes feedback {
            0% { transform: scale(0); opacity: 0.7; }
            100% { transform: scale(3); opacity: 0; }
        }
        
        /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
        @media (max-width: 768px) {
            .container {
                width: 95%;
            }
            
            .title-screen h1 {
                font-size: 1.8em;
            }
            
            .title-screen p {
                font-size: 1em;
            }
            
            .button {
                padding: 10px 25px;
                font-size: 1em;
            }
            
            .hint-button {
                width: 40px;
                height: 40px;
                font-size: 1.2em;
                top: 10px;
                right: 10px;
            }
            
            .stage-info {
                top: 10px;
                left: 10px;
                font-size: 0.9em;
                padding: 4px 12px;
            }
            
            .progress-container {
                bottom: 10px;
                left: 10px;
                padding: 3px 10px;
            }
            
            .progress-dot {
                width: 12px;
                height: 12px;
            }
            
            .message {
                bottom: 60px;
                font-size: 0.9em;
            }
            
            .check-mark {
                width: 40px;
                height: 40px;
            }
            
            .check-mark::before {
                width: 20px;
                height: 10px;
                border-left: 3px solid white;
                border-bottom: 3px solid white;
            }
            
            .story-screen h2 {
                font-size: 1.5em;
            }
            
            .story-screen p {
                font-size: 0.9em;
            }
            
            .ending-screen h2 {
                font-size: 1.8em;
            }
            
            .ending-screen p {
                font-size: 1em;
            }
            
            .story-image, .transition-image, .clear-image, .ending-image {
                max-width: 90%;
            }

            /* ã‚³ãƒ³ãƒ†ãƒŠã‚¹ã‚¿ã‚¤ãƒ«ä¿®æ­£ */
            .container {
                position: relative;
                width: 90%;  /* å¹…ã‚’åºƒã’ã‚‹ */
                max-width: 1200px;  /* æœ€å¤§å¹…ã‚’å¢—ã‚„ã™ */
                aspect-ratio: 3/2;
                margin: 0 auto;
                overflow: hidden;
                border-radius: 20px;
                box-shadow: 0 10px 30px rgba(0,0,0,.2);
            }

            /* ã‚²ãƒ¼ãƒ ç”»é¢ã‚µã‚¤ã‚ºä¿®æ­£ */
            .game-screen {
                position: absolute;
                width: 100%;
                height: 100%;
                background-size: cover;  /* containã‹ã‚‰coverã«å¤‰æ›´ */
                background-position: center;
                background-repeat: no-repeat;
                display: none;
            }

            /* é·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä¿®æ­£ */
            .stage-transition, .clear-screen {
                transition: opacity 0.3s ease;  /* ã‚¹ãƒ ãƒ¼ã‚ºãªé·ç§»ã®ãŸã‚ */
                opacity: 0;
            }

            .stage-transition.active, .clear-screen.active {
                opacity: 1;
            }

            /* ç”»é¢é·ç§»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
            .story-screen, .game-screen, .title-screen, .clear-screen, .ending-screen {
                transition: opacity 0.8s ease;
            }


            /* BGMæ“ä½œãƒœã‚¿ãƒ³ */
            .sound-control {
                position: absolute;
                top: 20px;
                right: 80px; /* ãƒ’ãƒ³ãƒˆãƒœã‚¿ãƒ³ã®æ¨ª */
                background-color: rgba(255, 255, 255, 0.7);
                color: #6a3093;
                border: none;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                font-size: 1.2em;
                cursor: pointer;
                z-index: 5;
                display: flex;
                justify-content: center;
                align-items: center;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                transition: all 0.3s ease;
            }

            .sound-control:hover {
                background-color: rgba(255, 255, 255, 0.9);
                transform: scale(1.1);
            }

        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ -->
        <div class="title-screen" id="titleScreen">
            <div class="title-overlay"></div>
            <div class="title-content">
                <h1>å¤¢ã®å¢ƒç•Œç·š</h1>
                <p>-ä¸æ€è­°ãªéƒ¨å±‹ã‹ã‚‰ã®è„±å‡º-</p>
                <p>ç—…å®¤ã§çœ ã‚‹å°‘å¥³ã®å¤¢ã®ä¸–ç•Œã«è¿·ã„è¾¼ã‚“ã ã‚ãªãŸã€‚<br>ç¾å®Ÿã«æˆ»ã‚‹ãŸã‚ã«ã¯ã€å¤¢ã®ä¸–ç•Œã®ã€ŒãŠã‹ã—ãªã¨ã“ã‚ã€ã‚’è¦‹ã¤ã‘ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚</p>
                <button class="button" id="startButton">ç‰©èªã‚’è¦‹ã‚‹</button>
            </div>
        </div>
        
        <!-- ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç”»é¢ -->
        <div class="story-screen" id="storyScreen">
            <div class="story-content">
                <h2>å°‘å¥³ã¨ã‚ãªãŸã®ç‰©èª</h2>
                <img src="assets/story_hospital.png" alt="ç—…å®¤ã®å°‘å¥³" class="story-image">
                <p>ãã®å°‘å¥³ã®åå‰ã¯ç¾æœˆã€‚é•·ã„é–“ã€åŸå› ä¸æ˜ã®ç—…æ°—ã¨é—˜ã„ç¶šã‘ã¦ã„ã¾ã—ãŸã€‚<br>
                ç™½ã„ç—…å®¤ã®çª“ã‹ã‚‰è¦‹ãˆã‚‹ç©ºã‚’çœºã‚ãªãŒã‚‰ã€å½¼å¥³ã¯ã„ã¤ã‚‚å¤¢æƒ³ã—ã¦ã„ã¾ã—ãŸã€‚</p>
                
                <p>ã€Œã­ã‡ã€ã‚ã®é›²ã®å‘ã“ã†ã«ã¯ä½•ãŒã‚ã‚‹ã®ã‹ãªï¼Ÿã€<br>
                ç¾æœˆã¯ã¼ã‚“ã‚„ã‚Šã¨ã—ãŸç›®ã§ç©ºã‚’è¦‹ä¸Šã’ã€ãã†ã¤ã¶ã‚„ãã¾ã™ã€‚</p>
                
                <img src="assets/story_dream.png" alt="å¤¢ã®ä¸–ç•Œã¸ã®å…¥ã‚Šå£" class="story-image">
                
                <p>ã‚ã‚‹å¤œã€ã‚ãªãŸã¯ä¸æ€è­°ãªå…‰ã«å°ã‹ã‚Œã‚‹ã‚ˆã†ã«ã€ç¾æœˆã®å¤¢ã®ä¸­ã«è¿·ã„è¾¼ã¿ã¾ã—ãŸã€‚<br>
                ãã“ã¯å½¼å¥³ã®è¨˜æ†¶ã¨é¡˜ã„ãŒæ··ã–ã‚Šåˆã£ãŸã€ç¾å®Ÿã¨ã‚‚å¹»æƒ³ã¨ã‚‚ã¤ã‹ãªã„ä¸–ç•Œã€‚</p>
                
                <p>ã—ã‹ã—ã€ã“ã®å¤¢ã®ä¸–ç•Œã«ã¯ã€ŒãŠã‹ã—ãªã¨ã“ã‚ã€ãŒã‚ã‚Šã¾ã™ã€‚<br>
                ç¾æœˆã®æ„è­˜ãŒå¼±ã¾ã‚‹ã«ã¤ã‚Œã€å¤¢ã®ä¸–ç•Œã®å¢ƒç•Œç·šãŒæ›–æ˜§ã«ãªã‚Šã€ç¾å®Ÿã®è¨˜æ†¶ãŒæ­ªã‚“ã§ã—ã¾ã£ãŸã®ã§ã™ã€‚</p>
                
                <img src="assets/story_distortion.png" alt="æ­ªã‚“ã å¤¢ã®ä¸–ç•Œ" class="story-image">
                
                <p>ã€Œã“ã®ä¸–ç•Œã®ãŠã‹ã—ãªã¨ã“ã‚ã‚’ç›´ã—ã¦ã„ã‹ãªã„ã¨ã€ç¾æœˆã¯æ°¸é ã«å¤¢ã®ä¸­ã«é–‰ã˜è¾¼ã‚ã‚‰ã‚Œã¦ã—ã¾ã†ã‹ã‚‚ã—ã‚Œãªã„â€¦ã€</p>
                
                <p>ãã‚“ãªäºˆæ„ŸãŒã—ãŸç¬é–“ã€ã‚ãªãŸã®å‰ã«æœ€åˆã®éƒ¨å±‹ãŒå§¿ã‚’ç¾ã—ã¾ã—ãŸã€‚<br>
                ç¾æœˆã®å¤§åˆ‡ãªæ€ã„å‡ºãŒè©°ã¾ã£ãŸã€Œæ€ã„å‡ºã®ãƒªãƒ“ãƒ³ã‚°ã€ã§ã™ã€‚</p>
                
                <div class="story-button-container">
                    <button class="button" id="storyNextButton">æ¢ç´¢ã‚’å§‹ã‚ã‚‹</button>
                </div>
            </div>
        </div>
        
        <!-- ã‚¹ãƒ†ãƒ¼ã‚¸é–“é·ç§»ç”»é¢ -->
        <div class="stage-transition" id="stageTransition">
            <div class="transition-content">
                <h2 id="transitionTitle">æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸</h2>
                <img id="transitionImage" src="" alt="ã‚¹ãƒ†ãƒ¼ã‚¸é·ç§»" class="transition-image">
                <p id="transitionText">æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã«é€²ã¿ã¾ã™...</p>
                <button class="button" id="transitionNextButton">æ¬¡ã¸é€²ã‚€</button>
            </div>
        </div>
        
        <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
        <div class="game-screen" id="gameScreen">
            <!-- ã‚¹ãƒ†ãƒ¼ã‚¸æƒ…å ± -->
            <div class="stage-info" id="stageInfo">ã‚¹ãƒ†ãƒ¼ã‚¸1: æ€ã„å‡ºã®ãƒªãƒ“ãƒ³ã‚°</div>
            
            <!-- é–“é•ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
            <div class="error-layer" id="errorLayer">
                <!-- å„ã‚¹ãƒ†ãƒ¼ã‚¸ã”ã¨ã®é–“é•ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯JSã§å‹•çš„ã«è¿½åŠ  -->
            </div>
            
            <!-- é€²è¡Œåº¦è¡¨ç¤º -->
            <div class="progress-container">
                <div class="progress-text">è¦‹ã¤ã‘ãŸã€ŒãŠã‹ã—ãªã¨ã“ã‚ã€: </div>
                <div class="progress-dots">
                    <div class="progress-dot" id="dot1"></div>
                    <div class="progress-dot" id="dot2"></div>
                    <div class="progress-dot" id="dot3"></div>
                </div>
            </div>
            
            <!-- ãƒ’ãƒ³ãƒˆãƒœã‚¿ãƒ³ -->
            <!-- <button class="hint-button" id="hintButton">?</button> -->

            <!-- BGMæ“ä½œãƒœã‚¿ãƒ³ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ -->
            <!-- <button class="sound-control" id="bgmControl" title="BGM ON/OFF">ğŸµ</button> -->

            <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º -->
            <div class="message" id="message"></div>
            
            <!-- ã‚¯ãƒªãƒƒã‚¯åˆ¤å®šç”¨ã®ã‚­ãƒ£ãƒ³ãƒã‚¹ï¼ˆéè¡¨ç¤ºï¼‰ -->
            <canvas id="hitCanvas" style="display: none;"></canvas>
        </div>
        
        <!-- ã‚¯ãƒªã‚¢ç”»é¢ -->
        <div class="clear-screen" id="clearScreen">
            <div class="clear-content">
                <h2 id="clearTitle">ä¸æ€è­°ãªãƒªãƒ“ãƒ³ã‚°ã®è¨˜æ†¶ãŒä¿®å¾©ã•ã‚Œã¾ã—ãŸ</h2>
                <img id="clearImage" src="assets/clear_stage1.png" alt="ã‚¯ãƒªã‚¢ç”»åƒ" class="clear-image">
                <p id="clearDescription">ãŠã‹ã—ãªã¨ã“ã‚ã‚’å…¨ã¦è¦‹ã¤ã‘ã¾ã—ãŸï¼<br>
                ç¾æœˆã®è¨˜æ†¶ã®ä¸€éƒ¨ãŒæ­£ã—ãä¿®å¾©ã•ã‚Œã¾ã—ãŸã€‚</p>
                <p id="nextStageDescription">ã¾ã ä»–ã«ã‚‚æ­ªã‚“ã å ´æ‰€ãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚<br>
                æ¬¡ã®å ´æ‰€ã¸é€²ã¿ã¾ã—ã‚‡ã†ã€‚</p>
                <button class="button" id="nextStageButton">ç¶šã‘ã‚‹</button>
            </div>
        </div>
        
        <!-- ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ -->
        <div class="ending-screen" id="endingScreen">
            <div class="ending-content">
                <h2>ç›®è¦šã‚ã®ç¬é–“</h2>
                <img src="assets/ending_1.png" alt="ç¾æœˆã®ç›®è¦šã‚" class="ending-image">
                <p>ã™ã¹ã¦ã®ã€ŒãŠã‹ã—ãªã¨ã“ã‚ã€ã‚’ç›´ã—çµ‚ãˆãŸã¨ãã€<br>
                å¤¢ã®ä¸–ç•ŒãŒå…‰ã«åŒ…ã¾ã‚Œå§‹ã‚ã¾ã—ãŸã€‚</p>
                
                <p>ã€Œã‚ã‚ŠãŒã¨ã†â€¦ã‚ãªãŸã®ãŠã‹ã’ã§ã€ã‚ãŸã—ã®è¨˜æ†¶ãŒæˆ»ã£ãŸã‚ˆã€<br>
                ç¾æœˆã®å£°ãŒç©ºé–“å…¨ä½“ã«éŸ¿ãæ¸¡ã‚Šã¾ã™ã€‚</p>
                
                <img src="assets/ending_2.png" alt="ç—…å®¤ã§ã®å†ä¼š" class="ending-image">
                
                <p>æ°—ãŒã¤ãã¨ã€ã‚ãªãŸã¯ç—…é™¢ã®å»Šä¸‹ã«ç«‹ã£ã¦ã„ã¾ã—ãŸã€‚<br>
                ãã—ã¦ã€ãªãœã‹ç¾æœˆã®ç—…å®¤ã®å‰ã«ã„ã‚‹ã“ã¨ã«æ°—ã¥ãã¾ã™ã€‚</p>
                
                <p>éƒ¨å±‹ã‚’è¦—ãã¨ã€ç¾æœˆãŒãƒ™ãƒƒãƒ‰ã«åº§ã‚Šã€çª“ã®å¤–ã‚’è¦‹ã¤ã‚ã¦ã„ã¾ã—ãŸã€‚<br>
                ã€Œã‚„ã£ã¨ç›®ãŒè¦šã‚ãŸã®ã­ã€ã¨ã€å½¼å¥³ã®ãŠæ¯ã•ã‚“ãŒå–œã³ã®æ¶™ã‚’æµã—ã¦ã„ã¾ã™ã€‚</p>
                
                <img src="assets/ending_3.png" alt="å›å¾©ã—ãŸç¾æœˆ" class="ending-image">
                
                <p>ç¾æœˆã¯ã‚ãªãŸã«æ°—ã¥ãã¨ã€ä¸æ€è­°ãã†ã«ç›®ã‚’è¦‹é–‹ãã¾ã™ã€‚<br>
                ã€Œã‚ãªãŸâ€¦å¤¢ã®ä¸­ã§ä¼šã£ãŸäººã§ã™ã‚ˆã­ï¼Ÿã€</p>
                
                <p>åŒ»å¸«ã«ã‚ˆã‚‹ã¨ã€ç¾æœˆã®æ„è­˜ãŒæˆ»ã‚Šã€ç—‡çŠ¶ã‚‚æ€¥é€Ÿã«æ”¹å–„ã—ã¦ã„ã‚‹ã¨ã®ã“ã¨ã€‚<br>
                é€€é™¢ã¯ã‚‚ã†ç›®å‰ã ãã†ã§ã™ã€‚</p>
                
                <img src="assets/ending_4.png" alt="æœªæ¥ã¸ã®ä¸€æ­©" class="ending-image">
                
                <p>ã‚ãªãŸãŒç«‹ã¡å»ã‚ã†ã¨ã™ã‚‹ã¨ã€ç¾æœˆãŒå°ã•ãªç´™ã‚’ã‚ãªãŸã«æ¸¡ã—ã¾ã—ãŸã€‚<br>
                ãã‚Œã¯å½¼å¥³ãŒæã„ãŸã€ã‚ãªãŸã¨å½¼å¥³ãŒå¤¢ã®ä¸–ç•Œã§å†’é™ºã™ã‚‹å§¿ã®çµµã§ã—ãŸã€‚</p>
                
                <p>ã€Œã¾ãŸä¼šãˆã¾ã™ã‹ï¼Ÿä»Šåº¦ã¯å¤¢ã®ä¸­ã˜ã‚ƒãªãã¦ã€ç¾å®Ÿã®ä¸–ç•Œã§â€¦ã€</p>
                
                <p>ã‚ãªãŸã¯å¾®ç¬‘ã¿ãªãŒã‚‰ã€ãã£ã¨ã­ã¨ç­”ãˆã¾ã—ãŸã€‚</p>
                
                <button class="button" id="endingButton">ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹</button>
            </div>
        </div>
    </div>

    <script>
        // ã‚¹ãƒ†ãƒ¼ã‚¸è¨­å®š
        const stageSettings = [
            {
                id: 1,
                name: "æ€ã„å‡ºã®ãƒªãƒ“ãƒ³ã‚°",
                background: "assets/stage1_bg.png",
                maskImage: "assets/stage1_mask.png",
                errorObjects: [
                    { id: 'clock', color: 'rgb(255, 0, 0)', image: 'assets/stage1_clock_wrong.png', hint: "æ™‚è¨ˆã®é‡ãŒé€†ã•ã¾ã«å‹•ã„ã¦ã„ã¾ã™..." },
                    { id: 'photo', color: 'rgb(0, 255, 0)', image: 'assets/stage1_photo_wrong.png', hint: "å†™çœŸç«‹ã¦ã®å®¶æ—ã®é¡”ãŒæ¶ˆãˆã¦ã„ã¾ã™..." },
                    { id: 'window', color: 'rgb(0, 0, 255)', image: 'assets/stage1_window_wrong.png', hint: "çª“ã®å¤–ã®ç©ºã®è‰²ãŒç¾å®Ÿã¨ã¯é•ã„ã¾ã™..." }
                ],
                clearMessage: "ä¸æ€è­°ãªãƒªãƒ“ãƒ³ã‚°ã®è¨˜æ†¶ãŒä¿®å¾©ã•ã‚Œã¾ã—ãŸ",
                clearDescription: "ãŠã‹ã—ãªã¨ã“ã‚ã‚’å…¨ã¦è¦‹ã¤ã‘ã¾ã—ãŸï¼<br>ç¾æœˆã®è¨˜æ†¶ã®ä¸€éƒ¨ãŒæ­£ã—ãä¿®å¾©ã•ã‚Œã¾ã—ãŸã€‚",
                nextStageMessage: "æ¬¡ã¯ã€Œã‚­ãƒ£ãƒ³ãƒ‡ã‚£ã®éƒ¨å±‹ã€ã‚’æ¢ç´¢ã—ã¾ã—ã‚‡ã†ã€‚<br>ãã“ã«ã¯ç¾æœˆã®é¡˜æœ›ã¨å¤¢ãŒè©°ã¾ã£ã¦ã„ã¾ã™ã€‚"
            },
            {
                id: 2,
                name: "ã‚­ãƒ£ãƒ³ãƒ‡ã‚£ã®éƒ¨å±‹",
                background: "assets/stage2_bg.png",
                maskImage: "assets/stage2_mask.png",
                errorObjects: [
                    { id: 'candy', color: 'rgb(255, 0, 0)', image: 'assets/stage2_candy_wrong.png', hint: "ã‚­ãƒ£ãƒ³ãƒ‡ã‚£ã®è‰²ãŒç¾å®Ÿã«ã¯ã‚ã‚Šå¾—ãªã„..." },
                    { id: 'teddy', color: 'rgb(0, 255, 0)', image: 'assets/stage2_teddy_wrong.png', hint: "ãƒ†ãƒ‡ã‚£ãƒ™ã‚¢ã®ç›®ãŒå‹•ã„ã¦ã„ã‚‹ã‚ˆã†ãª..." },
                    { id: 'mobile', color: 'rgb(0, 0, 255)', image: 'assets/stage2_mobile_wrong.png', hint: "å¤©äº•ã®ãƒ¢ãƒ“ãƒ¼ãƒ«ãŒé‡åŠ›ã‚’ç„¡è¦–ã—ã¦å‹•ã„ã¦ã„ã¾ã™..." }
                ],
                clearMessage: "ã‚­ãƒ£ãƒ³ãƒ‡ã‚£ã®éƒ¨å±‹ã®è¨˜æ†¶ãŒä¿®å¾©ã•ã‚Œã¾ã—ãŸ",
                clearDescription: "ãŠã‹ã—ãªã¨ã“ã‚ã‚’å…¨ã¦è¦‹ã¤ã‘ã¾ã—ãŸï¼<br>ç¾æœˆã®é¡˜æœ›ã¨å¤¢ã®è¨˜æ†¶ãŒæ­£ã—ããªã‚Šã¾ã—ãŸã€‚",
                nextStageMessage: "æœ€å¾Œã¯ã€Œã†ãã¤ãå›³æ›¸é¤¨ã€ã§ã™ã€‚<br>ãã“ã«ã¯ç¾æœˆã®è¨˜æ†¶ã®çœŸå®Ÿã¨å½ã‚ŠãŒéš ã•ã‚Œã¦ã„ã¾ã™ã€‚"
            },
            {
                id: 3,
                name: "ã†ãã¤ãå›³æ›¸é¤¨",
                background: "assets/stage3_bg.png",
                maskImage: "assets/stage3_mask.png",
                errorObjects: [
                    { id: 'book', color: 'rgb(255, 0, 0)', image: 'assets/stage3_book_wrong.png', hint: "ãã®æœ¬ã®ãƒšãƒ¼ã‚¸ãŒé€†ã•ã¾ã«å°åˆ·ã•ã‚Œã¦ã„ã¾ã™..." },
                    { id: 'lamp', color: 'rgb(0, 255, 0)', image: 'assets/stage3_lamp_wrong.png', hint: "ãƒ©ãƒ³ãƒ—ã®å…‰ãŒä¸Šã§ã¯ãªãä¸‹ã«å‘ã‹ã£ã¦ã„ã¾ã™..." },
                    { id: 'shadow', color: 'rgb(0, 0, 255)', image: 'assets/stage3_shadow_wrong.png', hint: "æœ¬æ£šã®å½±ãŒå…‰ã¨åå¯¾æ–¹å‘ã«ä¼¸ã³ã¦ã„ã¾ã™..." }
                ],
                clearMessage: "ã™ã¹ã¦ã®è¨˜æ†¶ãŒä¿®å¾©ã•ã‚Œã¾ã—ãŸ",
                clearDescription: "ãŠã‚ã§ã¨ã†ï¼ã™ã¹ã¦ã®ã€ŒãŠã‹ã—ãªã¨ã“ã‚ã€ã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚<br>ç¾æœˆã®è¨˜æ†¶ãŒå®Œå…¨ã«ä¿®å¾©ã•ã‚Œã¾ã—ãŸã€‚",
                nextStageMessage: "å½¼å¥³ã¯ã‚‚ã†ã™ãç›®ã‚’è¦šã¾ã—ã€ç¾å®Ÿä¸–ç•Œã«æˆ»ã‚Šã¾ã™ã€‚<br>ã‚ãªãŸã®ãŠã‹ã’ã§ã€ç¾æœˆã¯æ–°ãŸãªä¸€æ­©ã‚’è¸ã¿å‡ºã›ã‚‹ã§ã—ã‚‡ã†ã€‚"
            }
        ];
        
        // ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
        const gameState = {
            currentStage: 0,  // 0ã¯ã‚¹ãƒ†ãƒ¼ã‚¸é¸æŠå‰ã€1ã‹ã‚‰ã‚¹ãƒ†ãƒ¼ã‚¸ç•ªå·
            foundErrors: 0,
            totalErrors: 3,
            isGameStarted: false,
            isStageCleared: false,
            foundObjects: []
        };
        
        // DOMã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆ
        const titleScreen = document.getElementById('titleScreen');
        const storyScreen = document.getElementById('storyScreen');

        const gameScreen = document.getElementById('gameScreen');
        const clearScreen = document.getElementById('clearScreen');
        const stageInfo = document.getElementById('stageInfo');
        const errorLayer = document.getElementById('errorLayer');
        
        const startButton = document.getElementById('startButton');
        const storyNextButton = document.getElementById('storyNextButton');
        const stage1Button = document.getElementById('stage1Button');
        const stage2Button = document.getElementById('stage2Button');
        const stage3Button = document.getElementById('stage3Button');
        const nextStageButton = document.getElementById('nextStageButton');
        const hintButton = document.getElementById('hintButton');
        const message = document.getElementById('message');
        
        const dots = [
            document.getElementById('dot1'),
            document.getElementById('dot2'),
            document.getElementById('dot3')
        ];
        
        // ã‚­ãƒ£ãƒ³ãƒã‚¹è¦ç´ ï¼ˆãƒ’ãƒƒãƒˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
        const hitCanvas = document.getElementById('hitCanvas');
        const hitCtx = hitCanvas.getContext('2d');
        
        // éŸ³å£°åŠ¹æœ
        let clickSound, correctSound, errorSound, clearSound;
        
        // ç”»åƒã®èª­ã¿è¾¼ã¿
        let bgImage, maskImage;
        let errorObjects = [];
        
        // ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–
        function initGame() {
            console.log("ã‚²ãƒ¼ãƒ åˆæœŸåŒ–é–‹å§‹");
            
            // éŸ³å£°ã®èª­ã¿è¾¼ã¿
            loadSounds();
            
            // BGMã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
            setupBGM();

            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
            setupEventListeners();
            
            console.log("ã‚²ãƒ¼ãƒ åˆæœŸåŒ–å®Œäº†");
            console.log("ã‚²ãƒ¼ãƒ çŠ¶æ…‹:", gameState);
        }
        

        // showStoryé–¢æ•°ã‚’ä¿®æ­£
        function showStory() {
            // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆåŠ¹æœã‚’è¿½åŠ 
            titleScreen.style.transition = "opacity 0.8s ease";
            titleScreen.style.opacity = 0;
            
            setTimeout(() => {
                titleScreen.style.display = 'none';
                storyScreen.style.display = 'flex';
                storyScreen.style.opacity = 0; // åˆæœŸçŠ¶æ…‹ã¯é€æ˜
                
                // è¡¨ç¤ºå¾Œã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ã•ã›ã‚‹
                setTimeout(() => {
                    storyScreen.style.transition = "opacity 0.8s ease";
                    storyScreen.style.opacity = 1;
                    storyScreen.classList.add('active');
                }, 50);
            }, 800); // å°‘ã—é•·ã‚ã®å¾…æ©Ÿæ™‚é–“
        }
        
        
        // ã‚¹ãƒ†ãƒ¼ã‚¸é–‹å§‹
        // ã‚¹ãƒ†ãƒ¼ã‚¸é–‹å§‹
        function startStage(stageId) {
            console.log(`ã‚¹ãƒ†ãƒ¼ã‚¸${stageId}ã‚’é–‹å§‹ã—ã¾ã™`);
            
            // ã‚¹ãƒ†ãƒ¼ã‚¸çŠ¶æ…‹åˆæœŸåŒ–
            gameState.currentStage = stageId;
            gameState.foundErrors = 0;
            gameState.isStageCleared = false;
            gameState.foundObjects = [];
            
            // stageIdãŒé…åˆ—ã®ç¯„å›²å†…ã‹ãƒã‚§ãƒƒã‚¯
            if (stageId < 1 || stageId > stageSettings.length) {
                console.error(`ç„¡åŠ¹ãªã‚¹ãƒ†ãƒ¼ã‚¸ID: ${stageId}`);
                return;
            }
            
            const stage = stageSettings[stageId - 1];
            console.log("ã‚¹ãƒ†ãƒ¼ã‚¸è¨­å®š:", stage);
            
            // é€²è¡Œåº¦è¡¨ç¤ºãƒªã‚»ãƒƒãƒˆ
            dots.forEach(dot => dot.classList.remove('found'));
            
            // ã‚¹ãƒ†ãƒ¼ã‚¸æƒ…å ±è¡¨ç¤º
            stageInfo.textContent = `ã‚¹ãƒ†ãƒ¼ã‚¸${stageId}: ${stage.name}`;
            
            // èƒŒæ™¯è¨­å®š
            gameScreen.style.backgroundImage = `url('${stage.background}')`;
            
            // é–“é•ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
            loadStageObjects(stage);
            
            // ãƒã‚¹ã‚¯ç”»åƒèª­ã¿è¾¼ã¿
            loadMaskImage(stage.maskImage);
            
            // ã‚¯ãƒªã‚¢ç”»é¢ãƒ†ã‚­ã‚¹ãƒˆè¨­å®š
            document.getElementById('clearTitle').textContent = stage.clearMessage;
            document.getElementById('clearDescription').innerHTML = stage.clearDescription;
            document.getElementById('nextStageDescription').innerHTML = stage.nextStageMessage;
            
            // æœ€çµ‚ã‚¹ãƒ†ãƒ¼ã‚¸ã®å ´åˆã€ãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›´
            if (stageId === stageSettings.length) {
                nextStageButton.textContent = "ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã¸";
            } else {
                nextStageButton.textContent = "æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸";
            }
            
            // ç”»é¢é·ç§»
            // storyScreenã¨gameScreenã®è¡¨ç¤ºçŠ¶æ…‹ã‚’ç¢ºèª
            console.log("ç”»é¢çŠ¶æ…‹:", {
                "storyScreenè¡¨ç¤º": storyScreen.style.display,
                "gameScreenè¡¨ç¤º": gameScreen.style.display
            });
            
            // ã‚‚ã—ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ãŸã‚‰æ¶ˆã™
            if (storyScreen.style.display !== 'none') {
                storyScreen.classList.remove('active');
                storyScreen.style.display = 'none';
            }
            
            // ã‚²ãƒ¼ãƒ ç”»é¢ã‚’è¡¨ç¤º
            gameScreen.style.display = 'block';
            gameState.isGameStarted = true;
            
            // é–‹å§‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            showMessage(`ã“ã®${stage.name}ã«ã¯3ã¤ã®ã€ŒãŠã‹ã—ãªã¨ã“ã‚ã€ãŒã‚ã‚Šã¾ã™ã€‚è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚`);
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¸ã®é–“é•ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆèª­ã¿è¾¼ã¿
        function loadStageObjects(stage) {
            // æ—¢å­˜ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒªã‚¢
            errorLayer.innerHTML = '';
            errorObjects = [];
            
            // æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ 
            stage.errorObjects.forEach(obj => {
                const imgElement = document.createElement('img');
                imgElement.src = obj.image;
                imgElement.className = 'error-object';
                imgElement.id = obj.id + 'Wrong';
                imgElement.alt = obj.id;
                errorLayer.appendChild(imgElement);
                
                errorObjects.push(imgElement);
            });
        }
        
        // ãƒã‚¹ã‚¯ç”»åƒèª­ã¿è¾¼ã¿
        function loadMaskImage(maskSrc) {
            console.log("ãƒã‚¹ã‚¯ç”»åƒã®èª­ã¿è¾¼ã¿ã‚’é–‹å§‹: " + maskSrc); // ãƒ‡ãƒãƒƒã‚°ç”¨
            
            maskImage = new Image();
            maskImage.src = maskSrc;
            maskImage.onload = function() {
                // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚ºã‚’è¨­å®šï¼ˆãƒã‚¹ã‚¯ç”»åƒã¨åŒã˜ã‚µã‚¤ã‚ºï¼‰
                hitCanvas.width = maskImage.width;
                hitCanvas.height = maskImage.height;
                
                // ãƒã‚¹ã‚¯ç”»åƒã‚’ã‚­ãƒ£ãƒ³ãƒã‚¹ã«æç”»
                hitCtx.drawImage(maskImage, 0, 0);
                console.log("ãƒã‚¹ã‚¯ç”»åƒã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ: " + maskImage.width + "x" + maskImage.height);
                
                // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šã‚­ãƒ£ãƒ³ãƒã‚¹ã®å†…å®¹ã‚’ç¢ºèª
                const imageData = hitCtx.getImageData(0, 0, hitCanvas.width, hitCanvas.height);
                console.log("ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ãƒ”ã‚¯ã‚»ãƒ«ãƒ‡ãƒ¼ã‚¿:", imageData);
            };
            
            // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¿½åŠ 
            maskImage.onerror = function() {
                console.error("ãƒã‚¹ã‚¯ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: " + maskSrc);
            };
        }
        
        // éŸ³å£°ã®èª­ã¿è¾¼ã¿
        function loadSounds() {
            console.log("éŸ³å£°ã®èª­ã¿è¾¼ã¿ã‚’é–‹å§‹");
            
            clickSound = new Audio('assets/click.mp3');
            correctSound = new Audio('assets/correct.mp3');
            errorSound = new Audio('assets/error.mp3');
            clearSound = new Audio('assets/clear.mp3');
            
            // éŸ³é‡èª¿æ•´
            clickSound.volume = 0.2;
            correctSound.volume = 0.25;
            errorSound.volume = 0.15;
            clearSound.volume = 0.3;
            
            // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¿½åŠ 
            [clickSound, correctSound, errorSound, clearSound].forEach(sound => {
                sound.onerror = function() {
                    console.error("éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—: " + sound.src);
                };
                sound.oncanplaythrough = function() {
                    console.log("éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿æˆåŠŸ: " + sound.src);
                };
            });
        }
                
        // ã‚²ãƒ¼ãƒ ç”»é¢ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
        function handleGameClick(e) {
            console.log("ã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ"); // ãƒ‡ãƒãƒƒã‚°ç”¨
            
            if (!gameState.isGameStarted || gameState.isStageCleared) return;
            
            // ã‚¯ãƒªãƒƒã‚¯ä½ç½®ã‚’å–å¾—
            const rect = gameScreen.getBoundingClientRect();
            
            // ã‚­ãƒ£ãƒ³ãƒã‚¹ã¨ã‚²ãƒ¼ãƒ ç”»é¢ã®æ¯”ç‡è¨ˆç®—
            const scaleX = hitCanvas.width / rect.width;
            const scaleY = hitCanvas.height / rect.height;
            
            // ã‚¯ãƒªãƒƒã‚¯ä½ç½®ã‚’ãƒã‚¹ã‚¯ã®åº§æ¨™ç³»ã«å¤‰æ›
            const x = Math.floor((e.clientX - rect.left) * scaleX);
            const y = Math.floor((e.clientY - rect.top) * scaleY);
            
            // ã‚¯ãƒªãƒƒã‚¯éŸ³
            clickSound.play();
            
            console.log(`åº§æ¨™å¤‰æ›å¾Œ: (${x}, ${y})`); // ãƒ‡ãƒãƒƒã‚°ç”¨
            console.log(`ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚µã‚¤ã‚º: ${hitCanvas.width}x${hitCanvas.height}`); // ãƒ‡ãƒãƒƒã‚°ç”¨
            
            // åº§æ¨™ãŒç¯„å›²å†…ã‹ãƒã‚§ãƒƒã‚¯
            if (x >= 0 && x < hitCanvas.width && y >= 0 && y < hitCanvas.height) {
                // ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ãƒ”ã‚¯ã‚»ãƒ«è‰²ã‚’å–å¾—ã—ã¦ãƒ’ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
                const pixel = hitCtx.getImageData(x, y, 1, 1).data;
                const pixelColor = `rgb(${pixel[0]}, ${pixel[1]}, ${pixel[2]})`;
                
                console.log(`ã‚¯ãƒªãƒƒã‚¯ä½ç½®: (${x}, ${y}), è‰²: ${pixelColor}`);
                
                // ã‚¨ãƒ©ãƒ¼é ˜åŸŸã®åˆ¤å®š
                const stage = stageSettings[gameState.currentStage - 1];
                let errorIndex = -1;
                
                for (let i = 0; i < stage.errorObjects.length; i++) {
                    const obj = stage.errorObjects[i];
                    console.log(`æ¯”è¼ƒä¸­: ${obj.id}, è‰²: ${obj.color}`); // ãƒ‡ãƒãƒƒã‚°ç”¨
                    // å®Œå…¨ä¸€è‡´ã ã‘ã§ãªãã€è¿‘ä¼¼ä¸€è‡´ã‚‚è¨±å®¹ã™ã‚‹
                    if (isColorMatch(pixel, obj.color) && !gameState.foundObjects.includes(obj.id)) {
                        errorIndex = i;
                        console.log(`ä¸€è‡´ã—ã¾ã—ãŸ: ${obj.id}`); // ãƒ‡ãƒãƒƒã‚°ç”¨
                        break;
                    }
                }
                
                // è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’è¡¨ç¤º
                showFeedback(e.clientX - rect.left, e.clientY - rect.top);
                
                if (errorIndex !== -1) {
                    // æ­£è§£å‡¦ç†
                    handleCorrect(errorIndex, e.clientX - rect.left, e.clientY - rect.top);
                } else {
                    // ä¸æ­£è§£å‡¦ç†
                    errorSound.play();
                    showMessage("ã“ã“ã«ã¯ç•°å¸¸ã¯ãªã„ã‚ˆã†ã§ã™...");
                }
            } else {
                // ç¯„å›²å¤–ã‚¯ãƒªãƒƒã‚¯
                errorSound.play();
                showMessage("ã“ã“ã«ã¯ä½•ã‚‚ãªã„ã‚ˆã†ã§ã™...");
            }
        }

        // è‰²ã®è¿‘ä¼¼ä¸€è‡´åˆ¤å®š
        function isColorMatch(pixelData, targetColor) {
            // targetColorã‹ã‚‰RGBå€¤ã‚’æŠ½å‡º
            console.log("è‰²ä¸€è‡´ã‚’ç¢ºèªä¸­:", pixelData, targetColor);
            
            const targetMatch = targetColor.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);
            if (!targetMatch) {
                console.error("ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè‰²ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒä¸æ­£:", targetColor);
                return false;
            }
            
            const targetR = parseInt(targetMatch[1], 10);
            const targetG = parseInt(targetMatch[2], 10);
            const targetB = parseInt(targetMatch[3], 10);
            
            // pixelDataã‹ã‚‰ç›´æ¥RGBå€¤ã‚’å–å¾—
            const r = pixelData[0];
            const g = pixelData[1];
            const b = pixelData[2];
            
            // å„è‰²ã®å·®åˆ†ã‚’è¨ˆç®—
            const rDiff = Math.abs(r - targetR);
            const gDiff = Math.abs(g - targetG);
            const bDiff = Math.abs(b - targetB);
            
            // ã‚ˆã‚Šå¯›å®¹ãªè¨±å®¹èª¤å·®ï¼ˆå„è‰²æˆåˆ†ã«å¯¾ã—ã¦50ã®å·®ã¾ã§è¨±å®¹ï¼‰
            const tolerance = 50;
            
            // ã„ãšã‚Œã‹ã®è‰²æˆåˆ†ãŒå¼·ã„å ´åˆã‚‚ä¸€è‡´ã¨åˆ¤å®š
            const isMatch = (rDiff <= tolerance && gDiff <= tolerance && bDiff <= tolerance) ||
                        (r > 200 && targetR > 200) ||  // èµ¤ãŒå¼·ã„
                        (g > 200 && targetG > 200) ||  // ç·‘ãŒå¼·ã„
                        (b > 200 && targetB > 200);    // é’ãŒå¼·ã„
            
            console.log(`è‰²æ¯”è¼ƒ: [${r},${g},${b}] vs [${targetR},${targetG},${targetB}], ä¸€è‡´: ${isMatch}`);
            return isMatch;
        }
        
        // æ­£è§£å‡¦ç†
        function handleCorrect(index, x, y) {
            correctSound.play();
            
            const stage = stageSettings[gameState.currentStage - 1];
            const obj = stage.errorObjects[index];
            
            gameState.foundObjects.push(obj.id);
            gameState.foundErrors++;
            
            // é€²è¡Œåº¦è¡¨ç¤ºã®æ›´æ–°
            dots[gameState.foundErrors - 1].classList.add('found');
            
            // ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯è¡¨ç¤º
            showCheckMark(x, y);
            
            // ã‚¨ãƒ©ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
            let errorObject = document.getElementById(obj.id + 'Wrong');
            
            if (errorObject) {
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ
                errorObject.style.animation = 'correct 1s ease';
                
                // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                switch(obj.id) {
                    case 'clock':
                        showMessage("æ™‚è¨ˆã®é‡ãŒæ­£ã—ã„å‘ãã«ãªã‚Šã¾ã—ãŸï¼");
                        break;
                    case 'photo':
                        showMessage("å†™çœŸç«‹ã¦ãŒå…ƒã«æˆ»ã‚Šã¾ã—ãŸï¼");
                        break;
                    case 'window':
                        showMessage("çª“ã®å¤–ã®ç©ºã®è‰²ãŒæ­£ã—ããªã‚Šã¾ã—ãŸï¼");
                        break;
                    case 'candy':
                        showMessage("ã‚­ãƒ£ãƒ³ãƒ‡ã‚£ãŒå…ƒã«æˆ»ã‚Šã¾ã—ãŸï¼");
                        break;
                    case 'teddy':
                        showMessage("ãƒ†ãƒ‡ã‚£ãƒ™ã‚¢ãŒæ­£å¸¸ã«ãªã‚Šã¾ã—ãŸï¼");
                        break;
                    case 'mobile':
                        showMessage("å¤©äº•ã®ãƒ¢ãƒ“ãƒ¼ãƒ«ãŒå…ƒã«æˆ»ã‚Šã¾ã—ãŸï¼");
                        break;
                    case 'book':
                        showMessage("æœ¬ã®ç›®ãŒæ¶ˆãˆã¾ã—ãŸï¼");
                        break;
                    case 'lamp':
                        showMessage("ãƒ©ãƒ³ãƒ—ãŒæ™®é€šã®å…‰ã«æˆ»ã£ã¦ã„ã¾ã™ï¼");
                        break;
                    case 'shadow':
                    showMessage("å¦™ãªå½±ãŒæ¶ˆãˆã¦ã„ãã¾ã™ï¼");
                        break;
                    default:
                        showMessage("ãŠã‹ã—ãªã¨ã“ã‚ãŒç›´ã‚Šã¾ã—ãŸï¼");
                }
                
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
                setTimeout(() => {
                    errorObject.style.opacity = 0;
                    
                    // ã™ã¹ã¦ã®é–“é•ã„ãŒè¦‹ã¤ã‹ã£ãŸã‚‰ã‚¯ãƒªã‚¢
                    if (gameState.foundErrors === gameState.totalErrors) {
                        setTimeout(clearStage, 1500);
                    }
                }, 1000);
            }
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
        function setupEventListeners() {
            console.log("ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šä¸­...");
            
            startButton.addEventListener('click', showStory);
            // storyNextButton.addEventListener('click', () => startStage(1));
            // ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‹ã‚‰æ¢ç´¢ã¸ã®é·ç§»ã‚’ä¿®æ­£
            storyNextButton.addEventListener('click', function() {
                // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆåŠ¹æœ
                storyScreen.style.transition = "opacity 0.8s ease";
                storyScreen.style.opacity = 0;
                
                setTimeout(() => {
                    storyScreen.style.display = 'none';
                    // ã‚²ãƒ¼ãƒ ç”»é¢ã‚’æº–å‚™ã™ã‚‹ãŒã€ã¾ã è¡¨ç¤ºã—ãªã„
                    gameScreen.style.display = 'block';
                    gameScreen.style.opacity = 0;
                    
                    // ã‚¹ãƒ†ãƒ¼ã‚¸1ã‚’é–‹å§‹
                    startStage(1);
                    
                    // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³åŠ¹æœ
                    setTimeout(() => {
                        gameScreen.style.transition = "opacity 0.8s ease";
                        gameScreen.style.opacity = 1;
                    }, 50);
                }, 800);
            });


            nextStageButton.addEventListener('click', goToNextStage);
            
            // ãƒ’ãƒ³ãƒˆãƒœã‚¿ãƒ³ã®ãƒ‡ãƒãƒƒã‚°
            console.log("ãƒ’ãƒ³ãƒˆãƒœã‚¿ãƒ³è¦ç´ :", hintButton);
            if (hintButton) {
                hintButton.addEventListener('click', function() {
                    console.log("ãƒ’ãƒ³ãƒˆãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ");
                    showHint();
                });
            } else {
                console.error("ãƒ’ãƒ³ãƒˆãƒœã‚¿ãƒ³è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
            }
            
            // ã‚²ãƒ¼ãƒ ç”»é¢ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
            gameScreen.addEventListener('click', function(e) {
                console.log("ã‚²ãƒ¼ãƒ ç”»é¢ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ");
                handleGameClick(e);
            });

            const bgmControl = document.getElementById('bgmControl');
            if (bgmControl) {
                bgmControl.addEventListener('click', toggleBGM);
            }

        }

        
        // BGMã®ON/OFFåˆ‡ã‚Šæ›¿ãˆ
        function toggleBGM() {
            if (bgmPlayer) {
                if (bgmPlayer.paused) {
                    bgmPlayer.play();
                    document.getElementById('bgmControl').textContent = 'ğŸµ';
                } else {
                    bgmPlayer.pause();
                    document.getElementById('bgmControl').textContent = 'ğŸ”‡';
                }
            }
        }

        // ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯è¡¨ç¤º
        function showCheckMark(x, y) {
            const checkMark = document.createElement('div');
            checkMark.className = 'check-mark';
            checkMark.style.left = (x - 30) + 'px'; // ä¸­å¿ƒã«è¡¨ç¤ºã™ã‚‹ãŸã‚åŠåˆ†ã®ã‚µã‚¤ã‚ºã‚’ã‚ªãƒ•ã‚»ãƒƒãƒˆ
            checkMark.style.top = (y - 30) + 'px';
            
            gameScreen.appendChild(checkMark);
            
            // 3ç§’å¾Œã«æ¶ˆã™
            setTimeout(() => {
                gameScreen.removeChild(checkMark);
            }, 3000);
        }
        
        // ã‚¯ãƒªãƒƒã‚¯ä½ç½®ã«è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’è¡¨ç¤º
        function showFeedback(x, y) {
            const feedback = document.createElement('div');
            feedback.className = 'feedback';
            feedback.style.left = x + 'px';
            feedback.style.top = y + 'px';
            feedback.style.width = '30px';
            feedback.style.height = '30px';
            
            gameScreen.appendChild(feedback);
            
            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†å¾Œã«è¦ç´ ã‚’å‰Šé™¤
            setTimeout(() => {
                gameScreen.removeChild(feedback);
            }, 800);
        }
        
        function showMessage(text) {
            console.log("ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º:", text);
            
            message.textContent = text;
            message.classList.add('show');
            
            // 3ç§’å¾Œã«æ¶ˆã™
            setTimeout(() => {
                message.classList.remove('show');
            }, 3000);
        }
        
        // ãƒ’ãƒ³ãƒˆè¡¨ç¤º
        function showHint() {
            // ã¾ã è¦‹ã¤ã‹ã£ã¦ã„ãªã„ãŠã‹ã—ãªã¨ã“ã‚ã®ãƒ’ãƒ³ãƒˆã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«è¡¨ç¤º
            const notFoundIndexes = [];
            const stage = stageSettings[gameState.currentStage - 1];
            
            stage.errorObjects.forEach((obj, index) => {
                if (!gameState.foundObjects.includes(obj.id)) {
                    notFoundIndexes.push(index);
                }
            });
            
            if (notFoundIndexes.length > 0) {
                const randomIndex = notFoundIndexes[Math.floor(Math.random() * notFoundIndexes.length)];
                showMessage(stage.errorObjects[randomIndex].hint);
            } else {
                showMessage("ã™ã¹ã¦ã®ã€ŒãŠã‹ã—ãªã¨ã“ã‚ã€ã‚’è¦‹ã¤ã‘ã¾ã—ãŸï¼");
            }
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢
        // clearStageé–¢æ•°ã®ä¿®æ­£
        function clearStage() {
            console.log("ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢å‡¦ç†ã‚’é–‹å§‹");
            
            try {
                clearSound.play();
            } catch (e) {
                console.error("éŸ³å£°å†ç”Ÿã‚¨ãƒ©ãƒ¼:", e);
            }
            
            gameState.isStageCleared = true;
            
            // ã‚¯ãƒªã‚¢ç”»é¢è¡¨ç¤ºå‰ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã‚’ãƒªã‚»ãƒƒãƒˆ
            clearScreen.scrollTop = 0;
            
            // ã‚¯ãƒªã‚¢ç”»é¢è¡¨ç¤º
            clearScreen.style.display = 'block'; // flexã§ã¯ãªãblockã«å¤‰æ›´
            clearScreen.style.opacity = '1';
            
            setTimeout(() => {
                clearScreen.classList.add('active');
                console.log("ã‚¯ãƒªã‚¢ç”»é¢ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ");
            }, 50);
        }
                

        // æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸

        function goToNextStage() {
            // ã‚¯ãƒªã‚¢ç”»é¢ã‚’é–‰ã˜ã‚‹
            clearScreen.classList.remove('active');
            clearScreen.style.opacity = 0;
            
            setTimeout(() => {
                clearScreen.style.display = 'none';
                
                // æœ€çµ‚ã‚¹ãƒ†ãƒ¼ã‚¸ã ã£ãŸå ´åˆã¯ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°
                if (gameState.currentStage === stageSettings.length) {
                    // ã‚²ãƒ¼ãƒ ç”»é¢ã‚’ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
                    gameScreen.style.opacity = 0;
                    
                    setTimeout(() => {
                        showEnding();
                    }, 500);
                } else {
                    // ã‚²ãƒ¼ãƒ ç”»é¢ã‚’å®Œå…¨ã«éè¡¨ç¤ºã«ã™ã‚‹
                    gameScreen.style.opacity = 0;
                    
                    setTimeout(() => {
                        // æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’æº–å‚™ã—ã¦é–‹å§‹
                        const nextStageId = gameState.currentStage + 1;
                        startStage(nextStageId);
                        
                        // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³
                        setTimeout(() => {
                            gameScreen.style.opacity = 1;
                        }, 100);
                    }, 500); // ååˆ†ãªå¾…æ©Ÿæ™‚é–“ã§ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆã‚’å®Œäº†ã•ã›ã‚‹
                }
            }, 800);
        }
        
        // ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º

        function showEnding() {
            console.log("ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºå‡¦ç†ã‚’é–‹å§‹");
            
            const endingScreen = document.getElementById('endingScreen');
            if (!endingScreen) {
                console.error("ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
                return; // ã‚¨ãƒ©ãƒ¼å›é¿
            }
            
            // ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’è¡¨ç¤º
            gameScreen.style.display = 'none';
            endingScreen.style.display = 'block';
            
            setTimeout(() => {
                endingScreen.classList.add('active');
                console.log("ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ");
            }, 50);
            
            // ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
            const endingButton = document.getElementById('endingButton');
            if (endingButton) {
                // æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤ï¼ˆé‡è¤‡é˜²æ­¢ï¼‰
                endingButton.removeEventListener('click', resetGame);
                
                // æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
                endingButton.addEventListener('click', resetGame);
            }
        }
        // ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆé–¢æ•°
        function resetGame() {
            console.log("ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™");
            
            const endingScreen = document.getElementById('endingScreen');
            endingScreen.classList.remove('active');
            
            setTimeout(() => {
                endingScreen.style.display = 'none';
                titleScreen.style.display = 'flex';
                titleScreen.style.opacity = '1';
                
                // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ
                gameState.currentStage = 0;
                gameState.foundErrors = 0;
                gameState.isGameStarted = false;
                gameState.isStageCleared = false;
                gameState.foundObjects = [];
                
                console.log("ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ");
            }, 500);
        }

        // BGMç®¡ç†ç”¨ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
        let bgmPlayer = null;

        // BGMã®èª­ã¿è¾¼ã¿ã¨å†ç”Ÿ
        function setupBGM() {
            // BGMç”¨ã®ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªè¦ç´ ã‚’ä½œæˆ
            bgmPlayer = new Audio('assets/bgm.mp3'); // BGMãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’æŒ‡å®š
            bgmPlayer.loop = true; // ãƒ«ãƒ¼ãƒ—å†ç”Ÿ
            bgmPlayer.volume = 0.15; // éŸ³é‡ï¼ˆ0.0ã€œ1.0ï¼‰
            
            // BGMèª­ã¿è¾¼ã¿å®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆ
            bgmPlayer.addEventListener('canplaythrough', function() {
                console.log("BGMèª­ã¿è¾¼ã¿å®Œäº†");
            });
            
            // BGMå†ç”Ÿã‚¨ãƒ©ãƒ¼å‡¦ç†
            bgmPlayer.addEventListener('error', function(e) {
                console.error("BGMå†ç”Ÿã‚¨ãƒ©ãƒ¼:", e);
            });
            
            // ãƒšãƒ¼ã‚¸å†…ã‚¯ãƒªãƒƒã‚¯ã§BGMå†ç”Ÿï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®è‡ªå‹•å†ç”Ÿåˆ¶é™å¯¾ç­–ï¼‰
            document.addEventListener('click', startBGM, { once: true });
        }

        // BGMå†ç”Ÿé–‹å§‹
        function startBGM() {
            if (bgmPlayer) {
                // playPromiseã‚’ä½¿ã£ã¦å†ç”Ÿã‚’è©¦ã¿ã‚‹
                const playPromise = bgmPlayer.play();
                
                // play()ãŒPromiseã‚’è¿”ã™å ´åˆã®å‡¦ç†
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        console.log("BGMå†ç”Ÿé–‹å§‹");
                    }).catch(error => {
                        console.error("BGMè‡ªå‹•å†ç”Ÿã§ãã¾ã›ã‚“ã§ã—ãŸ:", error);
                        // BGMå†ç”Ÿãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹ãªã©ã®å¯¾å¿œã‚‚å¯èƒ½
                    });
                }
            }
        }

        
        // ã‚²ãƒ¼ãƒ åˆæœŸåŒ–
        window.onload = initGame;
    </script>
</body>
</html>