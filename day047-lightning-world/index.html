<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- OGP (Open Graph Protocol) -->
    <meta property="og:title" content="Ê•Ω„Åó„ÅÑÈõ∑„ÅÆ‰∏ñÁïå - „Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„ÉñÈõ∑„Ç®„Éï„Çß„ÇØ„ÉàÔºÜ„Ç≤„Éº„É†" />
    <meta property="og:description" content="Áæé„Åó„ÅÑÈõ∑„Ç®„Éï„Çß„ÇØ„Éà„Å®Êò†„Åà„Çã„Çø„Éº„Ç≤„ÉÉ„Éà„Ç≤„Éº„É†„ÇíÊ•Ω„Åó„ÇÅ„Çã„Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„Éñ„Ç¢„Éó„É™„ÄÇ„Åï„Åæ„Åñ„Åæ„Å™„ÉÜ„Éº„Éû„ÄÅËá™ÂãïÂÜçÁîü„ÄÅÈõ£ÊòìÂ∫¶Ë®≠ÂÆö„ÅåÂèØËÉΩ„ÄÇ" />
    <meta property="og:image" content="https://hiroe28.github.io/llm-100days-challenge/day047-lightning-world/screenshot.png" />
    <meta property="og:url" content="https://hiroe28.github.io/llm-100days-challenge/day047-lightning-world/index.html" />
    <meta property="og:type" content="website" />
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Ê•Ω„Åó„ÅÑÈõ∑„ÅÆ‰∏ñÁïå" />
    <meta name="twitter:description" content="„Çø„ÉÉ„Éó„ÅßÁæé„Åó„ÅÑÈõ∑„Ç®„Éï„Çß„ÇØ„Éà„ÇíÁîüÊàê„ÄÇ3„Å§„ÅÆ„ÉÜ„Éº„Éû„Å®Èõ£ÊòìÂ∫¶Ë™øÊï¥ÂèØËÉΩ„Å™„Ç≤„Éº„É†„É¢„Éº„Éâ„ÇíÊê≠Ëºâ„Åó„Åü„Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„Éñ‰ΩìÈ®ì„ÄÇ" />
    <meta name="twitter:image" content="https://hiroe28.github.io/llm-100days-challenge/day047-lightning-world/screenshot.png" />

    <title>Ê•Ω„Åó„ÅÑÈõ∑„ÅÆ‰∏ñÁïå - Êò†„Åà„Çã„Ç§„É≥„Çø„É©„ÇØ„ÉÜ„Ç£„Éñ„Ç®„Éï„Çß„ÇØ„Éà</title>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3201351704984910"
            crossorigin="anonymous"></script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-H1SW0RH6CK"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-H1SW0RH6CK');
    </script>
    

    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'M PLUS Rounded 1c', -apple-system, BlinkMacSystemFont, sans-serif;
            touch-action: manipulation;
            position: relative;
            background-color: #000;
            height: 100%;
            width: 100%;
        }
        
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@500;700&display=swap');
        
        .container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            cursor: pointer;
        }
        
        .background {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, 
                #0f1b38 0%, 
                #1a2a59 25%, 
                #2b3969 50%, 
                #1f2445 75%, 
                #0f1123 100%);
            z-index: 1;
            transition: background 1.5s ease;
        }
        
        .background.sunset {
            background: linear-gradient(to bottom, 
                #ff7e00 0%, 
                #ff9a44 25%, 
                #2b3969 70%, 
                #1f2445 85%, 
                #0f1123 100%);
        }
        
        .background.fantasy {
            background: linear-gradient(to bottom, 
                #5d3a9e 0%, 
                #7349c1 25%, 
                #453c8c 60%, 
                #322a6c 80%, 
                #221b4a 100%);
        }
        
        .moon {
            position: absolute;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: radial-gradient(circle at 40% 40%, #ffffff 0%, #d8d8eb 60%, #a9a9c9 100%);
            box-shadow: 0 0 30px #d8d8eb80, 0 0 60px #a9a9c920;
            top: 60px;
            right: 80px;
            z-index: 2;
            opacity: 0.85;
            transition: all 1.5s ease;
        }
        
        .moon.sunset {
            background: radial-gradient(circle at 40% 40%, #ffe7c8 0%, #ffc68a 60%, #ff9e44 100%);
            box-shadow: 0 0 30px #ffb76b80, 0 0 60px #ff7e0020;
        }
        
        .moon.fantasy {
            background: radial-gradient(circle at 40% 40%, #e4c8ff 0%, #c49aff 60%, #9e44ff 100%);
            box-shadow: 0 0 30px #c49aff80, 0 0 60px #9e44ff20;
            animation: pulse 4s infinite alternate;
        }
        
        .stars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            opacity: 0.7;
            transition: opacity 1.5s ease;
        }
        
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            opacity: 0;
            animation: twinkle var(--twinkle-duration, 4s) infinite var(--twinkle-delay, 0s);
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0; }
            50% { opacity: var(--star-opacity, 0.8); }
        }
        
        .lightning-container {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            z-index: 20;
            transition: opacity 0.1s;
        }
        
        .ui-container {
            position: absolute;
            bottom: 10px;
            left: 0;
            right: 0;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* „Éú„Çø„É≥„Ç≥„É≥„ÉÜ„Éä„ÅÆ„É¨„Ç§„Ç¢„Ç¶„ÉàÂ§âÊõ¥ */
        .button-container {
            width: 95%;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-bottom: 8px;
            width: 100%;
        }
        
        .mode-selector {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-bottom: 8px;
            width: 100%;
        }
        
        .difficulty-selector {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-bottom: 8px;
            width: 100%;
            display: none;
        }
        
        .theme-selector {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 8px;
            width: 100%;
        }
        
        button {
            background: rgba(46, 51, 90, 0.8);
            color: white;
            border: 2px solid #a3a7cc;
            padding: 8px 12px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 14px;
            font-family: 'M PLUS Rounded 1c', -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 700;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            min-height: 36px;
            touch-action: manipulation;
        }
        
        button:hover {
            background: rgba(74, 82, 138, 0.9);
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        button.active {
            background: rgba(116, 97, 195, 0.9);
            border-color: #c3b2ff;
            box-shadow: 0 0 15px rgba(195, 178, 255, 0.5);
        }
        
        .theme-btn {
            width: 36px;
            height: 36px;
            min-width: 36px;
            min-height: 36px;
            border-radius: 50%;
            padding: 0;
        }
        
        #nightTheme {
            background: radial-gradient(circle, #2b3969 0%, #1a2a59 100%);
        }
        
        #sunsetTheme {
            background: radial-gradient(circle, #ff9a44 0%, #ff7e00 100%);
        }
        
        #fantasyTheme {
            background: radial-gradient(circle, #7349c1 0%, #5d3a9e 100%);
        }
        
        .game-header {
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            z-index: 100;
            pointer-events: none;
        }
        
        .timer-display {
            background: rgba(46, 51, 90, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 24px;
            margin-right: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            border: 2px solid #a3a7cc;
            display: none;
        }
        
        .score-display {
            background: rgba(46, 51, 90, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 24px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            border: 2px solid #a3a7cc;
            display: none;
        }
        
        .combo-display {
            background: rgba(255, 150, 0, 0.7);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 18px;
            margin-left: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            border: 2px solid #ffc266;
            display: none;
            transition: transform 0.2s, background 0.2s;
        }
        
        .combo-display.pulse {
            transform: scale(1.2);
            background: rgba(255, 100, 0, 0.8);
        }
        
        .level-display {
            background: rgba(70, 120, 200, 0.7);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 18px;
            margin-left: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            border: 2px solid #a0c0ff;
            display: none;
        }
        
        .target {
            position: absolute;
            width: 70px;
            height: 70px;
            z-index: 15;
            display: none;
            pointer-events: none;
            animation: pulse 2s infinite;
            transition: width 0.3s, height 0.3s;
        }
        
        .target-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 4px dashed rgba(255, 217, 0, 0.8);
            border-radius: 50%;
            box-sizing: border-box;
        }
        
        .target-inner {
            position: absolute;
            width: 60%;
            height: 60%;
            top: 20%;
            left: 20%;
            background-color: rgba(255, 60, 60, 0.5);
            border-radius: 50%;
            box-sizing: border-box;
        }
        
        .target-center {
            position: absolute;
            width: 20%;
            height: 20%;
            top: 40%;
            left: 40%;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            box-sizing: border-box;
        }
        
        .countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 120px;
            color: white;
            z-index: 200;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(100, 100, 255, 0.8);
            opacity: 0;
            transition: opacity 0.2s, transform 0.5s;
            pointer-events: none;
        }
        
        .countdown.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.2);
        }
        
        .countdown.hide {
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.5);
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 0.7; }
        }
        
        .message-box {
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translateX(-50%) translateY(-50%);
            background: rgba(46, 51, 90, 0.9);
            color: white;
            padding: 20px;
            border-radius: 20px;
            font-size: 24px;
            max-width: 90%;
            text-align: center;
            z-index: 150;
            display: none;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5);
            border: 3px solid #a3a7cc;
            transition: all 0.3s;
            opacity: 0;
        }
        
        .message-box.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-30%);
        }
        
        .start-button {
            background: rgba(0, 170, 70, 0.9);
            color: white;
            border: 2px solid #80ffaa;
            padding: 12px 25px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 18px;
            font-family: 'M PLUS Rounded 1c', -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 700;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            margin-top: 20px;
            display: inline-block;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            touch-action: manipulation;
        }
        
        .start-button:hover {
            background: rgba(0, 190, 80, 0.9);
            transform: translateY(-2px);
        }
        
        .result-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translateX(-50%) translateY(-50%) scale(0.9);
            background: rgba(46, 51, 90, 0.9);
            color: white;
            padding: 25px;
            border-radius: 20px;
            font-size: 22px;
            max-width: 90%;
            text-align: center;
            z-index: 150;
            display: none;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5);
            border: 3px solid #a3a7cc;
            transition: all 0.5s;
            opacity: 0;
        }
        
        .result-box.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-50%) scale(1);
        }
        
        .result-title {
            font-size: 28px;
            margin-bottom: 15px;
            color: #ffcc00;
        }
        
        .result-score {
            font-size: 44px;
            margin-bottom: 10px;
            color: #ffffff;
        }
        
        .result-stats {
            font-size: 16px;
            margin-bottom: 20px;
            color: #c3b2ff;
        }
        
        .result-message {
            margin-bottom: 25px;
            font-size: 18px;
        }
        
        .retry-button {
            background: rgba(116, 97, 195, 0.9);
            color: white;
            border: 2px solid #c3b2ff;
            padding: 10px 25px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 18px;
            margin-top: 10px;
            transition: all 0.3s;
            display: block;
            margin-left: auto;
            margin-right: auto;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            touch-action: manipulation;
        }
        
        .retry-button:hover {
            background: rgba(136, 117, 215, 0.9);
            transform: translateY(-2px);
        }
        
        .instructions {
            color: #c3b2ff;
            font-size: 16px;
            margin-top: 10px;
        }
        
        .emoji {
            font-size: 18px;
            margin-right: 5px;
            display: inline-block;
        }
        
        .impact-effect {
            position: absolute;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
            z-index: 19;
            pointer-events: none;
        }
        
        .floating-score {
            position: absolute;
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 0 0 8px rgba(0, 0, 0, 0.8);
            z-index: 30;
            pointer-events: none;
            opacity: 0;
            transition: transform 1s, opacity 1s;
        }
        
        /* ÊÉÖÂ†±Ë°®Á§∫„Éê„Éä„Éº */
        .info-banner {
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.6);
            color: #ffe0a0;
            text-align: center;
            padding: 5px 10px;
            font-size: 14px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s;
            pointer-events: none;
        }
        
        .info-banner.show {
            opacity: 1;
        }
        
        /* „É¢„Éº„Ç∑„Éß„É≥ÂâäÊ∏õ„Å∏„ÅÆÂØæÂøú */
        @media (prefers-reduced-motion: reduce) {
            .target {
                animation: none;
            }
        }
        
        /* „É¨„Çπ„Éù„É≥„Ç∑„Éñ„Éá„Ç∂„Ç§„É≥ - ‰øÆÊ≠£ÔºöSafariÂØæÂøú */
        @media (max-width: 768px) {
            button {
                padding: 8px 12px;
                font-size: 14px;
                min-height: 36px;
            }
            
            .theme-btn {
                width: 32px;
                height: 32px;
                min-width: 32px;
                min-height: 32px;
            }
            
            .controls {
                gap: 5px;
                display: grid;
                grid-template-columns: 1fr 1fr;
            }
            
            .mode-selector, .difficulty-selector {
                gap: 5px;
            }
            
            .message-box {
                font-size: 18px;
                padding: 15px;
            }
            
            .instructions {
                font-size: 14px;
            }
            
            .timer-display, .score-display {
                font-size: 20px;
                padding: 8px 15px;
            }
            
            .combo-display, .level-display {
                font-size: 16px;
                padding: 5px 10px;
            }
            
            .countdown {
                font-size: 80px;
            }
            
            .result-box {
                padding: 20px;
                font-size: 18px;
            }
            
            .result-title {
                font-size: 24px;
            }
            
            .result-score {
                font-size: 32px;
            }
            
            .retry-button {
                font-size: 16px;
                padding: 8px 20px;
            }
            
            .start-button {
                font-size: 16px;
                padding: 8px 20px;
            }
        }
        
        /* Â∞è„Åï„ÅÑ„Çπ„Éû„ÉõÁîªÈù¢ */
        @media (max-width: 480px) {
            .button-container {
                width: 98%;
            }
            
            button {
                padding: 6px;
                font-size: 12px;
                min-height: 34px;
            }
            
            .emoji {
                font-size: 14px;
                margin-right: 3px;
            }
            
            .theme-btn {
                width: 28px;
                height: 28px;
                min-width: 28px;
                min-height: 28px;
            }
            
            .theme-selector {
                margin-bottom: 5px;
            }
            
            .controls {
                margin-bottom: 5px;
                grid-template-columns: 1fr 1fr;
                grid-gap: 4px;
            }
            
            .mode-selector, .difficulty-selector {
                gap: 4px;
                margin-bottom: 5px;
            }
            
            .result-title {
                font-size: 22px;
            }
            
            .result-score {
                font-size: 28px;
            }
            
            .result-stats {
                font-size: 14px;
            }
            
            .result-message {
                font-size: 14px;
            }
        }
        
        /* Áâπ„Å´Â∞è„Åï„Å™ÁîªÈù¢„Åß„ÅÆÊúÄÁµÇË™øÊï¥ */
        @media (max-width: 360px) {
            button {
                padding: 4px 6px;
                font-size: 11px;
                min-height: 30px;
            }
            
            .emoji {
                font-size: 12px;
                margin-right: 2px;
            }
            
            .theme-btn {
                width: 24px;
                height: 24px;
                min-width: 24px;
                min-height: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="container">
        <div class="background" id="background"></div>
        <div class="moon" id="moon"></div>
        <div class="stars" id="starsContainer"></div>
        
        <div class="info-banner" id="infoBanner">„Çπ„Éû„Éõ„É¢„Éº„Éâ„ÅßË°®Á§∫‰∏≠ - „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊúÄÈÅ©ÂåñÊ∏à„Åø</div>
        
        <div class="game-header">
            <div class="timer-display" id="timerDisplay">„ÅÇ„Å®30Áßí</div>
            <div class="score-display" id="scoreDisplay">„Çπ„Ç≥„Ç¢: 0</div>
            <div class="combo-display" id="comboDisplay">„Ç≥„É≥„Éú x2</div>
            <div class="level-display" id="levelDisplay">„É¨„Éô„É´ 1</div>
        </div>
        
        <div class="target" id="target">
            <div class="target-ring"></div>
            <div class="target-inner"></div>
            <div class="target-center"></div>
        </div>
        
        <div class="countdown" id="countdown">3</div>
        
        <div class="lightning-container" id="lightningContainer"></div>
        
        <div class="message-box" id="messageBox">
            <div id="messageText">Èõ∑„ÅÆ‰∏ñÁïå„Å∏„Çà„ÅÜ„Åì„ÅùÔºÅ</div>
            <div class="instructions" id="instructionsText">ÁîªÈù¢„Çí„Çø„ÉÉ„Éó„Åó„Å¶Èõ∑„ÇíÂëº„Å≥„Åæ„Åó„Çá„ÅÜ</div>
            <button class="start-button" id="startButton" style="display: none;">„Ç≤„Éº„É†„Çπ„Çø„Éº„ÉàÔºÅ</button>
        </div>
        
        <div class="result-box" id="resultBox">
            <div class="result-title">„Ç≤„Éº„É†ÁµÇ‰∫ÜÔºÅ</div>
            <div class="result-score" id="finalScore">0</div>
            <div class="result-stats" id="resultStats">ÊúÄÂ§ß„Ç≥„É≥„Éú: 0 / ÊúÄÈ´ò„É¨„Éô„É´: 1</div>
            <div class="result-message" id="resultMessage">Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅ</div>
            <button class="retry-button" id="retryButton">„ÇÇ„ÅÜ‰∏ÄÂ∫¶„Éó„É¨„Ç§</button>
        </div>
        
        <div class="ui-container">
            <div class="button-container">
                <div class="theme-selector">
                    <button id="nightTheme" class="theme-btn active" title="Â§ú„ÅÆ„ÉÜ„Éº„Éû"></button>
                    <button id="sunsetTheme" class="theme-btn" title="Â§ïÁÑº„Åë„ÉÜ„Éº„Éû"></button>
                    <button id="fantasyTheme" class="theme-btn" title="„Éï„Ç°„É≥„Çø„Ç∏„Éº„ÉÜ„Éº„Éû"></button>
                </div>
                
                <div class="mode-selector">
                    <button id="normalMode" class="active"><span class="emoji">‚ö°</span>„Åµ„Å§„ÅÜ„É¢„Éº„Éâ</button>
                    <button id="gameMode"><span class="emoji">üéÆ</span>„Ç≤„Éº„É†„É¢„Éº„Éâ</button>
                </div>
                
                <div class="difficulty-selector" id="difficultySelector">
                    <button id="easyMode" class="active"><span class="emoji">üòä</span>„Åã„Çì„Åü„Çì</button>
                    <button id="normalDifficulty"><span class="emoji">üòê</span>„Åµ„Å§„ÅÜ</button>
                    <button id="hardMode"><span class="emoji">üòÜ</span>„ÇÄ„Åö„Åã„Åó„ÅÑ</button>
                </div>
                
                <div class="controls">
                    <button id="playButton"><span class="emoji">üîÑ</span>Ëá™ÂãïÈõ∑ ON</button>
                    <button id="soundButton"><span class="emoji">üîä</span>Èü≥ ON</button>
                    <button id="infoButton"><span class="emoji">‚ÑπÔ∏è</span>Ë™¨Êòé</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // „Ç≤„Éº„É†Ë®≠ÂÆö
            const DIFFICULTY_SETTINGS = {
                easy: {
                    gameDuration: 30, // „Ç≤„Éº„É†„ÅÆÂà∂ÈôêÊôÇÈñìÔºàÁßíÔºâ
                    targetSize: 70,   // ÂàùÊúü„Çø„Éº„Ç≤„ÉÉ„Éà„Çµ„Ç§„Ç∫
                    minTargetSize: 50, // ÊúÄÂ∞è„Çø„Éº„Ç≤„ÉÉ„Éà„Çµ„Ç§„Ç∫
                    targetShrinkRate: 0.5, // „É¨„Éô„É´„Åî„Å®„ÅÆ„Çµ„Ç§„Ç∫Ê∏õÂ∞ëÈáè
                    targetSpeed: 0,    // ÂàùÊúü„Çø„Éº„Ç≤„ÉÉ„ÉàÁßªÂãïÈÄüÂ∫¶
                    maxTargetSpeed: 1.5, // ÊúÄÂ§ß„Çø„Éº„Ç≤„ÉÉ„ÉàÁßªÂãïÈÄüÂ∫¶
                    targetSpeedIncrement: 0.3, // „É¨„Éô„É´„Åî„Å®„ÅÆÈÄüÂ∫¶Â¢óÂä†Èáè
                    scorePerHit: 10,   // „Éí„ÉÉ„ÉàÊôÇ„ÅÆ„Çπ„Ç≥„Ç¢
                    comboMultiplier: 1.5, // „Ç≥„É≥„Éú„Éú„Éº„Éä„ÇπÂÄçÁéá
                    levelUpThreshold: 5, // „É¨„Éô„É´„Ç¢„ÉÉ„Éó„Å´ÂøÖË¶Å„Å™„Éí„ÉÉ„ÉàÊï∞
                    maxTargets: 1,     // ÊúÄÂ§ßÂêåÊôÇ„Çø„Éº„Ç≤„ÉÉ„ÉàÊï∞
                },
                normal: {
                    gameDuration: 30,
                    targetSize: 60,
                    minTargetSize: 40,
                    targetShrinkRate: 1,
                    targetSpeed: 0.5,
                    maxTargetSpeed: 2.5,
                    targetSpeedIncrement: 0.4,
                    scorePerHit: 10,
                    comboMultiplier: 2,
                    levelUpThreshold: 4,
                    maxTargets: 2,
                },
                hard: {
                    gameDuration: 30,
                    targetSize: 50,
                    minTargetSize: 30,
                    targetShrinkRate: 1.5,
                    targetSpeed: 1,
                    maxTargetSpeed: 4,
                    targetSpeedIncrement: 0.6,
                    scorePerHit: 10,
                    comboMultiplier: 3,
                    levelUpThreshold: 3,
                    maxTargets: 3,
                }
            };
            
            let currentDifficulty = 'easy'; // „Éá„Éï„Ç©„É´„Éà„ÅÆÈõ£ÊòìÂ∫¶
            
            // Èü≥Â£∞„Éï„Ç°„Ç§„É´„Éë„Çπ
            const THUNDER_SOUNDS = [
                'sounds/thunder1.mp3',
                'sounds/thunder2.mp3',
                'sounds/thunder3.mp3'
            ];
            
            // ÂäπÊûúÈü≥
            const SFX = {
                click: 'sounds/click.mp3',
                success: 'sounds/success.mp3',
                fail: 'sounds/fail.mp3',
                magic: 'sounds/magic.mp3',
                countdown: 'sounds/countdown.mp3',
                start: 'sounds/start.mp3',
                levelup: 'sounds/levelup.mp3',
                combo: 'sounds/combo.mp3'
            };
            
            // ÁµêÊûú„É°„ÉÉ„Çª„Éº„Ç∏
            const RESULT_MESSAGES = {
                excellent: [
                    "Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅÈõ∑„ÅÆÈÅî‰∫∫„Å†„Å≠ÔºÅ",
                    "„Åô„Åî„ÅÑÔºÅÂêõ„ÅØ„Åô„Åß„Å´Èõ∑„Éû„Çπ„Çø„Éº„Å†ÔºÅ",
                    "È©öÁï∞ÁöÑ„Å™„Çπ„Ç≥„Ç¢ÔºÅÁ®≤Â¶ª„ÅÆÁéãÊßò„Å†ÔºÅ"
                ],
                good: [
                    "„ÅÑ„ÅÑÊÑü„ÅòÔºÅ„Å©„Çì„Å©„Çì‰∏äÊâã„Å´„Å™„Å£„Å¶„Çã„Å≠ÔºÅ",
                    "Á¥†Êïµ„Å™„Éó„É¨„Ç§„Å†„Å£„Åü„ÇàÔºÅ",
                    "Èõ∑„ÅÆÂäõ„Çí‰∏äÊâã„Å´‰Ωø„ÅÑ„Åì„Å™„Åõ„Å¶„ÅÑ„Çã„Å≠ÔºÅ"
                ],
                normal: [
                    "„ÅÑ„ÅÑË™øÂ≠êÔºÅ„ÇÇ„ÅÜ‰∏ÄÂõû„ÉÅ„É£„É¨„É≥„Ç∏„Åó„Å¶„Åø„Çà„ÅÜÔºÅ",
                    "Èõ∑„ÅÆÂäõ„ÅåÁõÆË¶ö„ÇÅ„Å¶„Åç„Åü„Å≠ÔºÅ",
                    "„ÇÇ„ÅÜÂ∞ë„Åó„ÅßÈõ∑„Éû„Çπ„Çø„Éº„Å´„Å™„Çå„Çã„ÇàÔºÅ"
                ],
                beginner: [
                    "„Åæ„Åö„ÅØÈõ∑„Å´ÊÖ£„Çå„Å¶„ÅÑ„Åì„ÅÜÔºÅ",
                    "Á∑¥Áøí„ÅÇ„Çã„ÅÆ„ÅøÔºÅÊ¨°„ÅØ„ÇÇ„Å£„Å®‰∏äÊâã„Åè„Å™„Çã„ÇàÔºÅ",
                    "ÊúÄÂàù„ÅØÈõ£„Åó„ÅÑ„Åë„Å©„ÄÅ„Åç„Å£„Å®‰∏äÊâã„Å´„Å™„Çã„ÇàÔºÅ"
                ]
            };
            
            // DOMË¶ÅÁ¥†„ÅÆÂèñÂæó
            const container = document.getElementById('container');
            const lightningContainer = document.getElementById('lightningContainer');
            const playButton = document.getElementById('playButton');
            const soundButton = document.getElementById('soundButton');
            const infoButton = document.getElementById('infoButton');
            const normalMode = document.getElementById('normalMode');
            const gameMode = document.getElementById('gameMode');
            const easyMode = document.getElementById('easyMode');
            const normalDifficulty = document.getElementById('normalDifficulty');
            const hardMode = document.getElementById('hardMode');
            const difficultySelector = document.getElementById('difficultySelector');
            const background = document.getElementById('background');
            const moon = document.getElementById('moon');
            const nightTheme = document.getElementById('nightTheme');
            const sunsetTheme = document.getElementById('sunsetTheme');
            const fantasyTheme = document.getElementById('fantasyTheme');
            const scoreDisplay = document.getElementById('scoreDisplay');
            const timerDisplay = document.getElementById('timerDisplay');
            const comboDisplay = document.getElementById('comboDisplay');
            const levelDisplay = document.getElementById('levelDisplay');
            const countdown = document.getElementById('countdown');
            const target = document.getElementById('target');
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            const instructionsText = document.getElementById('instructionsText');
            const startButton = document.getElementById('startButton');
            const starsContainer = document.getElementById('starsContainer');
            const resultBox = document.getElementById('resultBox');
            const finalScore = document.getElementById('finalScore');
            const resultStats = document.getElementById('resultStats');
            const resultMessage = document.getElementById('resultMessage');
            const retryButton = document.getElementById('retryButton');
            const infoBanner = document.getElementById('infoBanner');
            
            // SVGÂêçÂâçÁ©∫Èñì
            const svgNS = "http://www.w3.org/2000/svg";
            
            // Áä∂ÊÖãÂ§âÊï∞
            let autoPlay = false;
            let soundEnabled = true;
            let currentTheme = 'night';
            let currentMode = 'normal';
            let score = 0;
            let combo = 0;
            let maxCombo = 0;
            let gameActive = false;
            let gameTimeRemaining = 30; // ÂàùÊúü„Ç≤„Éº„É†ÊôÇÈñìÔºàÁßíÔºâ
            let level = 1;
            let maxLevel = 1;
            let hitsInLevel = 0;
            let timeoutIds = [];
            let gameTimerId = null;
            let targetMovementTimerId = null;
            let targetsActive = [];
            let countdownActive = false;
            let messageHideTimeout = null; // „É°„ÉÉ„Çª„Éº„Ç∏„ÅÆËá™ÂãïÊ∂àÂéª„Çø„Ç§„Éû„ÉºÂ§âÊï∞
            let audioContext = null; // Web Audio APIÁî®
            let audioInitialized = false; // Èü≥Â£∞ÂàùÊúüÂåñ„Éï„É©„Ç∞
            let audioUnlocked = false; // Èü≥Â£∞ÂÜçÁîü„É≠„ÉÉ„ÇØËß£Èô§„Éï„É©„Ç∞
            let highQualityMode = false; // ÂìÅË≥™„É¢„Éº„ÉâÔºàÈ´òÂìÅË≥™/„Çπ„Éû„Éõ„É¢„Éº„ÉâÔºâ„ÄÅ„Éá„Éï„Ç©„É´„Éà„Åß„Çπ„Éû„Éõ„É¢„Éº„Éâ
            
            // „É¢„Éê„Ç§„É´„Éá„Éê„Ç§„Çπ„Åã„Å©„ÅÜ„ÅãÂà§ÂÆö
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            // iOS„Åã„Å©„ÅÜ„ÅãÂà§ÂÆö
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            
            // „Éï„É´„Çµ„Ç§„Ç∫PC„Åã„Çâ„ÅÆ„Ç¢„ÇØ„Çª„Çπ„ÅÆÂ†¥Âêà„ÅØÈ´òÂìÅË≥™„É¢„Éº„Éâ„Å´Ë®≠ÂÆö
            if (!isMobile) {
                highQualityMode = true;
            }
            
            // „Çø„Éº„Ç≤„ÉÉ„Éà„ÅÆÁßªÂãï„Å´Èñ¢„Åô„ÇãÂ§âÊï∞
            let targetVelocityX = 0;
            let targetVelocityY = 0;
            
            // SVGË¶ÅÁ¥†„Çí‰ΩúÊàê
            const svg = document.createElementNS(svgNS, "svg");
            svg.setAttribute("width", "100%");
            svg.setAttribute("height", "100%");
            svg.setAttribute("viewBox", "0 0 " + window.innerWidth + " " + window.innerHeight);
            lightningContainer.appendChild(svg);
            
            // SVG„Éé„Éº„Éâ„Éó„Éº„É´Ôºà„É°„É¢„É™ÊúÄÈÅ©ÂåñÔºâ
            const svgNodePool = {
                paths: [],
                flashes: [],
                rects: []
            };
            
            // ‰øÆÊ≠£: Èü≥Â£∞Áî®„ÅÆ„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÇíÊ†ºÁ¥ç„Åô„ÇãÂçò‰∏Ä„ÅÆ„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà
            const audioElements = {
                thunder: null,
                click: null,
                success: null,
                fail: null,
                countdown: null,
                start: null,
                levelup: null,
                combo: null
            };
            
            // ÂìÅË≥™„É¢„Éº„Éâ„Å´Âøú„Åò„ÅüÊÉÖÂ†±„Éê„Éä„ÉºË°®Á§∫
            function showQualityBanner() {
                if (isMobile) {
                    infoBanner.innerText = "„Çπ„Éû„Éõ„É¢„Éº„Éâ„ÅßË°®Á§∫‰∏≠ - „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊúÄÈÅ©ÂåñÊ∏à„Åø";
                    infoBanner.classList.add('show');
                    
                    setTimeout(() => {
                        infoBanner.classList.remove('show');
                    }, 5000);
                }
            }
            
            // „Ç™„Éº„Éá„Ç£„Ç™„Ç∑„Çπ„ÉÜ„É†„ÅÆ„É≠„ÉÉ„ÇØËß£Èô§ÔºàÁâπ„Å´iOSÁî®Ôºâ
            function unlockAudio() {
                if (audioUnlocked) return;
                
                // „Åæ„Å†ÂàùÊúüÂåñ„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà
                if (!audioInitialized) {
                    initAudio();
                }
                
                // „Çø„ÉÉ„ÉÅ/„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„Åß‰∏ÄÂ∫¶„Å†„ÅëÁÑ°Èü≥„ÇíÂÜçÁîü„Åó„Å¶Ëß£Èô§
                const silentSound = new Audio();
                silentSound.autoplay = true;
                
                // iOS Safari„Åß„ÅÆËá™ÂãïÂÜçÁîüË®±ÂèØ
                silentSound.src = "data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAACAAABIADAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV6urq6urq6urq6urq6urq6urq6urq6urq6v////////////////////////////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAAAAAAAAAAAASDs90hvAAAAAAAAAAAAAAAAAAAA//MUZAAAAAGkAAAAAAAAA0gAAAAATEFN//MUZAMAAAGkAAAAAAAAA0gAAAAAOTku//MUZAkAAAGkAAAAAAAAA0gAAAAANVVV";
                
                silentSound.onended = function() {
                    audioUnlocked = true;
                    console.log("Audio unlocked");
                };
                
                silentSound.play().catch(function(e) {
                    console.log("Audio unlock failed: " + e);
                });
            }
            
            // Èü≥Â£∞„Ç∑„Çπ„ÉÜ„É†„ÅÆÂàùÊúüÂåñ
            function initAudio() {
                if (audioInitialized) return;
                
                // ‰∏ÄÂÆöÊôÇÈñìÁµåÈÅéÂæå„Å´Èü≥Â£∞„Çí„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó„Åô„ÇãÈñ¢Êï∞Ôºà„É°„É¢„É™ÁÆ°ÁêÜÁî®Ôºâ
                function cleanupAudio(audio) {
                    if (audio) {
                        setTimeout(function() {
                            if (audio.paused) {
                                audio.src = '';
                            }
                        }, 5000);
                    }
                }
                
                // „Ç∑„É≥„Éó„É´„Å™ÂäπÊûúÈü≥„Çí‰ΩúÊàê„Åô„ÇãÈñ¢Êï∞
                function createAudio(url) {
                    const audio = new Audio();
                    audio.preload = 'none'; // „Éó„É™„É≠„Éº„Éâ„Åó„Å™„ÅÑ
                    audio.src = url;
                    audio.volume = 0.3;
                    
                    // iOS„ÅÆÂ†¥Âêà„ÅØÁÑ°Èü≥„Å´„Åó„Å¶ÈùûÂêåÊúü„É≠„Éº„Éâ
                    if (isIOS) {
                        audio.volume = 0;
                        audio.play().then(function() {
                            audio.pause();
                            audio.currentTime = 0;
                            audio.volume = 0.3;
                        }).catch(function() {
                            // „Ç®„É©„Éº„ÅØÁÑ°Ë¶ñÔºàÂæå„ÅßunlockAudio„ÅßËß£Ê±∫Ôºâ
                        });
                    }
                    
                    return audio;
                }
                
                // ÂøÖË¶ÅÊúÄÂ∞èÈôê„ÅÆÈü≥Â£∞Á¥†Êùê„Å†„Åë„ÇíÂàùÊúüÂåñ
                audioElements.click = createAudio(SFX.click);
                
                // „Éï„É©„Ç∞„ÇíË®≠ÂÆö
                audioInitialized = true;
            }
            
            // „Ç™„Éº„Éá„Ç£„Ç™„ÅÆÈÅÖÂª∂„É≠„Éº„Éâ
            function loadAudio(type) {
                if (!audioInitialized) {
                    initAudio();
                }
                
                if (!audioElements[type]) {
                    switch (type) {
                        case 'thunder':
                            // „É©„É≥„ÉÄ„É†„Å™Èõ∑Èü≥„ÇíÈÅ∏Êäû
                            const soundIndex = Math.floor(Math.random() * THUNDER_SOUNDS.length);
                            audioElements[type] = new Audio(THUNDER_SOUNDS[soundIndex]);
                            audioElements[type].volume = 0.5;
                            break;
                        case 'click':
                            // „Åô„Åß„Å´ÂàùÊúüÂåñÊ∏à„Åø
                            break;
                        default:
                            // „Åù„ÅÆ‰ªñ„ÅÆÂäπÊûúÈü≥
                            if (SFX[type]) {
                                audioElements[type] = new Audio(SFX[type]);
                                audioElements[type].volume = 0.3;
                            }
                            break;
                    }
                }
            }
            
            // Êòü„Çí‰ΩúÊàê
            function createStars() {
                // Êó¢Â≠ò„ÅÆÊòü„ÇíÂâäÈô§
                starsContainer.innerHTML = '';
                
                // „É¢„Éê„Ç§„É´„É¢„Éº„Éâ„Åß„ÅØÊòü„ÅÆÊï∞„ÇíÊ∏õ„Çâ„Åô
                const starCount = highQualityMode 
                    ? Math.min(window.innerWidth, window.innerHeight) / 3
                    : Math.min(window.innerWidth, window.innerHeight) / 6;
                
                for (let i = 0; i < starCount; i++) {
                    const star = document.createElement('div');
                    star.classList.add('star');
                    
                    // „É©„É≥„ÉÄ„É†„Å™‰ΩçÁΩÆ„Å®„Çµ„Ç§„Ç∫
                    const size = Math.random() * 2 + 1;
                    star.style.width = size + 'px';
                    star.style.height = size + 'px';
                    star.style.left = Math.random() * 100 + '%';
                    star.style.top = Math.random() * 100 + '%';
                    
                    // „É©„É≥„ÉÄ„É†„Å™„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
                    star.style.setProperty('--twinkle-duration', (3 + Math.random() * 5) + 's');
                    star.style.setProperty('--twinkle-delay', (Math.random() * 5) + 's');
                    star.style.setProperty('--star-opacity', (0.5 + Math.random() * 0.5).toString());
                    
                    starsContainer.appendChild(star);
                }
            }
            
            // „ÉÜ„Éº„Éû„ÇíË®≠ÂÆö
            function setTheme(theme) {
                currentTheme = theme;
                
                // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Éú„Çø„É≥„ÇíÊõ¥Êñ∞
                nightTheme.classList.remove('active');
                sunsetTheme.classList.remove('active');
                fantasyTheme.classList.remove('active');
                
                if (theme === 'night') {
                    nightTheme.classList.add('active');
                    background.className = 'background';
                    moon.className = 'moon';
                    starsContainer.style.opacity = '0.7';
                } else if (theme === 'sunset') {
                    sunsetTheme.classList.add('active');
                    background.className = 'background sunset';
                    moon.className = 'moon sunset';
                    starsContainer.style.opacity = '0.3';
                } else if (theme === 'fantasy') {
                    fantasyTheme.classList.add('active');
                    background.className = 'background fantasy';
                    moon.className = 'moon fantasy';
                    starsContainer.style.opacity = '1';
                }
                
                // ÂäπÊûúÈü≥ÂÜçÁîü
                playSFX('click');
            }
            
            // „É¢„Éº„Éâ„ÇíË®≠ÂÆö
            function setMode(mode) {
                // ÁèæÂú®„Å®Âêå„Åò„É¢„Éº„Éâ„ÅåÈÅ∏Êäû„Åï„Çå„ÅüÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
                if (mode === currentMode) return;
                
                currentMode = mode;
                
                // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Éú„Çø„É≥„ÇíÊõ¥Êñ∞
                normalMode.classList.remove('active');
                gameMode.classList.remove('active');
                
                // „É¢„Éº„ÉâÂõ∫Êúâ„ÅÆË®≠ÂÆö„Çí„É™„Çª„ÉÉ„Éà
                hideGameUI();
                target.style.display = 'none';
                resultBox.style.display = 'none';
                
                // „Çø„Ç§„Éû„Éº„Çí„ÇØ„É™„Ç¢
                clearAllTimers();
                
                // ÈÄ≤Ë°å‰∏≠„ÅÆ„Ç≤„Éº„É†„Åå„ÅÇ„Çå„Å∞ÁµÇ‰∫Ü
                if (gameActive) {
                    endGame();
                }
                
                // „Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥„ÇíÁ¢∫ÂÆü„Å´ÈùûË°®Á§∫
                countdown.style.display = 'none';
                countdown.classList.remove('show');
                countdown.classList.remove('hide');
                countdownActive = false;
                
                if (mode === 'normal') {
                    normalMode.classList.add('active');
                    difficultySelector.style.display = 'none';
                    showMessage('„Åµ„Å§„ÅÜ„É¢„Éº„Éâ', '„Çπ„ÇØ„É™„Éº„É≥„Çí„Çø„ÉÉ„Éó„Åó„Å¶Èõ∑„ÇíÂëº„Å≥Âá∫„Åù„ÅÜÔºÅ', 2000);
                } else if (mode === 'game') {
                    gameMode.classList.add('active');
                    difficultySelector.style.display = 'flex';
                    
                    // „Ç≤„Éº„É†„É¢„Éº„Éâ„ÅÆË™¨Êòé„ÇíË°®Á§∫ÔºàËá™Âãï„ÅßÊ∂à„Åà„Å™„ÅÑ„Çà„ÅÜ„Å´Ôºâ
                    showGameInstructions();
                }
                
                // ÂäπÊûúÈü≥ÂÜçÁîü
                playSFX('click');
            }
            
            // Èõ£ÊòìÂ∫¶„ÇíË®≠ÂÆö
            function setDifficulty(difficulty) {
                // ÁèæÂú®„Å®Âêå„ÅòÈõ£ÊòìÂ∫¶„ÅåÈÅ∏Êäû„Åï„Çå„ÅüÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑÔºà„Ç≤„Éº„É†‰∏≠„ÅÆË™§„ÇØ„É™„ÉÉ„ÇØÈò≤Ê≠¢Ôºâ
                if (difficulty === currentDifficulty && gameActive) return;
                
                currentDifficulty = difficulty;
                
                // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Éú„Çø„É≥„ÇíÊõ¥Êñ∞
                easyMode.classList.remove('active');
                normalDifficulty.classList.remove('active');
                hardMode.classList.remove('active');
                
                if (difficulty === 'easy') {
                    easyMode.classList.add('active');
                } else if (difficulty === 'normal') {
                    normalDifficulty.classList.add('active');
                } else if (difficulty === 'hard') {
                    hardMode.classList.add('active');
                }
                
                // „Ç≤„Éº„É†Ë®≠ÂÆö„ÇíÊõ¥Êñ∞
                if (currentMode === 'game') {
                    // ÈÄ≤Ë°å‰∏≠„ÅÆ„Ç≤„Éº„É†„Åå„ÅÇ„Çå„Å∞ÁµÇ‰∫ÜÔºà„É™„Ç∂„É´„ÉàÁîªÈù¢„ÇíË°®Á§∫„Åõ„ÅöÔºâ
                    if (gameActive) {
                        endGame(false);  // „É™„Ç∂„É´„ÉàË°®Á§∫„Åó„Å™„ÅÑ„Éï„É©„Ç∞„ÇíÊ∏°„Åô
                    }
                    
                    gameTimeRemaining = DIFFICULTY_SETTINGS[difficulty].gameDuration;
                    updateTimer();
                    
                    // Èõ£ÊòìÂ∫¶„Å´Âøú„Åò„Åü„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
                    let difficultyName;
                    if (difficulty === 'easy') difficultyName = '„Åã„Çì„Åü„Çì';
                    else if (difficulty === 'normal') difficultyName = '„Åµ„Å§„ÅÜ';
                    else difficultyName = '„ÇÄ„Åö„Åã„Åó„ÅÑ';
                    
                    showGameInstructions(difficultyName);
                }
                
                // ÂäπÊûúÈü≥ÂÜçÁîü
                playSFX('click');
            }
            
            // „Ç≤„Éº„É†ÈñãÂßãÂâç„ÅÆÊ°àÂÜÖ„ÇíË°®Á§∫
            function showGameInstructions(difficultyName = null) {
                // „Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥„Åå„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Çâ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫„Åó„Å™„ÅÑ
                if (countdownActive) return;
                
                // „Ç≤„Éº„É†„Çí„É™„Çª„ÉÉ„Éà
                if (gameActive) {
                    endGame(false);  // „É™„Ç∂„É´„ÉàË°®Á§∫„Åó„Å™„ÅÑ„Éï„É©„Ç∞„ÇíÊ∏°„Åô
                }
                
                // ÁµêÊûúÁîªÈù¢„ÅåË°®Á§∫„Åï„Çå„Å¶„ÅÑ„Çå„Å∞ÈùûË°®Á§∫„Å´„Åô„Çã
                resultBox.classList.remove('show');
                resultBox.style.display = 'none';
                
                const settings = DIFFICULTY_SETTINGS[currentDifficulty];
                const diffText = difficultyName ? `Èõ£ÊòìÂ∫¶: ${difficultyName}` : '';
                
                // „Ç≤„Éº„É†„É´„Éº„É´„ÅÆË™¨Êòé
                let instructionText = `Âà∂ÈôêÊôÇÈñì${settings.gameDuration}ÁßíÈñì„Å´„ÄÅ„Åß„Åç„Çã„Å†„ÅëÂ§ö„Åè„ÅÆ„Çø„Éº„Ç≤„ÉÉ„Éà„Çí„Çø„ÉÉ„Éó„Åó„Çà„ÅÜÔºÅ
                ${diffText}
                „ÉªÈÄ£Á∂ö„Éí„ÉÉ„Éà„Åß„Ç≥„É≥„Éú„Éú„Éº„Éä„ÇπÔºÅ
                „Éª„É¨„Éô„É´„Åå‰∏ä„Åå„Çã„Å®Èõ£„Åó„Åè„Å™„Çã„ÇàÔºÅ`;
                
                messageText.textContent = '„Ç≤„Éº„É†„É¢„Éº„Éâ';
                instructionsText.innerHTML = instructionText;
                startButton.style.display = 'inline-block';
                
                // Êó¢Â≠ò„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏Ëá™ÂãïÊ∂àÂéª„Çø„Ç§„Éû„Éº„Çí„Ç≠„É£„É≥„Çª„É´
                if (messageHideTimeout) {
                    clearTimeout(messageHideTimeout);
                    messageHideTimeout = null;
                }
                
                // „É°„ÉÉ„Çª„Éº„Ç∏„Éú„ÉÉ„ÇØ„Çπ„ÇíË°®Á§∫Ôºà„Çø„Ç§„Éû„Éº„Å™„Åó„ÅßÂ∏∏„Å´Ë°®Á§∫Ôºâ
                messageBox.style.display = 'block';
                messageBox.classList.remove('show');
                
                // Â∞ë„ÅóÈÅÖÂª∂„Åó„Å¶„Åã„Çâ„ÇØ„É©„Çπ„ÇíËøΩÂä†ÔºàCSS„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Áî®Ôºâ
                setTimeout(() => {
                    messageBox.classList.add('show');
                }, 10);
            }
            
            // „Ç≤„Éº„É†UI„ÇíË°®Á§∫
            function showGameUI() {
                timerDisplay.style.display = 'block';
                scoreDisplay.style.display = 'block';
                comboDisplay.style.display = 'block';
                levelDisplay.style.display = 'block';
                
                // „Ç≥„É≥„Éú„Åå0„ÅÆÂ†¥Âêà„ÅØÈùûË°®Á§∫
                if (combo <= 1) {
                    comboDisplay.style.display = 'none';
                }
            }
            
            // „Ç≤„Éº„É†UI„ÇíÈùûË°®Á§∫
            function hideGameUI() {
                timerDisplay.style.display = 'none';
                scoreDisplay.style.display = 'none';
                comboDisplay.style.display = 'none';
                levelDisplay.style.display = 'none';
            }
            

            // „Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥„ÇíË°®Á§∫
            function showCountdown() {
                if (countdownActive || gameActive) return;
                countdownActive = true;
                
                // „É°„ÉÉ„Çª„Éº„Ç∏„Éú„ÉÉ„ÇØ„Çπ„ÇíÈùûË°®Á§∫
                messageBox.classList.remove('show');
                setTimeout(() => {
                    messageBox.style.display = 'none';
                }, 300);
                
                // „Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥Ë°®Á§∫„ÇíÂàùÊúüÂåñ
                countdown.style.display = 'block';
                let count = 3;
                countdown.textContent = count;
                countdown.classList.add('show');
                
                // „Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥Èü≥„ÇíÂÜçÁîüÔºà1Âõû„Å†„ÅëÔºâ
                playSFX('countdown');
                
                const countdownInterval = setInterval(() => {
                    count--;
                    
                    if (count > 0) {
                        countdown.classList.remove('show');
                        setTimeout(() => {
                            countdown.textContent = count;
                            countdown.classList.add('show');
                        }, 100);
                    } else {
                        // „Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥ÁµÇ‰∫Ü„ÄÅ„Ç≤„Éº„É†ÈñãÂßã
                        countdown.classList.remove('show');
                        countdown.classList.add('hide');
                        clearInterval(countdownInterval);
                        
                        setTimeout(() => {
                            countdown.classList.remove('hide');
                            countdown.textContent = '„Çπ„Çø„Éº„ÉàÔºÅ';
                            countdown.classList.add('show');
                            playSFX('start');
                            
                            setTimeout(() => {
                                countdown.classList.remove('show');
                                countdown.classList.add('hide');
                                
                                setTimeout(() => {
                                    countdown.style.display = 'none';
                                    countdown.classList.remove('hide');
                                    if (currentMode === 'game') {
                                        startGame();
                                    }
                                    countdownActive = false;
                                }, 500);
                            }, 1000);
                        }, 200);
                    }
                }, 1000);
            }
            
            // „Ç≤„Éº„É†„ÇíÈñãÂßã
            function startGame() {
                if (gameActive) return;
                
                // „Ç≤„Éº„É†Ë®≠ÂÆö„ÇíÂèñÂæó
                const settings = DIFFICULTY_SETTINGS[currentDifficulty];
                
                // „Ç≤„Éº„É†Áä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
                score = 0;
                combo = 0;
                maxCombo = 0;
                level = 1;
                maxLevel = 1;
                hitsInLevel = 0;
                gameTimeRemaining = settings.gameDuration;
                gameActive = true;
                targetsActive = [];
                
                // „Çø„Éº„Ç≤„ÉÉ„Éà„ÅÆ„Çµ„Ç§„Ç∫„Çí„É™„Çª„ÉÉ„Éà
                target.style.width = settings.targetSize + 'px';
                target.style.height = settings.targetSize + 'px';
                
                // UI„ÇíË°®Á§∫
                showGameUI();
                updateScore();
                updateCombo();
                updateLevel();
                updateTimer();
                
                // ÂàùÂõû„Çø„Éº„Ç≤„ÉÉ„ÉàË°®Á§∫
                showTarget();
                
                // „Çø„Éº„Ç≤„ÉÉ„ÉàÁßªÂãï„ÇíÈñãÂßã
                startTargetMovement();
                
                // „Çø„Ç§„Éû„Éº„ÇíÈñãÂßã
                gameTimerId = setInterval(() => {
                    gameTimeRemaining--;
                    updateTimer();
                    
                    if (gameTimeRemaining <= 0) {
                        endGame();
                    }
                }, 1000);
            }
            
            // „Çø„Éº„Ç≤„ÉÉ„Éà„ÅÆÁßªÂãï„ÇíÈñãÂßã
            function startTargetMovement() {
                if (!gameActive) return;
                
                // Ë®≠ÂÆö„ÇíÂèñÂæó
                const settings = DIFFICULTY_SETTINGS[currentDifficulty];
                const speed = Math.min(settings.targetSpeed + (level - 1) * settings.targetSpeedIncrement, settings.maxTargetSpeed);
                
                if (speed <= 0) return; // ÁßªÂãïÈÄüÂ∫¶„Åå0‰ª•‰∏ã„Å™„ÇâÂãï„Åã„Åï„Å™„ÅÑ
                
                // „É¢„Éê„Ç§„É´„É¢„Éº„Éâ„Åã„Å©„ÅÜ„Åã„Å´„Çà„Å£„Å¶„Éï„É¨„Éº„É†„É¨„Éº„ÉàË™øÊï¥
                const frameInterval = highQualityMode ? 20 : 30; // „Çπ„Éû„Éõ„É¢„Éº„Éâ„Åß„ÅØÊõ¥Êñ∞È†ªÂ∫¶„Çí‰∏ã„Åí„Çã
                
                // ÁßªÂãïÊõ¥Êñ∞„Çø„Ç§„Éû„Éº
                targetMovementTimerId = setInterval(() => {
                    if (!gameActive || targetsActive.length === 0) return;
                    
                    // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™ÂêÑ„Çø„Éº„Ç≤„ÉÉ„Éà„ÇíÁßªÂãï
                    targetsActive.forEach(targetData => {
                        const targetElem = targetData.element;
                        const rect = targetElem.getBoundingClientRect();
                        
                        // „Çø„Éº„Ç≤„ÉÉ„Éà„ÅÆ‰∏≠ÂøÉÂ∫ßÊ®ô„ÇíË®àÁÆó
                        const centerX = rect.left + rect.width / 2;
                        const centerY = rect.top + rect.height / 2;
                        
                        // Êñ∞„Åó„ÅÑ‰ΩçÁΩÆ„ÇíË®àÁÆó
                        let newX = rect.left + targetData.velocityX;
                        let newY = rect.top + targetData.velocityY;
                        
                        // „Çø„Éº„Ç≤„ÉÉ„Éà„ÅÆ„Çµ„Ç§„Ç∫„ÇíÂèñÂæó
                        const targetSize = targetData.size;
                        const padding = 20;
                        
                        // ÁîªÈù¢Â§ñ„ÉÅ„Çß„ÉÉ„ÇØ - ÂÆåÂÖ®„Å´ÁîªÈù¢Â§ñ„Å´Âá∫„Å¶„Åó„Åæ„Å£„ÅüÂ†¥Âêà„ÅØ„É™„Çª„ÉÉ„Éà
                        if (centerX < -targetSize || centerX > window.innerWidth + targetSize ||
                            centerY < -targetSize || centerY > window.innerHeight + targetSize) {
                            
                            // ÁîªÈù¢„ÅÆÂÆâÂÖ®„Å™Â†¥ÊâÄ„Å´ÂÜçÈÖçÁΩÆ
                            newX = window.innerWidth / 2 - targetSize / 2;
                            newY = window.innerHeight / 3 - targetSize / 2;
                            
                            // „É©„É≥„ÉÄ„É†„Å™ÊñπÂêë„Å´Âãï„Åè„Çà„ÅÜ„Å´Ë®≠ÂÆö
                            const newAngle = Math.random() * Math.PI * 2;
                            targetData.velocityX = Math.cos(newAngle) * speed;
                            targetData.velocityY = Math.sin(newAngle) * speed;
                        }
                        
                        // Â¢ÉÁïå„ÉÅ„Çß„ÉÉ„ÇØ - ÁîªÈù¢Á´Ø„Å´Ëøë„Å•„ÅÑ„Åü„ÇâÂèçËª¢
                        if (newX < padding || newX + targetSize > window.innerWidth - padding) {
                            targetData.velocityX *= -1; // ÂèçËª¢
                            newX += targetData.velocityX * 2; // Â¢ÉÁïå„Åã„ÇâÈõ¢„Çå„Çã
                        }
                        
                        if (newY < padding || newY + targetSize > window.innerHeight - padding) {
                            targetData.velocityY *= -1; // ÂèçËª¢
                            newY += targetData.velocityY * 2; // Â¢ÉÁïå„Åã„ÇâÈõ¢„Çå„Çã
                        }
                        
                        // UI„Ç®„É™„Ç¢‰ªòËøë„ÅÆÂ†¥Âêà„ÇÇÂèçËª¢ÔºàÁîªÈù¢‰∏ãÈÉ®„ÅÆUI„Å´Ëøë„Å•„Åç„Åô„Åé„Å™„ÅÑ„Çà„ÅÜ„Å´Ôºâ
                        const uiContainer = document.querySelector('.ui-container');
                        const uiRect = uiContainer.getBoundingClientRect();
                        
                        if (newY + targetSize > uiRect.top - padding) {
                            targetData.velocityY *= -1; // ‰∏äÂêë„Åç„Å´ÂèçËª¢
                            newY = uiRect.top - padding - targetSize; // UI„ÅÆ‰∏ä„Å´Êàª„Åô
                        }
                        
                        // ‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞
                        targetElem.style.left = `${newX}px`;
                        targetElem.style.top = `${newY}px`;
                    });
                }, frameInterval);
            }
            
            // „Ç≤„Éº„É†„ÇíÁµÇ‰∫Ü
            function endGame(showResultScreen = true) {  // „Éë„É©„É°„Éº„Çø„ÇíËøΩÂä†
                clearInterval(gameTimerId);
                clearInterval(targetMovementTimerId);
                gameActive = false;
                
                // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Çø„Éº„Ç≤„ÉÉ„Éà„Çí„Åô„Åπ„Å¶ÈùûË°®Á§∫
                targetsActive.forEach(targetData => {
                    targetData.element.style.display = 'none';
                });
                targetsActive = [];
                
                // ÁµêÊûúË°®Á§∫Ôºà„Çπ„Ç≥„Ç¢„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆ„Åø - „É™„Ç∂„É´„ÉàË°®Á§∫„Éï„É©„Ç∞„Ååtrue„ÅÆÂ†¥ÂêàÔºâ
                if (score > 0 && showResultScreen) {  // Êù°‰ª∂„ÇíËøΩÂä†
                    showResult();
                }
            }
            
            // „Çø„Éº„Ç≤„ÉÉ„Éà„ÇíË°®Á§∫
            function showTarget() {
                if (!gameActive) return;
                
                const settings = DIFFICULTY_SETTINGS[currentDifficulty];
                
                // „Åô„Åß„Å´ÊúÄÂ§ßÊï∞„ÅÆ„Çø„Éº„Ç≤„ÉÉ„Éà„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØËøΩÂä†„Åó„Å™„ÅÑ
                if (targetsActive.length >= settings.maxTargets) return;
                
                // ÁèæÂú®„ÅÆ„É¨„Éô„É´„Å´Âøú„Åò„Åü„Çø„Éº„Ç≤„ÉÉ„Éà„Çµ„Ç§„Ç∫„ÇíË®àÁÆó
                const sizeReduction = Math.min((level - 1) * settings.targetShrinkRate, settings.targetSize - settings.minTargetSize);
                const currentSize = settings.targetSize - sizeReduction;
                
                // „É©„É≥„ÉÄ„É†„Å™‰ΩçÁΩÆ„Å´„Çø„Éº„Ç≤„ÉÉ„Éà„ÇíÈÖçÁΩÆ
                // UI„ÅÆÈÖçÁΩÆ„ÇíÈÅø„Åë„Çã
                const uiContainer = document.querySelector('.ui-container');
                const uiRect = uiContainer.getBoundingClientRect();
                const uiTop = uiRect.top;
                
                const padding = currentSize; // „Éë„Éá„Ç£„É≥„Ç∞„Çí„Çø„Éº„Ç≤„ÉÉ„Éà„Çµ„Ç§„Ç∫„Å´Âêà„Çè„Åõ„Çã
                const safeAreaHeight = uiTop - padding; // UI„ÅÆ‰∏äÈÉ®„Åæ„Åß„ÅÆÂÆâÂÖ®„Å™È´ò„Åï
                
                let x, y;
                do {
                    x = padding + Math.random() * (window.innerWidth - padding * 2);
                    y = padding + Math.random() * safeAreaHeight;
                } while (
                    // UI„ÅÆ‰∏ä„Å´„Çø„Éº„Ç≤„ÉÉ„Éà„ÅåÊù•„Å™„ÅÑ„Çà„ÅÜ„Å´„ÉÅ„Çß„ÉÉ„ÇØ
                    y > safeAreaHeight || 
                    // ÁîªÈù¢Á´Ø„Åô„Åé„Çã‰ΩçÁΩÆ„ÇíÈÅø„Åë„Çã
                    x < padding || 
                    x > window.innerWidth - padding || 
                    y < padding
                );
                
                // Êñ∞„Åó„ÅÑ„Çø„Éº„Ç≤„ÉÉ„Éà„Çí‰ΩúÊàê„Åæ„Åü„ÅØÊó¢Â≠ò„ÅÆ„Çø„Éº„Ç≤„ÉÉ„Éà„ÇíÂÜçÂà©Áî®
                let targetElement;
                
                if (targetsActive.length === 0) {
                    // „É°„Ç§„É≥„Çø„Éº„Ç≤„ÉÉ„Éà„Çí‰ΩøÁî®
                    targetElement = target;
                } else {
                    // „ÇØ„É≠„Éº„É≥„Çí‰ΩúÊàê
                    targetElement = target.cloneNode(true);
                    container.appendChild(targetElement);
                }
                
                targetElement.style.width = `${currentSize}px`;
                targetElement.style.height = `${currentSize}px`;
                targetElement.style.left = `${x - currentSize / 2}px`;
                targetElement.style.top = `${y - currentSize / 2}px`;
                targetElement.style.display = 'block';
                
                // „É©„É≥„ÉÄ„É†„Å™ÁßªÂãïÊñπÂêë„ÇíË®≠ÂÆö
                const speed = Math.min(settings.targetSpeed + (level - 1) * settings.targetSpeedIncrement, settings.maxTargetSpeed);
                const angle = Math.random() * Math.PI * 2;
                const vx = Math.cos(angle) * speed;
                const vy = Math.sin(angle) * speed;
                
                // „Çø„Éº„Ç≤„ÉÉ„Éà„Éá„Éº„Çø„ÇíËøΩÂä†
                targetsActive.push({
                    element: targetElement,
                    velocityX: vx,
                    velocityY: vy,
                    size: currentSize
                });
                
                // Èõ£ÊòìÂ∫¶„Å´Âøú„Åò„Å¶ËøΩÂä†„ÅÆ„Çø„Éº„Ç≤„ÉÉ„Éà„ÇíË°®Á§∫
                if (settings.maxTargets > 1 && level > 1 && targetsActive.length < settings.maxTargets) {
                    setTimeout(() => {
                        if (gameActive) showTarget();
                    }, 500);
                }
            }
            
            // „Çø„Éº„Ç≤„ÉÉ„Éà„Éí„ÉÉ„ÉàÂá¶ÁêÜ
            function hitTarget(targetElement, x, y) {
                if (!gameActive) return;
                
                // „Çø„Éº„Ç≤„ÉÉ„Éà„Éá„Éº„Çø„ÇíÊé¢„Åô
                const targetIndex = targetsActive.findIndex(t => t.element === targetElement);
                if (targetIndex === -1) return;
                
                // „Çø„Éº„Ç≤„ÉÉ„Éà„ÇíÈùûË°®Á§∫
                targetElement.style.display = 'none';
                
                // „Çø„Éº„Ç≤„ÉÉ„Éà„Éá„Éº„Çø„ÇíÂâäÈô§
                const targetData = targetsActive.splice(targetIndex, 1)[0];
                
                // „Éí„ÉÉ„ÉàÊï∞„Å®„Ç≥„É≥„Éú„ÇíÂ¢óÂä†
                hitsInLevel++;
                combo++;
                maxCombo = Math.max(maxCombo, combo);
                
                // „Çπ„Ç≥„Ç¢Ë®àÁÆóÔºà„Ç≥„É≥„Éú„Éú„Éº„Éä„Çπ‰ªò„ÅçÔºâ
                const settings = DIFFICULTY_SETTINGS[currentDifficulty];
                const baseScore = settings.scorePerHit;
                let bonusScore = 0;
                
                if (combo > 1) {
                    // „Ç≥„É≥„Éú„Éú„Éº„Éä„ÇπË®àÁÆó
                    bonusScore = Math.floor(baseScore * (combo - 1) * (settings.comboMultiplier / 10));
                }
                
                const totalScore = baseScore + bonusScore;
                score += totalScore;
                
                // ÊµÆ„Åç‰∏ä„Åå„Çã„Çπ„Ç≥„Ç¢„Ç®„Éï„Çß„ÇØ„Éà
                showFloatingScore(x, y, totalScore, combo > 1);
                
                // UI„ÇíÊõ¥Êñ∞
                updateScore();
                updateCombo();
                
                // ÊàêÂäüÂäπÊûúÈü≥
                if (combo > 1) {
                    playSFX('combo');
                } else {
                    playSFX('success');
                }
                
                // Èõ∑„ÇíÁîüÊàê
                animateLightning(x, y);
                
                // „É¨„Éô„É´„Ç¢„ÉÉ„ÉóÁ¢∫Ë™ç
                checkLevelUp();
                
                // Ê¨°„ÅÆ„Çø„Éº„Ç≤„ÉÉ„Éà„ÇíË°®Á§∫ÔºàÈõ∑„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Âæå„Å´Ôºâ
                setTimeout(() => {
                    if (gameActive) showTarget();
                }, 200);
            }
            
            // „É¨„Éô„É´„Ç¢„ÉÉ„Éó„ÇíÁ¢∫Ë™ç
            function checkLevelUp() {
                const settings = DIFFICULTY_SETTINGS[currentDifficulty];
                if (hitsInLevel >= settings.levelUpThreshold) {
                    level++;
                    maxLevel = Math.max(maxLevel, level);
                    hitsInLevel = 0;
                    
                    // „É¨„Éô„É´Ë°®Á§∫„ÇíÊõ¥Êñ∞
                    updateLevel();
                    
                    // „É¨„Éô„É´„Ç¢„ÉÉ„ÉóÂäπÊûúÈü≥
                    playSFX('levelup');
                    
                    // „É¨„Éô„É´„Ç¢„ÉÉ„Éó„É°„ÉÉ„Çª„Éº„Ç∏„Çí‰∏ÄÁû¨Ë°®Á§∫
                    const levelupMsg = document.createElement('div');
                    levelupMsg.textContent = `„É¨„Éô„É´„Ç¢„ÉÉ„ÉóÔºÅ Lv.${level}`;
                    levelupMsg.style.position = 'absolute';
                    levelupMsg.style.top = '40%';
                    levelupMsg.style.left = '50%';
                    levelupMsg.style.transform = 'translate(-50%, -50%)';
                    levelupMsg.style.color = '#ffcc00';
                    levelupMsg.style.textShadow = '0 0 10px rgba(255, 200, 0, 0.8)';
                    levelupMsg.style.fontSize = '36px';
                    levelupMsg.style.fontWeight = 'bold';
                    levelupMsg.style.zIndex = '200';
                    levelupMsg.style.opacity = '0';
                    levelupMsg.style.transition = 'all 0.5s';
                    container.appendChild(levelupMsg);
                    
                    setTimeout(() => {
                        levelupMsg.style.opacity = '1';
                        setTimeout(() => {
                            levelupMsg.style.opacity = '0';
                            setTimeout(() => {
                                container.removeChild(levelupMsg);
                            }, 500);
                        }, 1000);
                    }, 10);
                }
            }
            
            // ÊµÆ„Åç‰∏ä„Åå„Çã„Çπ„Ç≥„Ç¢Ë°®Á§∫
            function showFloatingScore(x, y, score, isCombo) {
                const floatingScore = document.createElement('div');
                floatingScore.classList.add('floating-score');
                
                // „Ç≥„É≥„Éú„ÅÆÂ†¥Âêà„ÅØËâ≤„ÇíÂ§â„Åà„Çã
                if (isCombo) {
                    floatingScore.style.color = '#ffcc00';
                    floatingScore.textContent = `+${score} COMBO!`;
                } else {
                    floatingScore.textContent = `+${score}`;
                }
                
                floatingScore.style.left = `${x - 30}px`;
                floatingScore.style.top = `${y - 30}px`;
                container.appendChild(floatingScore);
                
                // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
                setTimeout(() => {
                    floatingScore.style.opacity = '1';
                    floatingScore.style.transform = 'translateY(-50px)';
                    
                    setTimeout(() => {
                        floatingScore.style.opacity = '0';
                        setTimeout(() => {
                            container.removeChild(floatingScore);
                        }, 1000);
                    }, 800);
                }, 10);
            }
            
            // „Çπ„Ç≥„Ç¢„ÇíÊõ¥Êñ∞
            function updateScore() {
                scoreDisplay.textContent = `„Çπ„Ç≥„Ç¢: ${score}`;
            }
            
            // „Ç≥„É≥„Éú„ÇíÊõ¥Êñ∞
            function updateCombo() {
                if (combo > 1) {
                    comboDisplay.textContent = `„Ç≥„É≥„Éú x${combo}`;
                    comboDisplay.style.display = 'block';
                    
                    // „Éë„É´„Çπ„Ç®„Éï„Çß„ÇØ„Éà
                    comboDisplay.classList.add('pulse');
                    setTimeout(() => {
                        comboDisplay.classList.remove('pulse');
                    }, 200);
                } else {
                    comboDisplay.style.display = 'none';
                }
            }
            
            // „É¨„Éô„É´„ÇíÊõ¥Êñ∞
            function updateLevel() {
                levelDisplay.textContent = `„É¨„Éô„É´ ${level}`;
            }
            
            // „Çø„Ç§„Éû„Éº„ÇíÊõ¥Êñ∞
            function updateTimer() {
                timerDisplay.textContent = `„ÅÇ„Å®${gameTimeRemaining}Áßí`;
                
                // ÊÆã„ÇäÊôÇÈñì„ÅåÂ∞ë„Å™„Åè„Å™„Å£„Åü„ÇâË≠¶ÂëäËâ≤„Å´
                if (gameTimeRemaining <= 5) {
                    timerDisplay.style.color = '#ff3333';
                } else {
                    timerDisplay.style.color = 'white';
                }
            }
            
            // ÁµêÊûúË°®Á§∫
            function showResult() {
                finalScore.textContent = score;
                resultStats.textContent = `ÊúÄÂ§ß„Ç≥„É≥„Éú: ${maxCombo} / ÊúÄÈ´ò„É¨„Éô„É´: ${maxLevel}`;
                
                // „Çπ„Ç≥„Ç¢„Å´Âøú„Åò„Åü„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
                let messageType;
                const difficulty = currentDifficulty;
                
                let excellentThreshold, goodThreshold, normalThreshold;
                
                if (difficulty === 'easy') {
                    excellentThreshold = 200;
                    goodThreshold = 120;
                    normalThreshold = 60;
                } else if (difficulty === 'normal') {
                    excellentThreshold = 300;
                    goodThreshold = 200;
                    normalThreshold = 100;
                } else { // hard
                    excellentThreshold = 500;
                    goodThreshold = 300;
                    normalThreshold = 150;
                }
                
                if (score >= excellentThreshold) {
                    messageType = 'excellent';
                } else if (score >= goodThreshold) {
                    messageType = 'good';
                } else if (score >= normalThreshold) {
                    messageType = 'normal';
                } else {
                    messageType = 'beginner';
                }
                
                const messages = RESULT_MESSAGES[messageType];
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                resultMessage.textContent = randomMessage;
                
                // ÁµêÊûú„Éú„ÉÉ„ÇØ„Çπ„ÇíË°®Á§∫
                resultBox.style.display = 'block';
                setTimeout(() => {
                    resultBox.classList.add('show');
                }, 10);
                
                // UI„ÅØÈùûË°®Á§∫
                hideGameUI();
            }
            
            // „É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
            function showMessage(title, instructions, duration = 0) {
                messageText.textContent = title;
                instructionsText.innerHTML = instructions;
                startButton.style.display = 'none';
                messageBox.style.display = 'block';
                
                // Êó¢Â≠ò„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏Ëá™ÂãïÊ∂àÂéª„Çø„Ç§„Éû„Éº„Åå„ÅÇ„Çå„Å∞„Ç≠„É£„É≥„Çª„É´
                if (messageHideTimeout) {
                    clearTimeout(messageHideTimeout);
                    messageHideTimeout = null;
                }
                
                // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÅÆ„Çø„Ç§„Éü„É≥„Ç∞„ÇíÂêà„Çè„Åõ„Çã„Åü„ÇÅÂ∞ë„ÅóÈÅÖÂª∂
                setTimeout(() => {
                    messageBox.classList.add('show');
                }, 10);
                
                // duration„ÅåÊ≠£„ÅÆÊï∞„ÅÆÂ†¥Âêà„ÅÆ„ÅøËá™ÂãïÈùûË°®Á§∫
                if (duration > 0) {
                    messageHideTimeout = setTimeout(() => {
                        messageBox.classList.remove('show');
                        setTimeout(() => {
                            messageBox.style.display = 'none';
                            messageHideTimeout = null;
                        }, 300);
                    }, duration);
                }
            }
            
            // ÂäπÊûúÈü≥„ÇíÂÜçÁîü
            function playSFX(type) {
                if (!soundEnabled) return;
                
                // Èü≥Â£∞„ÅÆ„É≠„Éº„Éâ
                loadAudio(type);
                
                if (audioElements[type]) {
                    // Èü≥Â£∞„ÅåÂÜçÁîü‰∏≠„Å™„ÇâÂÅúÊ≠¢
                    if (!audioElements[type].paused) {
                        audioElements[type].pause();
                        audioElements[type].currentTime = 0;
                    }
                    
                    // ÂÜçÁîüË©¶Ë°å
                    audioElements[type].play().catch(function(e) {
                        console.log('SFX play failed: ' + e);
                        // „Ç®„É©„ÉºÊôÇ„ÅØÈü≥Â£∞Ëß£Èô§„ÇíË©¶Ë°å
                        unlockAudio();
                    });
                }
            }
            
            // Èõ∑„ÅÆÈü≥„ÇíÂÜçÁîü
            function playThunderSound() {
                if (!soundEnabled) return;
                
                // Èõ∑Èü≥Â£∞„ÅÆ„É≠„Éº„Éâ
                loadAudio('thunder');
                
                // Èõ∑„Ç™„Éº„Éá„Ç£„Ç™„ÅåÂ≠òÂú®„Åô„ÇãÂ†¥Âêà„ÅÆ„ÅøÂÜçÁîü
                if (audioElements.thunder) {
                    // Èü≥ÈáèË®≠ÂÆö
                    audioElements.thunder.volume = 0.3 + Math.random() * 0.3;
                    
                    // ÂÜçÁîü‰∏≠„Å™„ÇâÁèæÂú®„ÅÆÈü≥„ÇíÂÅúÊ≠¢
                    if (!audioElements.thunder.paused) {
                        audioElements.thunder.pause();
                        audioElements.thunder.currentTime = 0;
                    }
                    
                    // ÂÜçÁîü
                    audioElements.thunder.play().catch(e => {
                        console.log('Thunder sound play failed: ' + e);
                        // „Ç®„É©„ÉºÊôÇ„ÅØÈü≥Â£∞Ëß£Èô§„ÇíË©¶Ë°å
                        unlockAudio();
                    });
                }
            }
            
            // „Åô„Åπ„Å¶„ÅÆ„Çø„Ç§„Éû„Éº„Çí„ÇØ„É™„Ç¢
            function clearAllTimers() {
                // „Ç§„É≥„Çø„Éº„Éê„É´„Å®„Çø„Ç§„É†„Ç¢„Ç¶„Éà„Çí„ÇØ„É™„Ç¢
                timeoutIds.forEach(id => clearTimeout(id));
                timeoutIds = [];
                
                // „É°„ÉÉ„Çª„Éº„Ç∏Ëá™ÂãïÊ∂àÂéª„Çø„Ç§„Éû„Éº„ÇÇ„ÇØ„É™„Ç¢
                if (messageHideTimeout) {
                    clearTimeout(messageHideTimeout);
                    messageHideTimeout = null;
                }
                
                // „Ç≤„Éº„É†„Çø„Ç§„Éû„Éº„Çí„ÇØ„É™„Ç¢
                if (gameTimerId) {
                    clearInterval(gameTimerId);
                    gameTimerId = null;
                }
                
                // „Çø„Éº„Ç≤„ÉÉ„ÉàÁßªÂãï„Çø„Ç§„Éû„Éº„Çí„ÇØ„É™„Ç¢
                if (targetMovementTimerId) {
                    clearInterval(targetMovementTimerId);
                    targetMovementTimerId = null;
                }
                
                gameActive = false;
            }
            
            // Èõ∑„ÅÆ„Ç∞„É≠„ÉºÂäπÊûúÁî®„Éï„Ç£„É´„Çø„Éº‰ΩúÊàê
            function createLightningFilter() {
                // „É¢„Éê„Ç§„É´„É¢„Éº„Éâ„Åß„ÅØÁ∞°Áï•Âåñ
                if (!highQualityMode) {
                    // „Ç∑„É≥„Éó„É´„Å™„Éï„Ç£„É´„Çø„Éº„ÅÆ„Åø
                    const filterDefs = document.createElementNS(svgNS, "defs");
                    
                    const filter = document.createElementNS(svgNS, "filter");
                    filter.setAttribute("id", "lightningGlow");
                    filter.setAttribute("x", "-30%");
                    filter.setAttribute("y", "-30%");
                    filter.setAttribute("width", "160%");
                    filter.setAttribute("height", "160%");
                    
                    // „Åº„Åã„ÅóÂäπÊûúÔºàËªΩÈáèÂåñÔºâ
                    const gaussianBlur = document.createElementNS(svgNS, "feGaussianBlur");
                    gaussianBlur.setAttribute("in", "SourceGraphic");
                    gaussianBlur.setAttribute("stdDeviation", "5");
                    filter.appendChild(gaussianBlur);
                    
                    filterDefs.appendChild(filter);
                    svg.appendChild(filterDefs);
                    return;
                }
                
                // È´òÂìÅË≥™„É¢„Éº„ÉâÁî®„ÅÆÂÆåÂÖ®„Å™„Éï„Ç£„É´„Çø„Éº
                const filterDefs = document.createElementNS(svgNS, "defs");
                
                const filter = document.createElementNS(svgNS, "filter");
                filter.setAttribute("id", "lightningGlow");
                filter.setAttribute("x", "-50%");
                filter.setAttribute("y", "-50%");
                filter.setAttribute("width", "200%");
                filter.setAttribute("height", "200%");
                
                // „Åº„Åã„ÅóÂäπÊûú
                const gaussianBlur = document.createElementNS(svgNS, "feGaussianBlur");
                gaussianBlur.setAttribute("in", "SourceGraphic");
                gaussianBlur.setAttribute("stdDeviation", "10");
                gaussianBlur.setAttribute("result", "blur");
                filter.appendChild(gaussianBlur);
                
                // Êòé„Çã„Åï
                const brightness = document.createElementNS(svgNS, "feComponentTransfer");
                brightness.setAttribute("in", "blur");
                brightness.setAttribute("result", "bright");
                
                const funcR = document.createElementNS(svgNS, "feFuncR");
                funcR.setAttribute("type", "linear");
                funcR.setAttribute("slope", "3");
                brightness.appendChild(funcR);
                
                const funcG = document.createElementNS(svgNS, "feFuncG");
                funcG.setAttribute("type", "linear");
                funcG.setAttribute("slope", "3");
                brightness.appendChild(funcG);
                
                const funcB = document.createElementNS(svgNS, "feFuncB");
                funcB.setAttribute("type", "linear");
                funcB.setAttribute("slope", "3");
                brightness.appendChild(funcB);
                
                filter.appendChild(brightness);
                
                // ÂÖÉ„ÅÆÈõ∑„Å®ÂêàÊàê
                const composite = document.createElementNS(svgNS, "feComposite");
                composite.setAttribute("in", "bright");
                composite.setAttribute("in2", "SourceGraphic");
                composite.setAttribute("operator", "over");
                filter.appendChild(composite);
                
                filterDefs.appendChild(filter);
                svg.appendChild(filterDefs);
            }
            
            // Èõ∑„Éë„Çπ„ÇíÁîüÊàê„Åô„ÇãÈñ¢Êï∞
            function generateLightningPath(startX, startY, endX, endY, displacementFactor, iterations, segmentLength = 30) {
                // „Çπ„Éû„Éõ„É¢„Éº„Éâ„Åß„ÅØÂçòÁ¥îÂåñ
                if (!highQualityMode) {
                    iterations = Math.min(iterations, 2); // Áπ∞„ÇäËøî„ÅóÂõûÊï∞„ÇíÊ∏õ„Çâ„Åô
                    segmentLength = Math.max(segmentLength, 40); // „Çª„Ç∞„É°„É≥„ÉàÈï∑„ÇíÂ¢ó„ÇÑ„Åô
                }
                
                let points = [];
                points.push({ x: startX, y: startY });
                
                // ÁµÇÁÇπ„Åæ„Åß„ÅÆË∑ùÈõ¢
                const dx = endX - startX;
                const dy = endY - startY;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                // „Çª„Ç∞„É°„É≥„ÉàÊï∞„ÇíË®àÁÆó
                const numSegments = Math.ceil(distance / segmentLength);
                
                // ‰∏≠ÈñìÁÇπ„Çí‰ΩúÊàê
                let currentX = startX;
                let currentY = startY;
                
                for (let i = 0; i < numSegments; i++) {
                    // Ê¨°„ÅÆÁÇπ„ÅÆÊñπÂêë„ÇíËã•Âπ≤„É©„É≥„ÉÄ„É†„Å´
                    const segmentDistance = distance / numSegments;
                    const directionChangeX = (Math.random() * 2 - 1) * 0.3;
                    const directionChangeY = Math.random() * 0.5; // ‰∏ãÂêë„Åç„Å´ÈÄ≤„ÇÄÂÇæÂêë
                    
                    const normalizedDx = dx / distance + directionChangeX;
                    const normalizedDy = dy / distance + directionChangeY;
                    
                    const nextX = currentX + normalizedDx * segmentDistance;
                    const nextY = currentY + normalizedDy * segmentDistance;
                    
                    // „Ç∏„Ç∞„Ç∂„Ç∞„Åô„Çã„Åü„ÇÅ„ÅÆÊ®™ÊñπÂêë„ÅÆÂ§â‰Ωç
                    const displacement = (Math.random() * 2 - 1) * displacementFactor;
                    const perpX = -normalizedDy;
                    const perpY = normalizedDx;
                    
                    const displacedX = nextX + perpX * displacement;
                    const displacedY = nextY + perpY * displacement;
                    
                    currentX = displacedX;
                    currentY = displacedY;
                    
                    points.push({ x: currentX, y: currentY });
                }
                
                // ÁµÇÁÇπ„ÇíËøΩÂä†„Åó„Å¶Á¢∫ÂÆü„Å´ÁõÆÁöÑÂú∞„Å´Âà∞ÈÅî
                points.push({ x: endX, y: endY });
                
                // „Ç∏„Ç∞„Ç∂„Ç∞Âá¶ÁêÜ„Çí„Åï„Çâ„Å´Á¥∞„Åã„ÅèÔºà„Çà„ÇäÈõ∑„Çâ„Åó„ÅèÔºâ
                // „Çπ„Éû„Éõ„É¢„Éº„Éâ„Åß„ÅØÁúÅÁï•ÂèØËÉΩ„Å™Â†¥Âêà„ÇÇ„ÅÇ„Çã
                if (highQualityMode || Math.random() < 0.5) {
                    for (let iter = 0; iter < iterations; iter++) {
                        let newPoints = [];
                        for (let j = 0; j < points.length - 1; j++) {
                            const start = points[j];
                            const end = points[j + 1];
                            newPoints.push(start);
                            
                            // ÁÇπÈñì„ÅÆ‰∏≠ÈñìÁÇπ„ÇíË®àÁÆó
                            const midX = (start.x + end.x) / 2;
                            const midY = (start.y + end.y) / 2;
                            
                            // ‰∏≠ÈñìÁÇπ„ÇíÂ§â‰Ωç
                            const displacement = (Math.random() * 2 - 1) * displacementFactor / (iter + 1);
                            const dx = end.x - start.x;
                            const dy = end.y - start.y;
                            const perpX = -dy;
                            const perpY = dx;
                            
                            const length = Math.sqrt(perpX * perpX + perpY * perpY);
                            if (length > 0) {
                                const normalizedPerpX = perpX / length;
                                const normalizedPerpY = perpY / length;
                                
                                const newX = midX + normalizedPerpX * displacement;
                                const newY = midY + normalizedPerpY * displacement;
                                
                                newPoints.push({ x: newX, y: newY });
                            }
                        }
                        newPoints.push(points[points.length - 1]);
                        points = newPoints;
                    }
                }
                
                return points;
            }
            
            // Èõ∑„Éë„Çπ„Åã„ÇâSVG„Éë„ÇπÊñáÂ≠óÂàó„ÇíÁîüÊàê
            function createPathString(points) {
                let pathString = `M ${points[0].x} ${points[0].y}`;
                for (let i = 1; i < points.length; i++) {
                    pathString += ` L ${points[i].x} ${points[i].y}`;
                }
                return pathString;
            }
            
            // Èõ∑„ÇíÁîüÊàê„Åô„ÇãÈñ¢Êï∞
            function createLightning(startX, startY, endX, endY, color, width, brightness = 1) {
                // „É¢„Éê„Ç§„É´„É¢„Éº„Éâ„Åß„ÅØÂçòÁ¥îÂåñ
                const iterations = highQualityMode ? 5 : 2;
                const segmentLength = highQualityMode ? 20 : 40;
                
                const points = generateLightningPath(startX, startY, endX, endY, 40, iterations, segmentLength);
                const pathString = createPathString(points);
                
                const path = document.createElementNS(svgNS, "path");
                path.setAttribute("d", pathString);
                path.setAttribute("stroke", color);
                path.setAttribute("stroke-width", width);
                path.setAttribute("fill", "none");
                path.setAttribute("stroke-linecap", "round");
                path.setAttribute("stroke-linejoin", "round");
                path.setAttribute("opacity", brightness);
                path.setAttribute("filter", "url(#lightningGlow)");
                svg.appendChild(path);
                
                return { path, points };
            }
            
            // ÊûùÂàÜ„Åã„ÇåÈõ∑„ÇíÁîüÊàê„Åô„ÇãÈñ¢Êï∞
            function createBranchLightning(mainPoints, branchIndex, color, width, brightness = 0.7) {
                if (branchIndex < 1 || branchIndex >= mainPoints.length - 1) return null;
                
                const startPoint = mainPoints[branchIndex];
                const prevPoint = mainPoints[branchIndex - 1];
                
                // ÊûùÂàÜ„Åã„Çå„ÅÆÊñπÂêë„ÇíÊ±∫ÂÆöÔºàÂâç„ÅÆÁÇπ„Å®„ÅÆËßíÂ∫¶„Åã„ÇâÊ¥æÁîüÔºâ
                const dx = startPoint.x - prevPoint.x;
                const dy = startPoint.y - prevPoint.y;
                const angle = Math.atan2(dy, dx);
                
                // ÊûùÂàÜ„Åã„Çå„ÅÆÊñπÂêë„Å´„É©„É≥„ÉÄ„É†ÊÄß„ÇíËøΩÂä†
                const branchAngle = angle + (Math.random() * 1.5 - 0.5);
                
                // „É¢„Éê„Ç§„É´„É¢„Éº„Éâ„Åß„ÅØÁü≠„Åè
                const branchLength = highQualityMode ? 
                    (Math.random() * 300 + 100) : 
                    (Math.random() * 150 + 50);
                
                const endX = startPoint.x + Math.cos(branchAngle) * branchLength;
                const endY = startPoint.y + Math.sin(branchAngle) * branchLength;
                
                // „É¢„Éê„Ç§„É´„É¢„Éº„Éâ„Åß„ÅØÂçòÁ¥îÂåñ
                const iterations = highQualityMode ? 4 : 2;
                const segmentLength = highQualityMode ? 15 : 30;
                
                const points = generateLightningPath(startPoint.x, startPoint.y, endX, endY, 25, iterations, segmentLength);
                const pathString = createPathString(points);
                
                const path = document.createElementNS(svgNS, "path");
                path.setAttribute("d", pathString);
                path.setAttribute("stroke", color);
                path.setAttribute("stroke-width", width);
                path.setAttribute("fill", "none");
                path.setAttribute("stroke-linecap", "round");
                path.setAttribute("stroke-linejoin", "round");
                path.setAttribute("opacity", brightness);
                path.setAttribute("filter", "url(#lightningGlow)");
                svg.appendChild(path);
                
                // „Çµ„ÉñÊûùÂàÜ„Åã„Çå„ÅØ„É¢„Éê„Ç§„É´„É¢„Éº„Éâ„Åß„ÅØÁúÅÁï•
                let subBranch = null;
                if (highQualityMode && Math.random() < 0.5 && points.length > 3) {
                    const subBranchIndex = Math.floor(Math.random() * (points.length - 2)) + 1;
                    subBranch = createBranchLightning(points, subBranchIndex, color, width * 0.6, brightness * 0.7);
                }
                
                return { path, points, subBranch };
            }
            
            // ËÉåÊôØ„Éï„É©„ÉÉ„Ç∑„É•„Çí‰ΩúÊàê
            function createBackgroundFlash() {
                const flash = document.createElementNS(svgNS, "rect");
                flash.setAttribute("width", "100%");
                flash.setAttribute("height", "100%");
                flash.setAttribute("fill", "rgba(230, 240, 255, 0)");
                svg.appendChild(flash);
                return flash;
            }
            
            // Èõ∑„ÅÆÈñÉÂÖâ„Ç®„Éï„Çß„ÇØ„Éà
            function createLightningFlash(x, y, size) {
                const flash = document.createElementNS(svgNS, "circle");
                flash.setAttribute("cx", x);
                flash.setAttribute("cy", y);
                flash.setAttribute("r", size);
                flash.setAttribute("fill", "rgba(255, 255, 255, 0)");
                flash.setAttribute("filter", "url(#lightningGlow)");
                svg.appendChild(flash);
                return flash;
            }
            
            // Ë°ùÊíÉÊ≥¢„Ç®„Éï„Çß„ÇØ„Éà
            function createImpactEffect(x, y) {
                const impact = document.createElement('div');
                impact.classList.add('impact-effect');
                impact.style.left = `${x - 50}px`;
                impact.style.top = `${y - 50}px`;
                container.appendChild(impact);
                
                // „É¢„Éê„Ç§„É´„É¢„Éº„Éâ„Åß„ÅØÁ∞°Áï•Âåñ
                const maxSize = highQualityMode ? 300 : 200;
                const duration = highQualityMode ? 1000 : 700;
                
                // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
                let size = 0;
                const startTime = Date.now();
                
                function animateImpact() {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    size = maxSize * progress;
                    impact.style.width = `${size}px`;
                    impact.style.height = `${size}px`;
                    impact.style.opacity = 1 - progress;
                    
                    if (progress < 1) {
                        requestAnimationFrame(animateImpact);
                    } else {
                        container.removeChild(impact);
                    }
                }
                
                requestAnimationFrame(animateImpact);
            }
            
            // ‰ΩøÁî®‰∏≠„ÅÆSVG„Éé„Éº„Éâ
            let activeNodes = {
                paths: [],
                flashes: [],
                rects: []
            };
            
            // Èõ∑„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÅÆ„Çø„Ç§„Éû„ÉºID
            let lightningTimerId = null;
            let isAnimating = false;
            
            // Èõ∑ÂÖ®‰Ωì„Çí„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Åô„ÇãÈñ¢Êï∞
            function animateLightning(targetX = null, targetY = null) {
                // ÁèæÂú®„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥‰∏≠„Åã„Å§„Çø„ÉÉ„Éó‰ΩçÁΩÆÊåáÂÆö„Åß„Å™„ÅÑÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
                if (isAnimating && targetX === null && targetY === null) {
                    return;
                }
                
                // Êó¢Â≠ò„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Çø„Ç§„Éû„Éº„Åå„ÅÇ„Çå„Å∞„Ç≠„É£„É≥„Çª„É´
                if (lightningTimerId) {
                    clearTimeout(lightningTimerId);
                    lightningTimerId = null;
                }
                
                // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÈñãÂßã
                isAnimating = true;
                
                // „Ç≥„É≥„ÉÜ„Éä„ÇíË°®Á§∫
                lightningContainer.style.opacity = 1;
                
                // ËÉåÊôØ„Éï„É©„ÉÉ„Ç∑„É•„Çí‰ΩúÊàê
                const backgroundFlash = createBackgroundFlash();
                activeNodes.rects.push(backgroundFlash);
                
                // „É°„Ç§„É≥„ÅÆÈõ∑„ÅÆÈñãÂßã‰ΩçÁΩÆ„Å®ÁµÇ‰∫Ü‰ΩçÁΩÆ
                let mainStartX, mainStartY, mainEndX, mainEndY;
                
                if (targetX !== null && targetY !== null) {
                    // „Çø„ÉÉ„Éó‰ΩçÁΩÆ„ÅåÊåáÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà
                    mainStartX = targetX + (Math.random() * 40 - 20);
                    mainStartY = -50; // ÁîªÈù¢‰∏äÈÉ®ÔºàÁîªÈù¢Â§ñÔºâ„Åã„ÇâÂßã„ÇÅ„Çã
                    mainEndX = targetX;
                    mainEndY = targetY; // „Çø„ÉÉ„Éó‰ΩçÁΩÆ
                } else {
                    // „É©„É≥„ÉÄ„É†„Å™‰ΩçÁΩÆÔºàËá™ÂãïÂÜçÁîü„É¢„Éº„ÉâÔºâ
                    mainStartX = Math.random() * window.innerWidth * 0.8 + window.innerWidth * 0.1;
                    mainStartY = -50;
                    mainEndX = Math.random() * window.innerWidth * 0.8 + window.innerWidth * 0.1;
                    mainEndY = window.innerHeight + 50;
                }
                
                // Ë§áÊï∞„ÅÆÈõ∑„ÇíÁï∞„Å™„ÇãÂ§™„Åï„Å®Ëâ≤„ÅßÈáç„Å≠„ÇãÔºà„Ç∞„É≠„Éº„Ç®„Éï„Çß„ÇØ„ÉàÁî®Ôºâ
                const mainLightnings = [];
                
                // „Ç´„É©„Éº„Éë„É¨„ÉÉ„Éà„ÇíÈÅ∏Êäû
                const LIGHTNING_COLORS = {
                    night: [
                        "#f0f9ff", // ÊúÄ„ÇÇÊòé„Çã„ÅÑÁôΩÈùíËâ≤
                        "#d6ebff", 
                        "#b8dfff", 
                        "#92d2ff"  // „Çà„ÇäÈùí„Åø„Åå„Åã„Å£„ÅüËâ≤
                    ],
                    sunset: [
                        "#fff0e0", // Êöñ„Åã„ÅÑÁôΩ
                        "#ffe0c0", 
                        "#ffd0a0", 
                        "#ffc080"  // „Ç™„É¨„É≥„Ç∏„Åå„Åã„Å£„ÅüËâ≤
                    ],
                    fantasy: [
                        "#f0e0ff", // ËñÑÁ¥´Ëâ≤„ÅÆÁôΩ
                        "#e0c0ff", 
                        "#d0a0ff", 
                        "#c080ff"  // ÈÆÆ„ÇÑ„Åã„Å™Á¥´
                    ]
                };
                
                const colorPalette = LIGHTNING_COLORS[currentTheme];
                
                // „É°„Ç§„É≥„ÅÆÈõ∑ÔºàÊúÄ„ÇÇÂ§™„ÅÑÂ§ñÂÅ¥„ÅÆÂÖâÔºâ
                const outerLightning = createLightning(
                    mainStartX, mainStartY, mainEndX, mainEndY, 
                    colorPalette[0], 12, 0.7
                );
                mainLightnings.push(outerLightning);
                activeNodes.paths.push(outerLightning.path);
                
                // „É¢„Éê„Ç§„É´„É¢„Éº„Éâ„Åß„ÅØÂÜÖÂÅ¥„ÅÆÂÖâ„ÇíÊ∏õ„Çâ„Åô
                const innerLightCount = highQualityMode ? 3 : 1;
                
                // ÂÜÖÂÅ¥„ÅÆÂÖâ
                for (let i = 0; i < innerLightCount; i++) {
                    const lightning = createLightning(
                        mainStartX, mainStartY, mainEndX, mainEndY, 
                        colorPalette[i], 10 - i * 2, 0.9 - i * 0.1
                    );
                    mainLightnings.push(lightning);
                    activeNodes.paths.push(lightning.path);
                }
                
                // ‰∏≠ÂøÉ„ÅÆÊúÄ„ÇÇÊòé„Çã„ÅÑÈÉ®ÂàÜ
                const coreLightning = createLightning(
                    mainStartX, mainStartY, mainEndX, mainEndY, 
                    "#ffffff", 2, 1.0
                );
                mainLightnings.push(coreLightning);
                activeNodes.paths.push(coreLightning.path);
                
                // ÊûùÂàÜ„Åã„ÇåÈõ∑„ÇíËøΩÂä†
                const branches = [];
                
                // „É¢„Éê„Ç§„É´„É¢„Éº„Éâ„Åß„ÅØÊûù„ÅÆÊï∞„ÇíÊ∏õ„Çâ„Åô
                const branchCount = highQualityMode ? Math.floor(Math.random() * 4) + 2 : Math.floor(Math.random() * 2) + 1;
                
                const mainPoints = mainLightnings[0].points;
                
                for (let i = 0; i < branchCount; i++) {
                    // Èõ∑„ÅÆ‰∏≠ÈñìÈÉ®ÂàÜ„Åã„ÇâÊûùÂàÜ„Åã„Çå„Åô„Çã„Çà„ÅÜ„Å´„Åô„Çã
                    const branchIndex = Math.floor(Math.random() * (mainPoints.length * 0.6)) + Math.floor(mainPoints.length * 0.2);
                    
                    // Â§ñÂÅ¥„ÅÆ„Ç∞„É≠„Éº
                    const outerBranch = createBranchLightning(
                        mainPoints, branchIndex, colorPalette[0], 6, 0.6
                    );
                    if (outerBranch) {
                        branches.push(outerBranch);
                        activeNodes.paths.push(outerBranch.path);
                        if (outerBranch.subBranch && outerBranch.subBranch.path) {
                            activeNodes.paths.push(outerBranch.subBranch.path);
                        }
                    }
                    
                    // È´òÂìÅË≥™„É¢„Éº„Éâ„ÅÆ„ÅøÂÜÖÂÅ¥„ÅÆÊòé„Çã„ÅÑÈÉ®ÂàÜ„ÇÇËøΩÂä†
                    if (highQualityMode) {
                        const innerBranch = createBranchLightning(
                            mainPoints, branchIndex, colorPalette[2], 3, 0.8
                        );
                        if (innerBranch) {
                            branches.push(innerBranch);
                            activeNodes.paths.push(innerBranch.path);
                            if (innerBranch.subBranch && innerBranch.subBranch.path) {
                                activeNodes.paths.push(innerBranch.subBranch.path);
                            }
                        }
                    }
                    
                    // ‰∏≠ÂøÉ„ÅÆÊúÄ„ÇÇÊòé„Çã„ÅÑÈÉ®ÂàÜ
                    const coreBranch = createBranchLightning(
                        mainPoints, branchIndex, "#ffffff", 1.5, 1.0
                    );
                    if (coreBranch) {
                        branches.push(coreBranch);
                        activeNodes.paths.push(coreBranch.path);
                        if (coreBranch.subBranch && coreBranch.subBranch.path) {
                            activeNodes.paths.push(coreBranch.subBranch.path);
                        }
                    }
                }
                
                // Èõ∑„ÅÆË°ùÁ™ÅÁÇπ„Å´ÈñÉÂÖâ„Ç®„Éï„Çß„ÇØ„Éà
                const impactFlash = createLightningFlash(mainEndX, Math.min(mainEndY, window.innerHeight) - 50, 2);
                activeNodes.flashes.push(impactFlash);
                
                // Ë°ùÊíÉÊ≥¢„Ç®„Éï„Çß„ÇØ„Éà
                if (targetX !== null && targetY !== null) {
                    createImpactEffect(targetX, targetY);
                }
                
                // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Çø„Ç§„Éû„Éº
                const startTime = Date.now();
                
                // „É¢„Éê„Ç§„É´„É¢„Éº„Éâ„Åß„ÅØ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÊôÇÈñì„ÇíÁü≠Á∏Æ
                const flashDuration = highQualityMode ? 150 : 100; // „Éï„É©„ÉÉ„Ç∑„É•Á∂ôÁ∂öÊôÇÈñì
                const fadeDuration = highQualityMode ? 350 : 250;  // „Éï„Çß„Éº„Éâ„Ç¢„Ç¶„ÉàÊôÇÈñì
                
                let isVisible = false;
                let lastToggleTime = 0;
                const flickerInterval = highQualityMode ? 15 : 30; // ÁÇπÊªÖÈñìÈöîÔºàmsÔºâ
                
                function animate() {
                    const now = Date.now();
                    const elapsed = now - startTime;
                    
                    // „Éï„É©„ÉÉ„Ç∑„É•„ÅÆ„Å°„Çâ„Å§„ÅçÂäπÊûúÔºàÊúÄÂàù„ÅÆ200msÔºâ
                    if (elapsed < 200) {
                        if (now - lastToggleTime > flickerInterval) {
                            lastToggleTime = now;
                            isVisible = !isVisible;
                            
                            // „Åô„Åπ„Å¶„ÅÆÈõ∑„ÅÆÂèØË¶ñÊÄß„Çí„Éà„Ç∞„É´
                            const visibility = isVisible ? 1 : 0.2;
                            mainLightnings.forEach(lightning => {
                                lightning.path.style.opacity = visibility;
                            });
                            branches.forEach(branch => {
                                if (branch && branch.path) {
                                    branch.path.style.opacity = visibility * 0.7;
                                }
                                if (branch && branch.subBranch && branch.subBranch.path) {
                                    branch.subBranch.path.style.opacity = visibility * 0.5;
                                }
                            });
                        }
                    }
                    
                    // ËÉåÊôØ„Éï„É©„ÉÉ„Ç∑„É•„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
                    let flashOpacity = 0;
                    if (elapsed < flashDuration) {
                        // Âæê„ÄÖ„Å´Êòé„Çã„Åè„Å™„Çã
                        flashOpacity = elapsed / flashDuration * 0.8;
                    } else if (elapsed < flashDuration + fadeDuration) {
                        // „Éï„Çß„Éº„Éâ„Ç¢„Ç¶„Éà
                        flashOpacity = 0.8 - ((elapsed - flashDuration) / fadeDuration * 0.8);
                    }
                    
                    // „ÉÜ„Éº„Éû„Å´Âêà„Çè„Åõ„Åü„Éï„É©„ÉÉ„Ç∑„É•„Ç´„É©„Éº
                    let flashColor;
                    if (currentTheme === 'night') {
                        flashColor = `rgba(230, 240, 255, ${flashOpacity})`;
                    } else if (currentTheme === 'sunset') {
                        flashColor = `rgba(255, 230, 220, ${flashOpacity})`;
                    } else if (currentTheme === 'fantasy') {
                        flashColor = `rgba(230, 220, 255, ${flashOpacity})`;
                    }
                    
                    backgroundFlash.setAttribute("fill", flashColor);
                    
                    // Ë°ùÁ™ÅÁÇπ„ÅÆÈñÉÂÖâ
                    let impactOpacity = 0;
                    let impactSize = 0;
                    if (elapsed > flashDuration * 0.8 && elapsed < flashDuration + fadeDuration) {
                        impactOpacity = Math.min(1, (elapsed - flashDuration * 0.8) / (flashDuration * 0.2));
                        impactSize = impactOpacity * 50;
                        impactFlash.setAttribute("r", impactSize);
                        impactFlash.setAttribute("fill", `rgba(255, 255, 255, ${impactOpacity * 0.7})`);
                    } else if (elapsed >= flashDuration + fadeDuration) {
                        impactOpacity = Math.max(0, 1 - (elapsed - (flashDuration + fadeDuration)) / 300);
                        impactSize = 50 + (1 - impactOpacity) * 100;
                        impactFlash.setAttribute("r", impactSize);
                        impactFlash.setAttribute("fill", `rgba(255, 255, 255, ${impactOpacity * 0.3})`);
                    }
                    
                    // Èõ∑„ÅÆ„Éï„Çß„Éº„Éâ„Ç¢„Ç¶„Éà
                    if (elapsed > flashDuration + 100) {
                        const fadeOpacity = Math.max(0, 1 - (elapsed - (flashDuration + 100)) / fadeDuration);
                        
                        mainLightnings.forEach(lightning => {
                            lightning.path.style.opacity = fadeOpacity;
                        });
                        
                        branches.forEach(branch => {
                            if (branch && branch.path) {
                                branch.path.style.opacity = fadeOpacity * 0.7;
                            }
                            if (branch && branch.subBranch && branch.subBranch.path) {
                                branch.subBranch.path.style.opacity = fadeOpacity * 0.5;
                            }
                        });
                    }
                    
                    // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÁµÇ‰∫ÜÂà§ÂÆö - „É¢„Éê„Ç§„É´„É¢„Éº„Éâ„Åß„ÅØÊó©„ÅèÁµÇ‰∫Ü
                    const totalDuration = highQualityMode ? 500 : 400;
                    if (elapsed < flashDuration + fadeDuration + totalDuration) {
                        requestAnimationFrame(animate);
                    } else {
                        // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÆå‰∫Ü
                        isAnimating = false;
                        lightningContainer.style.opacity = 0;
                        
                        // SVGÂÜÖ„ÅÆÈõ∑Ë¶ÅÁ¥†„Çí„ÇØ„É™„Ç¢
                        activeNodes.paths.forEach(path => {
                            if (path.parentNode) {
                                path.parentNode.removeChild(path);
                            }
                        });
                        activeNodes.flashes.forEach(flash => {
                            if (flash.parentNode) {
                                flash.parentNode.removeChild(flash);
                            }
                        });
                        activeNodes.rects.forEach(rect => {
                            if (rect.parentNode) {
                                rect.parentNode.removeChild(rect);
                            }
                        });
                        activeNodes = { paths: [], flashes: [], rects: [] };
                        
                        // Ê¨°„ÅÆÈõ∑„Åæ„Åß„ÅÆÈÅÖÂª∂ÔºàËá™ÂãïÂÜçÁîü„É¢„Éº„Éâ„ÅÆ„ÅøÔºâ
                        if (autoPlay) {
                            // „É¢„Éê„Ç§„É´„É¢„Éº„Éâ„Åß„ÅØ„Çà„ÇäÈï∑„ÅÑÈñìÈöî
                            const nextDelay = highQualityMode ? 
                                (Math.random() * 3000 + 2000) : 
                                (Math.random() * 4000 + 3000);
                            
                            lightningTimerId = setTimeout(() => {
                                animateLightning();
                            }, nextDelay);
                        }
                    }
                }
                
                // Èõ∑„ÅÆÈü≥„ÇíÂÜçÁîü
                playThunderSound();
                
                // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÈñãÂßã
                requestAnimationFrame(animate);
            }
            
            // „Ç¶„Ç£„É≥„Éâ„Ç¶„Çµ„Ç§„Ç∫Â§âÊõ¥ÊôÇ„ÅÆ„É™„Çµ„Ç§„Ç∫Âá¶ÁêÜ
            function handleResize() {
                svg.setAttribute("viewBox", "0 0 " + window.innerWidth + " " + window.innerHeight);
                createStars();
            }
            
            // ÂàùÊúüÂåñÈñ¢Êï∞
            function init() {
                // Êòü„Çí‰ΩúÊàê
                createStars();
                
                // Èõ∑„Éï„Ç£„É´„Çø„Éº„Çí‰ΩúÊàê
                createLightningFilter();
                
                // „Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥Ë¶ÅÁ¥†„ÅÆÂàùÊúüË®≠ÂÆö
                countdown.style.display = 'none';
                
                // „Çπ„Çø„Éº„Éà„Éú„Çø„É≥„ÅÆ„Ç§„Éô„É≥„Éà
                startButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    showCountdown();
                });
                
                // „É™„Éà„É©„Ç§„Éú„Çø„É≥„ÅÆ„Ç§„Éô„É≥„Éà
                retryButton.addEventListener('click', function() {
                    resultBox.classList.remove('show');
                    gameActive = false; // „Ç≤„Éº„É†„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÁ¢∫ÂÆü„Å´„É™„Çª„ÉÉ„Éà
                    setTimeout(() => {
                        resultBox.style.display = 'none';
                        showCountdown();
                    }, 300);
                });
                
                // „É¢„Éº„ÉâÊÉÖÂ†±Ë°®Á§∫
                showQualityBanner();
                
                // ÂàùÊúü„ÉÜ„Éº„ÉûË®≠ÂÆö
                setTheme('night');
                
                // ÂàùÊúü„É¢„Éº„ÉâË®≠ÂÆö - ÂøÖ„Åö„Äå„Åµ„Å§„ÅÜ„É¢„Éº„Éâ„Äç„Åã„ÇâÂßã„ÇÅ„Çã
                normalMode.classList.add('active');
                gameMode.classList.remove('active');
                currentMode = 'normal';
                difficultySelector.style.display = 'none';
                
                // Èõ£ÊòìÂ∫¶„ÅÆÂàùÊúüË®≠ÂÆö
                setDifficulty('easy');
                
                // ÂàùÊúü„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫ÔºàÊúÄÂæå„Å´ÂÆüË°å„Åó„Å¶‰∏äÊõ∏„Åç„Åï„Çå„Å™„ÅÑ„Çà„ÅÜ„Å´Ôºâ
                showMessage('Èõ∑„ÅÆ‰∏ñÁïå„Å∏„Çà„ÅÜ„Åì„ÅùÔºÅ', '„Çø„ÉÉ„Éó„Åó„Å¶ÈÅä„Çì„Åß„Åø„Çà„ÅÜÔºÅ', 4000);
            }
            
            // „É¶„Éº„Ç∂„Éº„Ç§„É≥„Çø„É©„ÇØ„Ç∑„Éß„É≥„Åå„ÅÇ„Å£„Åü„Å®„Åç„Å´„Ç™„Éº„Éá„Ç£„Ç™„ÇíÂàùÊúüÂåñ
            function handleFirstInteraction() {
                if (!audioInitialized) {
                    initAudio();
                }
                
                if (!audioUnlocked) {
                    unlockAudio();
                }
            }
            
            // „Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„ÅÆË®≠ÂÆö„Çí‰øÆÊ≠£
            function setupEventHandlers() {
                // „Çø„ÉÉ„Éó/„ÇØ„É™„ÉÉ„ÇØ„ÅßÈõ∑„ÇíÁô∫Áîü„Åï„Åõ„Çã - ‰øÆÊ≠£
                function handleScreenTap(e) {
                    // „Ç≥„É≥„Éà„É≠„Éº„É´„Éë„Éç„É´ÂÜÖ„ÅãÁµêÊûúÁîªÈù¢„ÅÆ„Çø„ÉÉ„ÉÅ„ÅØÂá¶ÁêÜ„Åó„Å™„ÅÑ
                    if (e.target.closest('.ui-container') || 
                        e.target.closest('.message-box') || 
                        e.target.closest('.result-box') ||
                        e.target.closest('.info-banner')) {
                        return; // „Åì„Çå„Çâ„ÅÆË¶ÅÁ¥†ÂÜÖ„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„ÅØÁÑ°Ë¶ñ
                    }
                    
                    // ÁµêÊûúË°®Á§∫‰∏≠„ÅÆ„Çø„ÉÉ„ÉÅ„ÅØÁÑ°Ë¶ñ
                    if (resultBox.style.display === 'block') return;
                    
                    // ÂàùÂõû„Ç§„É≥„Çø„É©„ÇØ„Ç∑„Éß„É≥ÊôÇ„Å´Èü≥Â£∞„ÇíÂàùÊúüÂåñ
                    handleFirstInteraction();
                    
                    // „Çø„ÉÉ„ÉÅ/„ÇØ„É™„ÉÉ„ÇØÂ∫ßÊ®ô„ÇíÂèñÂæó
                    let x, y;
                    
                    if (e.type === 'touchstart') {
                        const touch = e.touches[0];
                        x = touch.clientX;
                        y = touch.clientY;
                    } else {
                        x = e.clientX;
                        y = e.clientY;
                    }
                    
                    // „É¢„Éº„Éâ„Å´Âøú„Åò„ÅüÂá¶ÁêÜ
                    if (currentMode === 'normal') {
                        // ÈÄöÂ∏∏„É¢„Éº„Éâ - „ÇØ„É™„ÉÉ„ÇØ‰ΩçÁΩÆ„Å´Èõ∑„ÇíÁô∫Áîü
                        animateLightning(x, y);
                    } else if (currentMode === 'game') {
                        // „Ç≤„Éº„É†„É¢„Éº„Éâ
                        if (!gameActive && !countdownActive) {
                            // „Ç≤„Éº„É†„ÅåÈñãÂßã„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØ„Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥Ë°®Á§∫
                            showCountdown();
                        } else if (gameActive) {
                            // „Çø„Éº„Ç≤„ÉÉ„Éà„ÅÆ„Éí„ÉÉ„ÉàÂà§ÂÆö
                            let targetHit = false;
                            
                            // ÂêÑ„Çø„Éº„Ç≤„ÉÉ„Éà„Å´„Å§„ÅÑ„Å¶„ÉÅ„Çß„ÉÉ„ÇØ
                            for (let i = 0; i < targetsActive.length; i++) {
                                const targetData = targetsActive[i];
                                const targetElement = targetData.element;
                                const targetRect = targetElement.getBoundingClientRect();
                                const targetX = targetRect.left + targetRect.width / 2;
                                const targetY = targetRect.top + targetRect.height / 2;
                                
                                // „Çø„Éº„Ç≤„ÉÉ„Éà„ÅÆÂΩì„Åü„ÇäÂà§ÂÆöÔºàÂÜÜÂΩ¢Ôºâ
                                const dx = targetX - x;
                                const dy = targetY - y;
                                const distance = Math.sqrt(dx * dx + dy * dy);
                                
                                if (distance < targetData.size / 2 + 10) { // „Çø„Éº„Ç≤„ÉÉ„Éà„Çµ„Ç§„Ç∫„Å´Âøú„Åò„ÅüÂΩì„Åü„ÇäÂà§ÂÆö
                                    // „Éí„ÉÉ„ÉàÂá¶ÁêÜ
                                    targetHit = true;
                                    hitTarget(targetElement, targetX, targetY);
                                    break;
                                }
                            }
                            
                            if (!targetHit) {
                                // „Éü„Çπ - Èõ∑„ÅØÁô∫Áîü„Åï„Åõ„Çã„ÅåÂæóÁÇπ„ÅØÂÖ•„Çâ„Å™„ÅÑ
                                combo = 0; // „Ç≥„É≥„Éú„Çí„É™„Çª„ÉÉ„Éà
                                updateCombo();
                                animateLightning(x, y);
                                playSFX('fail');
                            }
                        }
                    }
                }
                
                // „ÇØ„É™„ÉÉ„ÇØ„Å®„Çø„ÉÉ„ÉÅ‰∏°Êñπ„Å´Âêå„Åò„Éè„É≥„Éâ„É©„Éº„ÇíË®≠ÂÆö
                container.addEventListener('click', handleScreenTap);
                
                container.addEventListener('touchstart', e => {
                // UI „ÇÑ„ÉÄ„Ç§„Ç¢„É≠„Ç∞„Éª„Éê„Éä„Éº‰∏ä„Å™„Çâ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
                if (e.target.closest('.ui-container, .message-box, .result-box, .info-banner')) return;
                e.preventDefault();          // ‚Üê „Åì„Åì„ÅßÂàù„ÇÅ„Å¶ÂÆüË°å
                handleScreenTap(e);
                }, { passive:false });

                
                // „Ç≤„Éº„É†„É¢„Éº„Éâ„Éú„Çø„É≥ - ‰øÆÊ≠£
                gameMode.addEventListener('click', function() {
                    handleFirstInteraction();
                    setMode('game');
                });
                
                // ÈÄöÂ∏∏„É¢„Éº„Éâ„Éú„Çø„É≥ - ‰øÆÊ≠£
                normalMode.addEventListener('click', function() {
                    handleFirstInteraction();
                    setMode('normal');
                });
                
                // Èõ£ÊòìÂ∫¶„Éú„Çø„É≥ - ‰øÆÊ≠£
                easyMode.addEventListener('click', function() {
                    handleFirstInteraction();
                    setDifficulty('easy');
                });
                
                normalDifficulty.addEventListener('click', function() {
                    handleFirstInteraction();
                    setDifficulty('normal');
                });
                
                hardMode.addEventListener('click', function() {
                    handleFirstInteraction();
                    setDifficulty('hard');
                });
                
                // ÂÜçÁîü„Éú„Çø„É≥ - ‰øÆÊ≠£
                playButton.addEventListener('click', function() {
                    handleFirstInteraction();
                    
                    autoPlay = !autoPlay;
                    
                    if (autoPlay) {
                        this.innerHTML = '<span class="emoji">‚èπÔ∏è</span>Ëá™ÂãïÈõ∑ OFF';
                        animateLightning();
                    } else {
                        this.innerHTML = '<span class="emoji">üîÑ</span>Ëá™ÂãïÈõ∑ ON';
                        
                        // Êó¢Â≠ò„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Çí„Ç≠„É£„É≥„Çª„É´
                        if (lightningTimerId) {
                            clearTimeout(lightningTimerId);
                            lightningTimerId = null;
                        }
                    }
                    
                    playSFX('click');
                });
                
                // „Çµ„Ç¶„É≥„Éâ„Éú„Çø„É≥ - ‰øÆÊ≠£
                soundButton.addEventListener('click', function() {
                    handleFirstInteraction();
                    
                    soundEnabled = !soundEnabled;
                    
                    if (soundEnabled) {
                        this.innerHTML = '<span class="emoji">üîä</span>Èü≥ ON';
                    } else {
                        this.innerHTML = '<span class="emoji">üîá</span>Èü≥ OFF';
                    }
                    
                    playSFX('click');
                });
                
                // ÊÉÖÂ†±„Éú„Çø„É≥ - ‰øÆÊ≠£
                infoButton.addEventListener('click', function() {
                    handleFirstInteraction();
                    
                    const tips = [
                        '„ÅÑ„Çç„ÅÑ„Çç„Å™„Å®„Åì„Çç„Çí„Çø„ÉÉ„Éó„Åó„Å¶Èõ∑„ÇíËêΩ„Å®„Åó„Å¶„Åø„Çà„ÅÜÔºÅ',
                        '„Ç≤„Éº„É†„É¢„Éº„Éâ„Åß„ÅØ„Ç≥„É≥„Éú„ÇíÁπã„Åí„Çã„Å®È´òÂæóÁÇπ„ÅåÁãô„Åà„Çã„ÇàÔºÅ',
                        '„ÉÜ„Éº„Éû„ÇíÂ§â„Åà„Çã„Å®Èõ∑„ÅÆËâ≤„ÇÇÂ§â„Çè„Çã„ÇàÔºÅ',
                        '„É¨„Éô„É´„Åå‰∏ä„Åå„Çã„Å®„Çø„Éº„Ç≤„ÉÉ„Éà„ÅåÂ∞è„Åï„Åè„Å™„Å£„Åü„ÇäÈÄü„Åè„Å™„Å£„Åü„Çä„Åô„Çã„ÇàÔºÅ',
                        '‰∏ÄÁï™Èõ£„Åó„ÅÑ„Äå„ÇÄ„Åö„Åã„Åó„ÅÑ„Äç„É¢„Éº„Éâ„ÅßÈ´òÂæóÁÇπ„ÇíÁãô„Åä„ÅÜÔºÅ'
                    ];
                    
                    const tipIndex = Math.floor(Math.random() * tips.length);
                    showMessage('„ÅÇ„Åù„Å≥„Åã„Åü', tips[tipIndex], 4000);
                    
                    playSFX('click');
                });
                
                // „ÉÜ„Éº„ÉûÈÅ∏Êäû - ‰øÆÊ≠£
                nightTheme.addEventListener('click', function() {
                    handleFirstInteraction();
                    setTheme('night');
                });
                
                sunsetTheme.addEventListener('click', function() {
                    handleFirstInteraction();
                    setTheme('sunset');
                });
                
                fantasyTheme.addEventListener('click', function() {
                    handleFirstInteraction();
                    setTheme('fantasy');
                });
                
                // „Ç¶„Ç£„É≥„Éâ„Ç¶„Çµ„Ç§„Ç∫Â§âÊõ¥„Ç§„Éô„É≥„Éà
                window.addEventListener('resize', handleResize);
            }
            
            // „Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„ÅÆË®≠ÂÆö
            setupEventHandlers();
            
            // ÂàùÊúüÂåñ
            init();
        });
    </script>
</body>
</html>